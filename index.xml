<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>我的空间</title><link>https://changxiangyu.cn/</link><description>Recent content on 我的空间</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 20 Jan 2026 10:50:00 +0800</lastBuildDate><atom:link href="https://changxiangyu.cn/index.xml" rel="self" type="application/rss+xml"/><item><title>Windows 11 上配置 Docker</title><link>https://changxiangyu.cn/p/windows-11-%E4%B8%8A%E9%85%8D%E7%BD%AE-docker/</link><pubDate>Tue, 20 Jan 2026 10:50:00 +0800</pubDate><guid>https://changxiangyu.cn/p/windows-11-%E4%B8%8A%E9%85%8D%E7%BD%AE-docker/</guid><description>&lt;p>一、系统要求与准备&lt;/p>
&lt;ol>
&lt;li>系统要求
Windows 11 64位：家庭版/专业版/企业版&lt;/li>
&lt;/ol>
&lt;p>必须启用硬件虚拟化（BIOS/UEFI中开启Intel VT-x/AMD-V）&lt;/p>
&lt;p>WSL 2 需要 Windows 10 版本 1903 或更高（Windows 11 已内置）&lt;/p>
&lt;p>至少 4GB RAM（建议8GB以上）&lt;/p>
&lt;p>存储空间：至少 20GB 可用空间&lt;/p>
&lt;ol start="2">
&lt;li>检查虚拟化是否开启
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="打开-powershell管理员">打开 PowerShell（管理员）&lt;/h1>
&lt;p>systeminfo&lt;/p>
&lt;h1 id="或使用任务管理器查看">或使用任务管理器查看&lt;/h1>
&lt;h1 id="ctrlshiftesc--性能--cpu--虚拟化-已启用">Ctrl+Shift+Esc → 性能 → CPU → &amp;ldquo;虚拟化: 已启用&amp;rdquo;&lt;/h1>
&lt;p>如果未启用，需要重启进入 BIOS/UEFI 开启：&lt;/p>
&lt;p>Intel CPU：开启 Intel Virtualization Technology (VT-x)&lt;/p>
&lt;p>AMD CPU：开启 AMD-V&lt;/p>
&lt;p>二、安装 Docker Desktop for Windows
方法1：官方安装（推荐）
下载 Docker Desktop&lt;/p>
&lt;p>powershell&lt;/p>
&lt;h1 id="官方下载地址最新稳定版">官方下载地址（最新稳定版）&lt;/h1>
&lt;p>&lt;a class="link" href="https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe" target="_blank" rel="noopener"
>https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe&lt;/a>
运行安装程序&lt;/p>
&lt;p>双击安装文件&lt;/p>
&lt;p>勾选 &amp;ldquo;Use WSL 2 instead of Hyper-V&amp;rdquo;（推荐）&lt;/p>
&lt;p>安装完成后不要立即启动&lt;/p>
&lt;p>启用 WSL 2 功能&lt;/p>
&lt;p>powershell&lt;/p>
&lt;h1 id="以管理员身份打开-powershell">以管理员身份打开 PowerShell&lt;/h1>
&lt;p>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart&lt;/p>
&lt;h1 id="重启电脑">重启电脑&lt;/h1>
&lt;p>shutdown /r /t 0
设置 WSL 2 为默认版本&lt;/p>
&lt;p>powershell
wsl &amp;ndash;set-default-version 2
方法2：使用 Winget 安装
powershell&lt;/p>
&lt;h1 id="搜索-docker-desktop">搜索 Docker Desktop&lt;/h1>
&lt;p>winget search Docker.Desktop&lt;/p>
&lt;h1 id="安装">安装&lt;/h1>
&lt;p>winget install Docker.DockerDesktop
三、安装后的配置&lt;/p>
&lt;ol>
&lt;li>首次启动配置
启动 Docker Desktop&lt;/li>
&lt;/ol>
&lt;p>接受服务条款&lt;/p>
&lt;p>选择 &amp;ldquo;Use WSL 2 based engine&amp;rdquo;（推荐）&lt;/p>
&lt;p>配置 WSL 集成：&lt;/p>
&lt;p>text
[x] Enable integration with my default WSL distro
[x] Ubuntu (或你安装的其他 WSL 发行版)
2. 验证安装
powershell&lt;/p>
&lt;h1 id="打开-powershell-或-cmd">打开 PowerShell 或 CMD&lt;/h1>
&lt;p>docker &amp;ndash;version&lt;/p>
&lt;h1 id="docker-version-2406-build-ed223bc">Docker version 24.0.6, build ed223bc&lt;/h1>
&lt;p>docker-compose &amp;ndash;version&lt;/p>
&lt;h1 id="docker-compose-version-v2210">Docker Compose version v2.21.0&lt;/h1>
&lt;p>docker run hello-world&lt;/p>
&lt;h1 id="如果看到欢迎信息说明安装成功">如果看到欢迎信息，说明安装成功&lt;/h1>
&lt;h1 id="查看-docker-信息">查看 Docker 信息&lt;/h1>
&lt;p>docker info
3. WSL 2 后端配置
powershell&lt;/p>
&lt;h1 id="查看-wsl-状态">查看 WSL 状态&lt;/h1>
&lt;p>wsl -l -v&lt;/p>
&lt;h1 id="应该显示">应该显示：&lt;/h1>
&lt;h1 id="name------state-----------version">NAME STATE VERSION&lt;/h1>
&lt;h1 id="-ubuntu----running---------2">* Ubuntu Running 2&lt;/h1>
&lt;h1 id="docker-desktop-data-running-2">docker-desktop-data Running 2&lt;/h1>
&lt;h1 id="docker-desktop----running-2">docker-desktop Running 2&lt;/h1>
&lt;h1 id="如果版本不是2升级">如果版本不是2，升级：&lt;/h1>
&lt;p>wsl &amp;ndash;set-version Ubuntu 2&lt;/p>
&lt;h1 id="设置默认发行版">设置默认发行版&lt;/h1>
&lt;p>wsl &amp;ndash;set-default Ubuntu
四、Docker Desktop 设置优化&lt;/p>
&lt;ol>
&lt;li>资源分配
打开 Docker Desktop → Settings → Resources：&lt;/li>
&lt;/ol>
&lt;p>CPU：建议分配 4-8 核（根据你的 CPU 核心数）&lt;/p>
&lt;p>Memory：建议分配 4-8 GB（不要超过总内存的50%）&lt;/p>
&lt;p>Swap：1-2 GB&lt;/p>
&lt;p>Disk image size：至少 50 GB&lt;/p>
&lt;ol start="2">
&lt;li>Docker Engine 配置
json
// Settings → Docker Engine
{
&amp;ldquo;registry-mirrors&amp;rdquo;: [
&amp;ldquo;https://docker.mirrors.ustc.edu.cn&amp;rdquo;,
&amp;ldquo;https://hub-mirror.c.163.com&amp;rdquo;
],
&amp;ldquo;insecure-registries&amp;rdquo;: [],
&amp;ldquo;debug&amp;rdquo;: false,
&amp;ldquo;experimental&amp;rdquo;: false,
&amp;ldquo;features&amp;rdquo;: {
&amp;ldquo;buildkit&amp;rdquo;: true
},
&amp;ldquo;builder&amp;rdquo;: {
&amp;ldquo;gc&amp;rdquo;: {
&amp;ldquo;enabled&amp;rdquo;: true,
&amp;ldquo;defaultKeepStorage&amp;rdquo;: &amp;ldquo;10GB&amp;rdquo;
}
}
}&lt;/li>
&lt;li>WSL 2 设置
Enable integration with additional WSL 2 distros：选择要集成的发行版&lt;/li>
&lt;/ol>
&lt;p>Start Docker Desktop when you log in：根据需要开启&lt;/p>
&lt;p>Expose daemon on tcp://localhost:2375 without TLS：不建议开启&lt;/p>
&lt;p>五、常用命令与操作
基础命令
powershell&lt;/p>
&lt;h1 id="镜像操作">镜像操作&lt;/h1>
&lt;p>docker images # 查看镜像
docker pull ubuntu:latest # 拉取镜像
docker rmi &amp;lt;image_id&amp;gt; # 删除镜像&lt;/p>
&lt;h1 id="容器操作">容器操作&lt;/h1>
&lt;p>docker ps # 查看运行中的容器
docker ps -a # 查看所有容器
docker run -it ubuntu bash # 运行交互式容器
docker start &amp;lt;container_id&amp;gt; # 启动容器
docker stop &amp;lt;container_id&amp;gt; # 停止容器
docker rm &amp;lt;container_id&amp;gt; # 删除容器&lt;/p>
&lt;h1 id="清理">清理&lt;/h1>
&lt;p>docker system prune -a # 清理所有未使用的资源
Windows 特有命令
powershell&lt;/p>
&lt;h1 id="wsl-与-docker-交互">WSL 与 Docker 交互&lt;/h1>
&lt;p>wsl &amp;ndash;shutdown # 关闭所有 WSL 发行版
wsl -d docker-desktop # 进入 docker-desktop WSL
wsl -d docker-desktop-data # 进入数据卷 WSL&lt;/p>
&lt;h1 id="重启-docker-服务">重启 Docker 服务&lt;/h1>
&lt;p>net stop com.docker.service
net start com.docker.service
六、开发环境配置&lt;/p>
&lt;ol>
&lt;li>项目结构示例
text
my-project/
├── docker-compose.yml
├── Dockerfile
├── .dockerignore
├── src/
└── data/&lt;/li>
&lt;li>简单 Dockerfile 示例
dockerfile&lt;/li>
&lt;/ol>
&lt;h1 id="基础镜像">基础镜像&lt;/h1>
&lt;p>FROM python:3.11-slim&lt;/p>
&lt;h1 id="设置工作目录">设置工作目录&lt;/h1>
&lt;p>WORKDIR /app&lt;/p>
&lt;h1 id="复制依赖文件">复制依赖文件&lt;/h1>
&lt;p>COPY requirements.txt .&lt;/p>
&lt;h1 id="安装依赖">安装依赖&lt;/h1>
&lt;p>RUN pip install &amp;ndash;no-cache-dir -r requirements.txt&lt;/p>
&lt;h1 id="复制源代码">复制源代码&lt;/h1>
&lt;p>COPY . .&lt;/p>
&lt;h1 id="暴露端口">暴露端口&lt;/h1>
&lt;p>EXPOSE 8000&lt;/p>
&lt;h1 id="启动命令">启动命令&lt;/h1>
&lt;p>CMD [&amp;ldquo;python&amp;rdquo;, &amp;ldquo;app.py&amp;rdquo;]
3. Docker Compose 示例
yaml
version: &amp;lsquo;3.8&amp;rsquo;
services:
web:
build: .
ports:
- &amp;ldquo;8000:8000&amp;rdquo;
volumes:
- ./src:/app/src
environment:
- DEBUG=1
depends_on:
- db&lt;/p>
&lt;p>db:
image: postgres:15
environment:
POSTGRES_PASSWORD: example
volumes:
- postgres_data:/var/lib/postgresql/data&lt;/p>
&lt;p>volumes:
postgres_data:
七、常见问题解决&lt;/p>
&lt;ol>
&lt;li>Docker 启动失败
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="1-检查-wsl-2-是否正常">1. 检查 WSL 2 是否正常&lt;/h1>
&lt;p>wsl &amp;ndash;status&lt;/p>
&lt;h1 id="2-重置-docker">2. 重置 Docker&lt;/h1>
&lt;p>Docker Desktop → Troubleshoot → Reset to factory defaults&lt;/p>
&lt;h1 id="3-重新安装-wsl-2-内核">3. 重新安装 WSL 2 内核&lt;/h1>
&lt;h1 id="下载httpswslstorestorageblobcorewindowsnetwslblobwsl_update_x64msi">下载：https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi&lt;/h1>
&lt;ol start="2">
&lt;li>网络问题
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="查看-docker-网络">查看 Docker 网络&lt;/h1>
&lt;p>docker network ls&lt;/p>
&lt;h1 id="创建自定义网络">创建自定义网络&lt;/h1>
&lt;p>docker network create my-network&lt;/p>
&lt;h1 id="配置-dns在-docker-desktop-settings--docker-engine">配置 DNS（在 Docker Desktop Settings → Docker Engine）&lt;/h1>
&lt;p>{
&amp;ldquo;dns&amp;rdquo;: [&amp;ldquo;8.8.8.8&amp;rdquo;, &amp;ldquo;114.114.114.114&amp;rdquo;]
}
3. 磁盘空间不足
powershell&lt;/p>
&lt;h1 id="清理-docker-数据">清理 Docker 数据&lt;/h1>
&lt;p>docker system prune &amp;ndash;all &amp;ndash;volumes&lt;/p>
&lt;h1 id="或通过-docker-desktop">或通过 Docker Desktop&lt;/h1>
&lt;p>Settings → Resources → Advanced → Disk image location&lt;/p>
&lt;h1 id="可以移动到更大的磁盘">可以移动到更大的磁盘&lt;/h1>
&lt;ol start="4">
&lt;li>权限问题
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="以管理员运行-docker-desktop">以管理员运行 Docker Desktop&lt;/h1>
&lt;h1 id="或在-powershell-中">或在 PowerShell 中：&lt;/h1>
&lt;p>net localgroup docker-users &amp;ldquo;你的用户名&amp;rdquo; /add
5. 端口被占用
powershell&lt;/p>
&lt;h1 id="查看端口占用">查看端口占用&lt;/h1>
&lt;p>netstat -ano | findstr :端口号&lt;/p>
&lt;h1 id="停止占用进程">停止占用进程&lt;/h1>
&lt;p>taskkill /PID 进程号 /F
八、性能优化建议&lt;/p>
&lt;ol>
&lt;li>文件系统性能
dockerfile&lt;/li>
&lt;/ol>
&lt;h1 id="在-dockerfile-中使用-dockerignore">在 Dockerfile 中使用 .dockerignore&lt;/h1>
&lt;h1 id="dockerignore-文件内容">.dockerignore 文件内容：&lt;/h1>
&lt;p>.git
node_modules
*.log
*.tmp
2. 卷映射优化
yaml&lt;/p>
&lt;h1 id="docker-composeyml">docker-compose.yml&lt;/h1>
&lt;p>version: &amp;lsquo;3.8&amp;rsquo;
services:
app:
volumes:
# 使用命名卷（性能更好）
- app_data:/data
# 特定文件映射（避免整个目录）
- ./config:/app/config:ro # 只读&lt;/p>
&lt;p>volumes:
app_data:
3. WSL 2 性能优化
创建 %UserProfile%.wslconfig：&lt;/p>
&lt;p>ini
[wsl2]
memory=8GB # 限制内存使用
processors=4 # 分配 CPU 核心
swap=2GB # 交换空间
localhostForwarding=true
九、GUI 应用支持&lt;/p>
&lt;ol>
&lt;li>运行 GUI 应用
dockerfile&lt;/li>
&lt;/ol>
&lt;h1 id="dockerfile-示例运行-firefox">Dockerfile 示例（运行 Firefox）&lt;/h1>
&lt;p>FROM ubuntu:22.04&lt;/p>
&lt;p>RUN apt update &amp;amp;&amp;amp; apt install -y firefox&lt;/p>
&lt;h1 id="允许连接到主机-x11-服务器">允许连接到主机 X11 服务器&lt;/h1>
&lt;p>ENV DISPLAY=host.docker.internal:0
2. 安装 Windows 的 X 服务器
安装 VcXsrv 或 XMing&lt;/p>
&lt;p>启动 XLaunch，选择 &amp;ldquo;Disable access control&amp;rdquo;&lt;/p>
&lt;p>在 WSL 中设置：&lt;/p>
&lt;p>bash
export DISPLAY=$(cat /etc/resolv.conf | grep nameserver | awk &amp;lsquo;{print $2}&amp;rsquo;):0
十、常用工具扩展&lt;/p>
&lt;ol>
&lt;li>安装 Docker 扩展
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="安装-dive查看镜像层">安装 dive（查看镜像层）&lt;/h1>
&lt;p>docker run &amp;ndash;rm -it wagoodman/dive:latest&lt;/p>
&lt;h1 id="安装-lazydockertui-管理工具">安装 lazydocker（TUI 管理工具）&lt;/h1>
&lt;p>docker run &amp;ndash;rm -it lazyteam/lazydocker
2. VS Code 集成
安装 Docker 和 Dev Containers 扩展&lt;/p>
&lt;p>在项目根目录创建 .devcontainer/devcontainer.json&lt;/p>
&lt;p>按 F1 → Reopen in Container&lt;/p>
&lt;p>十一、备份与迁移&lt;/p>
&lt;ol>
&lt;li>导出/导入镜像
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="导出镜像">导出镜像&lt;/h1>
&lt;p>docker save -o myimage.tar myimage:tag&lt;/p>
&lt;h1 id="导入镜像">导入镜像&lt;/h1>
&lt;p>docker load -i myimage.tar&lt;/p>
&lt;h1 id="导出容器">导出容器&lt;/h1>
&lt;p>docker export -o mycontainer.tar container_id
docker import mycontainer.tar
2. 备份 Docker 数据
powershell&lt;/p>
&lt;h1 id="备份所有镜像">备份所有镜像&lt;/h1>
&lt;p>docker save $(docker images -q) -o all_images.tar&lt;/p>
&lt;h1 id="备份卷数据">备份卷数据&lt;/h1>
&lt;p>docker run &amp;ndash;rm -v my_volume:/data -v $(pwd):/backup ubuntu tar czf /backup/backup.tar.gz /data
快速检查清单
虚拟化已启用&lt;/p>
&lt;p>WSL 2 已安装并设为默认&lt;/p>
&lt;p>Docker Desktop 使用 WSL 2 后端&lt;/p>
&lt;p>资源分配合理（内存/CPU/磁盘）&lt;/p>
&lt;p>配置了国内镜像加速器&lt;/p>
&lt;p>防火墙允许 Docker 通信&lt;/p></description></item><item><title>深入解析 Chrome 浏览器架构演进：从单进程到 SOA</title><link>https://changxiangyu.cn/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-chrome-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%BB%8E%E5%8D%95%E8%BF%9B%E7%A8%8B%E5%88%B0-soa/</link><pubDate>Tue, 28 Oct 2025 10:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-chrome-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%BB%8E%E5%8D%95%E8%BF%9B%E7%A8%8B%E5%88%B0-soa/</guid><description>&lt;h2 id="什么是并行处理">什么是并行处理？&lt;/h2>
&lt;p>计算机中的并行处理就是同一时刻处理多个任务。&lt;strong>使用并行处理能大大提升性能&lt;/strong>。&lt;/p>
&lt;p>在操作系统中，多线程可以并行处理任务，但需要注意的是：&lt;strong>线程是不能单独存在的，它是由进程来启动和管理的&lt;/strong>。&lt;/p>
&lt;h2 id="核心概念进程-vs-线程">核心概念：进程 vs 线程&lt;/h2>
&lt;p>理解浏览器架构，首先要区分两个核心概念：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>进程 (Process)&lt;/strong>：&lt;strong>一个进程就是一个程序的运行实例&lt;/strong>。
当你启动一个程序时，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫&lt;strong>进程&lt;/strong>。
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/chrome-1.jpg"
loading="lazy"
alt="进程与线程关系示意图"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>线程 (Thread)&lt;/strong>：&lt;strong>线程是依附于进程的&lt;/strong>。
一个进程中可以包含多个线程，使用多线程并行处理能显著提升运算效率。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>进程和线程关系的 4 个特点：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>牵一发而动全身&lt;/strong>：进程中的任意一个线程执行出错，都会导致整个进程的崩溃。&lt;/li>
&lt;li>&lt;strong>数据共享&lt;/strong>：线程之间共享进程中的数据。
&lt;blockquote>
&lt;p>&lt;em>例如：线程 A、B、C 可以分别写入数据，然后由线程 D 读取展示。&lt;/em>
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/chrome-2.jpg"
loading="lazy"
alt="线程数据共享示意图"
>&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>&lt;strong>内存回收&lt;/strong>：当一个进程关闭之后，操作系统会完全回收该进程所占用的内存。&lt;/li>
&lt;li>&lt;strong>进程隔离&lt;/strong>：进程之间的内容相互隔离。
这是为了保护操作系统，避免进程 A 写入数据到进程 B。正是因为严格隔离，一个进程崩溃（或挂起）不会影响其他进程。如果进程间需要通信，必须使用 &lt;strong>IPC (进程间通信)&lt;/strong> 机制。&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="一单进程浏览器时代">一、单进程浏览器时代&lt;/h2>
&lt;p>&lt;strong>单进程浏览器是指浏览器的所有功能模块（网络、插件、JavaScript 运行环境、渲染引擎等）都是运行在同一个进程里。&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/chrome-3.jpg"
loading="lazy"
alt="单进程浏览器架构图"
>&lt;/p>
&lt;p>这种架构导致了三个致命问题：&lt;strong>不稳定&lt;/strong>、&lt;strong>不流畅&lt;/strong>、&lt;strong>不安全&lt;/strong>。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>不稳定&lt;/strong>
早期浏览器依赖&lt;strong>插件&lt;/strong>实现功能，但插件很容易崩溃。因为所有模块都在一个进程，&lt;strong>一个插件崩溃 = 整个浏览器崩溃&lt;/strong>。同理，复杂的 JavaScript 代码如果引起渲染引擎崩溃，也会导致浏览器闪退。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>不流畅&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>脚本阻塞&lt;/strong>：无限循环的脚本会霸占整个进程，导致页面无法响应。&lt;/li>
&lt;li>&lt;strong>内存泄漏&lt;/strong>：早期的内核在关闭复杂页面后，内存往往不能完全回收。使用时间越长，内存占用越高，浏览器越卡。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>不安全&lt;/strong>
插件通常使用 C/C++ 编写，可以获取操作系统的任意资源。恶意的插件可以窃取账号密码、植入病毒，因为它们没有被限制权限。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="二多进程浏览器时代早期">二、多进程浏览器时代（早期）&lt;/h2>
&lt;p>为了解决单进程的问题，Chrome 推出了多进程架构。&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/chrome-4.jpg"
loading="lazy"
alt="早期多进程架构图"
>&lt;/p>
&lt;p>从图中可以看出，Chrome 的页面运行在单独的渲染进程中，插件也运行在独立的进程中。进程之间通过 IPC 机制通信。&lt;/p>
&lt;p>&lt;strong>多进程如何解决旧时代的痛点？&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>解决不稳定&lt;/strong>：由于进程隔离，一个页面或插件崩溃，&lt;strong>只会影响当前标签页&lt;/strong>，不会导致整个浏览器关闭。&lt;/li>
&lt;li>&lt;strong>解决不流畅&lt;/strong>：JavaScript 运行在各自的渲染进程中。即使某个页面的脚本死循环，也只会卡死那一个标签页，其他页面依然流畅。同时，关闭标签页时，整个进程被销毁，内存被系统完美回收，解决了内存泄漏问题。&lt;/li>
&lt;li>&lt;strong>解决不安全&lt;/strong>：多进程架构引入了&lt;strong>安全沙箱 (Sandbox)&lt;/strong>。
&lt;blockquote>
&lt;p>沙箱就像是给进程上了一把锁。沙箱内的程序可以运行，但不能在硬盘写入数据，也不能读取敏感文件。恶意程序无法突破沙箱去获取系统权限。&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="三目前的-chrome-架构">三、目前的 Chrome 架构&lt;/h2>
&lt;p>最新的 Chrome 架构变得更加精细，通常包含：1 个浏览器主进程、1 个 GPU 进程、1 个网络进程、多个渲染进程和多个插件进程。&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/chrome-5.jpg"
loading="lazy"
alt="最新 Chrome 多进程架构图"
>&lt;/p>
&lt;h3 id="主要进程职能">主要进程职能：&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>浏览器进程 (Browser Process)&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>大管家&lt;/strong>：负责界面显示、用户交互、子进程管理、存储功能。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>渲染进程 (Renderer Process)&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>核心工匠&lt;/strong>：负责将 HTML、CSS 和 JavaScript 转换为用户可见的网页。&lt;/li>
&lt;li>Blink 排版引擎和 V8 引擎运行在此。&lt;/li>
&lt;li>出于安全，运行在沙箱模式下。默认每个 Tab 一个进程。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>GPU 进程&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>图形加速&lt;/strong>：最初用于 3D CSS，现在广泛用于网页和 UI 的绘制加速。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>网络进程 (Network Process)&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>物资运输&lt;/strong>：负责页面的网络资源加载。它之前是浏览器进程内的一个模块，现在独立出来，提升了稳定性和性能。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>插件进程 (Plugin Process)&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>外包隔离&lt;/strong>：负责插件的运行。因插件易崩溃，必须严格隔离。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="多进程的代价">多进程的代价：&lt;/h3>
&lt;p>虽然提升了体验，但也带来了新问题：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>资源占用高&lt;/strong>：每个进程都有独立的副本（如 V8 引擎环境），消耗更多内存。&lt;/li>
&lt;li>&lt;strong>架构复杂&lt;/strong>：模块间耦合度高，扩展性变差，难以适应新需求。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="四未来面向服务的架构-soa">四、未来：面向服务的架构 (SOA)&lt;/h2>
&lt;p>为了解决架构臃肿问题，2016 年起，Chrome 团队开始向 &lt;strong>“面向服务的架构” (Services Oriented Architecture)&lt;/strong> 转型。&lt;/p>
&lt;p>核心思想是将原来的各种模块重构为&lt;strong>独立的服务 (Service)&lt;/strong>。&lt;/p>
&lt;ul>
&lt;li>每个服务可以在独立的进程中运行。&lt;/li>
&lt;li>访问服务必须通过定义好的接口（IPC）。&lt;/li>
&lt;li>&lt;strong>目标&lt;/strong>：构建一个更内聚、松耦合、易于维护的系统。&lt;/li>
&lt;/ul>
&lt;p>Chrome 最终要把 UI、数据库、文件、设备、网络等模块重构为类似操作系统底层的“基础服务”。&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/chrome-6.jpg"
loading="lazy"
alt="Chrome 面向服务架构模型图"
>&lt;/p>
&lt;hr>
&lt;h2 id="总结">总结&lt;/h2>
&lt;ol>
&lt;li>&lt;strong>单进程时代&lt;/strong>：不稳定、卡顿、不安全，但架构简单。&lt;/li>
&lt;li>&lt;strong>多进程时代&lt;/strong>：Chrome 创造性地引入多进程，利用&lt;strong>进程隔离&lt;/strong>和&lt;strong>沙箱&lt;/strong>解决了旧时代的难题，但也导致了内存占用高和架构复杂。&lt;/li>
&lt;li>&lt;strong>SOA 时代&lt;/strong>：为了适应移动设备、VR 等新场景，Chrome 正将架构重构为&lt;strong>面向服务&lt;/strong>的形式，以实现更优的性能和扩展性。&lt;/li>
&lt;/ol>
&lt;p>Chrome 的进化速度极快，越来越多的业务（如视频编辑、3D 游戏）正在迁移到浏览器端。作为开发者，理解浏览器的底层架构，能帮助我们更好地把握这波技术红利。&lt;/p></description></item><item><title>深入理解 TCP 协议</title><link>https://changxiangyu.cn/p/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-tcp-%E5%8D%8F%E8%AE%AE/</link><pubDate>Wed, 18 Jun 2025 14:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-tcp-%E5%8D%8F%E8%AE%AE/</guid><description>&lt;h2 id="一个数据包的旅程">一个数据包的“旅程”&lt;/h2>
&lt;h3 id="1-ip把数据包送达目的主机">1. IP：把数据包送达目的主机&lt;/h3>
&lt;p>计算机在网络中的地址称为 &lt;strong>IP 地址&lt;/strong>。访问任何网站，本质上都是你的计算机向另一台计算机请求信息的过程。&lt;/p>
&lt;p>&lt;strong>简化的 IP 网络三层传输模型：&lt;/strong>
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/t-1.jpg"
loading="lazy"
alt="IP 网络三层传输模型示意图"
>&lt;/p>
&lt;h3 id="2-udp把数据包送达应用程序">2. UDP：把数据包送达应用程序&lt;/h3>
&lt;p>IP 协议负责将数据包发送给指定的计算机，但这还不够，因为计算机上运行着各种不同的程序。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>定义&lt;/strong>：“用户数据包协议（User Datagram Protocol）”，简称 &lt;strong>UDP&lt;/strong>。&lt;/li>
&lt;li>&lt;strong>作用&lt;/strong>：UDP 中最重要的信息是&lt;strong>端口号&lt;/strong>。IP 通过 IP 地址把数据包发送给指定的电脑，而 UDP 通过端口号把数据包分发给正确的程序。&lt;/li>
&lt;li>&lt;strong>特点&lt;/strong>：UDP 不保证数据的可靠性，但传输速度非常快，适用于对实时性要求高但对丢包不敏感的应用（如视频会议、在线游戏）。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>简化的 UDP 网络四层传输模型：&lt;/strong>
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/t-2.jpg"
loading="lazy"
alt="UDP 网络四层传输模型示意图"
>&lt;/p>
&lt;h3 id="3-tcp把数据完整地送达应用程序">3. TCP：把数据完整地送达应用程序&lt;/h3>
&lt;p>对于要求数据传输**可靠性（Reliability）**的应用，如果直接使用 UDP 传输会面临两个主要问题：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>丢包&lt;/strong>：数据包在传输过程中容易丢失。&lt;/li>
&lt;li>&lt;strong>乱序&lt;/strong>：大文件会被拆分成多个小数据包传输，这些数据包可能经过不同的路由、在不同时间到达。UDP 无法将这些乱序包还原为原始文件。&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>TCP（Transmission Control Protocol，传输控制协议）&lt;/strong> 是一种面向连接的、可靠的、基于字节流的传输层通信协议。相对于 UDP，TCP 具备以下核心特点：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>重传机制&lt;/strong>：针对数据包丢失的情况，TCP 提供重传功能。&lt;/li>
&lt;li>&lt;strong>排序机制&lt;/strong>：TCP 引入了数据包排序，保证乱序到达的数据包能被重新组合成完整的文件。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>简化的 TCP 网络四层传输模型：&lt;/strong>
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/t-3.jpg"
loading="lazy"
alt="TCP 网络四层传输模型示意图"
>&lt;/p>
&lt;h4 id="tcp-连接的生命周期">TCP 连接的生命周期&lt;/h4>
&lt;p>一个完整的 TCP 连接生命周期包含三个阶段：“&lt;strong>建立连接&lt;/strong>”、“&lt;strong>传输数据&lt;/strong>”和“&lt;strong>断开连接&lt;/strong>”。&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/t-4.jpg"
loading="lazy"
alt="TCP 生命周期示意图"
>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>建立连接阶段&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>该阶段通过“&lt;strong>三次握手&lt;/strong>”来建立客户端和服务器之间的连接。&lt;/li>
&lt;li>TCP 提供面向连接的通信传输。&lt;strong>面向连接&lt;/strong>是指在数据通信开始之前，先做好两端之间的准备工作。&lt;/li>
&lt;li>&lt;strong>三次握手&lt;/strong>：指在建立一个 TCP 连接时，客户端和服务器总共要发送三个数据包以确认连接的建立。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>传输数据阶段&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>在该阶段，&lt;strong>接收端需要对每个数据包进行确认操作&lt;/strong>。即接收端收到数据包后，需发送确认数据包给发送端。&lt;/li>
&lt;li>&lt;strong>重发机制&lt;/strong>：若发送端在规定时间内未收到确认消息，则判断数据包丢失，触发重发。&lt;/li>
&lt;li>&lt;strong>排序重组&lt;/strong>：大文件被拆分的小数据包到达接收端后，接收端会根据 TCP 头中的序号进行排序，从而保证组成完整的数据。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>断开连接阶段&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>数据传输完毕后，需要终止连接。&lt;/li>
&lt;li>此阶段涉及“&lt;strong>四次挥手&lt;/strong>”，以确保双方都能安全断开连接，释放资源。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="总结">总结&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>数据包传输&lt;/strong>：互联网中的数据通过数据包传输，传输过程面临丢失或出错的风险。&lt;/li>
&lt;li>&lt;strong>IP 协议&lt;/strong>：负责将数据包准确送达目的主机。&lt;/li>
&lt;li>&lt;strong>UDP 协议&lt;/strong>：负责通过端口号将数据包分发给具体的应用程序，速度快但不可靠。&lt;/li>
&lt;li>&lt;strong>TCP 协议&lt;/strong>：保证数据的完整性和可靠性。其连接生命周期分为三个阶段：
&lt;ol>
&lt;li>建立连接（三次握手）&lt;/li>
&lt;li>传输数据（确认、重传、排序）&lt;/li>
&lt;li>断开连接（四次挥手）&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul></description></item><item><title>HTTP请求流程</title><link>https://changxiangyu.cn/p/http%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B/</link><pubDate>Tue, 08 Apr 2025 13:06:18 +0800</pubDate><guid>https://changxiangyu.cn/p/http%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B/</guid><description>&lt;h2 id="浏览器端发起-http-请求流程">浏览器端发起 HTTP 请求流程&lt;/h2>
&lt;h3 id="1-构建请求-build-request">1. 构建请求 (Build Request)&lt;/h3>
&lt;p>首先，浏览器构建请求行信息，构建好后，浏览器准备发起网络请求。
&lt;code>GET /index.html HTTP1.1&lt;/code>&lt;/p>
&lt;h3 id="2-查找缓存-check-cache">2. 查找缓存 (Check Cache)&lt;/h3>
&lt;p>在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件。其中，&lt;strong>浏览器缓存是一种在本地保存资源副本，以供下次请求时直接使用的技术。&lt;/strong> 当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。这样做的好处有：&lt;/p>
&lt;ul>
&lt;li>缓解服务器端压力，提升性能（获取资源的耗时更短了）；&lt;/li>
&lt;li>对于网站来说，缓存是实现快速资源加载的重要组成部分。&lt;/li>
&lt;/ul>
&lt;h3 id="3-准备-ip-地址和端口-dns-resolution">3. 准备 IP 地址和端口 (DNS Resolution)&lt;/h3>
&lt;p>因为浏览器使用 &lt;strong>HTTP 协议作为应用层协议&lt;/strong>，用来封装请求的文本信息；并使用 &lt;strong>TCP/IP 作传输层协议&lt;/strong>将它发到网络上，所以在 HTTP 工作开始之前，浏览器需要通过 TCP 与服务器建立连接。也就是说 &lt;strong>HTTP 的内容是通过 TCP 的传输数据阶段来实现的&lt;/strong>
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-1.jpg"
loading="lazy"
alt="展示完整流程示意图"
>&lt;/p>
&lt;p>&lt;strong>第一步浏览器会请求 DNS 返回域名对应的 IP&lt;/strong>。当然浏览器还提供了 DNS 数据缓存服务，如果某个域名已经解析过了，那么浏览器会缓存解析的结果，以供下次查询时直接使用，这样也会减少一次网络请求。拿到 IP 之后，接下来就需要获取端口号了。通常情况下，如果 URL 没有特别指明端口号，那么 HTTP 协议默认是 80 端口。&lt;/p>
&lt;h3 id="4-等待-tcp-队列-queueing">4. 等待 TCP 队列 (Queueing)&lt;/h3>
&lt;p>Chrome 有个机制，同一个域名同时最多只能建立 6 个 TCP 连接，如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队等待状态，直至进行中的请求完成。当然，如果当前请求数量少于 6，会直接进入下一步，建立 TCP 连接。
背景：这是 HTTP/1.1 协议下的浏览器限制，导致了“队头阻塞”问题。
优化：现在的 HTTP/2 协议支持多路复用 (Multiplexing)，可以在一个 TCP 连接中并发处理无数个请求，从而突破了这 6 个连接的限制，极大提升了加载效率。&lt;/p>
&lt;h3 id="5-建立-tcp-连接-tcp-handshake">5. 建立 TCP 连接 (TCP Handshake)&lt;/h3>
&lt;p>排队等待结束之后，终于可以快乐地和服务器握手了，在 HTTP 工作开始之前，浏览器通过 TCP 与服务器建立连接。&lt;/p>
&lt;h3 id="6-发送-http-请求-send-request">6. 发送 HTTP 请求 (Send Request)&lt;/h3>
&lt;p>一旦建立了 TCP 连接，浏览器就可以和服务器进行通信了。而 HTTP 中的数据正是在这个通信过程中传输的。
HTTP 请求数据格式
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-2.jpg"
loading="lazy"
alt="展示示意图"
>&lt;/p>
&lt;h2 id="服务器端处理-http-请求流程">服务器端处理 HTTP 请求流程&lt;/h2>
&lt;h3 id="1-返回请求-server-response">1. 返回请求 (Server Response)&lt;/h3>
&lt;ul>
&lt;li>服务器响应的数据格式
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-3.jpg"
loading="lazy"
alt="展示示意图"
>&lt;/li>
&lt;li>首先服务器会返回响应行，包括协议版本和状态码。&lt;/li>
&lt;li>那么一些无法处理或者处理出错的信息，服务器会通过请求行的状态码来告诉浏览器它的处理结果&lt;/li>
&lt;li>服务器也会随同响应向浏览器发送响应头。响应头包含了服务器自身的一些信息，比如服务器生成返回数据的时间、返回的数据类型（JSON、HTML、流媒体等类型），以及服务器要在客户端保存的 Cookie 等信息。发送完响应头后，服务器就可以继续发送响应体的数据，通常，响应体就包含了 HTML 的实际内容。&lt;/li>
&lt;/ul>
&lt;h3 id="2-断开连接-connection-handling">2. 断开连接 (Connection Handling)&lt;/h3>
&lt;p>通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。不过如果浏览器或者服务器在其头信息中加入了：&lt;code>Connection:Keep-Alive&lt;/code> ，那么 TCP 连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个 TCP 连接发送请求。&lt;strong>保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度&lt;/strong>&lt;/p>
&lt;h3 id="3-重定向-redirect">3. 重定向 (Redirect)&lt;/h3>
&lt;ul>
&lt;li>当你在浏览器中打开 &lt;a class="link" href="geekbang.org" >&lt;/a> 后，你会发现最终打开的页面地址是 &lt;a class="link" href="https://www.geekbang.org" target="_blank" rel="noopener"
>&lt;/a>。这两个 URL 之所以不一样，是因为涉及到了一个&lt;strong>重定向操作&lt;/strong>。&lt;/li>
&lt;li>在控制台输入如下命令：curl -I geekbang.org注意这里输入的参数是-I，和-i不一样，-I表示只需要获取响应头和响应行数据，而不需要获取响应体的数据，最终返回的数据如下图所示：
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-4.jpg"
loading="lazy"
alt="展示示意图"
>&lt;/li>
&lt;li>响应行返回的状态码是 301，状态 301 就是告诉浏览器，我需要重定向到另外一个网址，而需要重定向的网址正是包含在响应头的 Location 字段中，接下来，浏览器获取 Location 字段中的地址，并使用该地址重新导航，这就是一个完整重定向的执行流程。&lt;/li>
&lt;li>301 (Moved Permanently)：永久重定向。浏览器会缓存这个重定向，下次直接去新地址，不再请求旧地址（SEO 友好）。&lt;/li>
&lt;li>302 (Found)：临时重定向。浏览器不会缓存重定向关系，每次还是先去旧地址，再被踢到新地址。&lt;/li>
&lt;/ul>
&lt;h2 id="1-为什么很多站点第二次打开速度会很快">1. 为什么很多站点第二次打开速度会很快？&lt;/h2>
&lt;ul>
&lt;li>主要原因是第一次加载页面过程中，缓存了一些耗时的数据&lt;/li>
&lt;li>DNS 缓存和页面资源缓存这两块数据是会被浏览器缓存的。DNS 缓存主要就是在浏览器本地把对应的 IP 和域名关联起来&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>强缓存 (本地直接用)
&lt;ul>
&lt;li>标志：Cache-Control: Max-age=2000 (HTTP/1.1) 或 Expires (HTTP/1.0)。&lt;/li>
&lt;li>行为：浏览器直接判断资源未过期，不向服务器发送任何请求，直接从磁盘/内存读取。状态码通常显示为 200 (from memory cache / disk cache)。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>协商缓存 (问问服务器能不能用)
&lt;ul>
&lt;li>标志：If-None-Match (对应 ETag) 或 If-Modified-Since (对应 Last-Modified)。&lt;/li>
&lt;li>行为：强缓存失效后，浏览器发送请求询问服务器。&lt;/li>
&lt;li>如果服务器说“没变”：返回 304 Not Modified，浏览器继续用旧的。&lt;/li>
&lt;li>如果服务器说“变了”：返回 200 OK 和新内容。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>
&lt;p>缓存查找流程示意图
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-5.jpg"
loading="lazy"
alt="展示示意图"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>从上图的第一次请求可以看出，当服务器返回 HTTP 响应头给浏览器时，浏览器是&lt;strong>通过响应头中的 Cache-Control 字段来设置是否缓存该资源&lt;/strong>。通常，我们还需要为这个资源设置一个缓存过期时长，而这个时长是通过 &lt;code>Cache-Control&lt;/code> 中的 &lt;code>Max-age&lt;/code> 参数来设置的，比如上图设置的缓存过期时间是 2000 秒。
&lt;code>Cache-Control:Max-age=2000&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>这也就意味着，在该缓存资源还未过期的情况下, 如果再次请求该资源，会直接返回缓存中的资源给浏览器。但如果缓存过期了，浏览器则会继续发起网络请求，并且在 &lt;strong>HTTP 请求头&lt;/strong>中带上：
&lt;code>If-None-Match:&amp;quot;4f80f-13c-3a1xb12a&amp;quot;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>服务器收到请求头后，会根据 &lt;code>If-None-Match&lt;/code> 的值来判断请求的资源是否有更新。&lt;/p>
&lt;ul>
&lt;li>如果没有更新，就返回 304 状态码，相当于服务器告诉浏览器：“这个缓存可以继续使用，这次就不重复发送数据给你了。”&lt;/li>
&lt;li>如果资源有更新，服务器就直接返回最新资源给浏览器。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="2-登录状态是如何保持的">2. 登录状态是如何保持的？&lt;/h2>
&lt;ul>
&lt;li>用户打开登录页面，在登录框里填入用户名和密码，点击确定按钮。点击按钮会触发页面脚本生成用户登录信息，然后调用 POST 方法提交用户登录信息给服务器。&lt;/li>
&lt;li>服务器接收到浏览器提交的信息之后，查询后台，验证用户登录信息是否正确，如果正确的话，会生成一段表示用户身份的字符串，并把该字符串写到响应头的 Set-Cookie 字段里，如下所示，然后把响应头发送给浏览器。
&lt;code>Set-Cookie: UID=3431uad;&lt;/code>&lt;/li>
&lt;li>浏览器在接收到服务器的响应头后，开始解析响应头，如果遇到响应头里含有 Set-Cookie 字段的情况，浏览器就会把这个字段信息保存到本地。比如把UID=3431uad保持到本地。&lt;/li>
&lt;li>当用户再次访问时，浏览器会发起 HTTP 请求，但在发起请求之前，浏览器会读取之前保存的 Cookie 数据，并把数据写进请求头里的 Cookie 字段里（如下所示），然后浏览器再将请求头发送给服务器。
&lt;code>Cookie: UID=3431uad;&lt;/code>&lt;/li>
&lt;li>服务器在收到 HTTP 请求头数据之后，就会查找请求头里面的“Cookie”字段信息，当查找到包含UID=3431uad的信息时，服务器查询后台，并判断该用户是已登录状态，然后生成含有该用户信息的页面数据，并把生成的数据发送给浏览器。&lt;/li>
&lt;li>浏览器在接收到该含有当前用户的页面数据后，就可以正确展示用户登录的状态信息了。&lt;/li>
&lt;li>Cookie 流程图
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-6.jpg"
loading="lazy"
alt="展示示意图"
>&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>HTTP 请求流程示意图
&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/h-7.jpg"
loading="lazy"
alt="HTTP 请求流程示意图"
>&lt;/p></description></item><item><title>导航流程</title><link>https://changxiangyu.cn/p/%E5%AF%BC%E8%88%AA%E6%B5%81%E7%A8%8B/</link><pubDate>Thu, 30 Jan 2025 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%AF%BC%E8%88%AA%E6%B5%81%E7%A8%8B/</guid><description>&lt;h2 id="从输入-url-到页面展示这中间发生了什么">从输入 URL 到页面展示，这中间发生了什么？&lt;/h2>
&lt;ul>
&lt;li>从输入 URL 到页面展示完整流程示意图：&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/browser.jpg"
loading="lazy"
alt="从输入 URL 到页面展示完整流程示意图"
>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>浏览器进程&lt;/strong>：主要负责用户交互、子进程管理和文件储存等功能。&lt;/li>
&lt;li>&lt;strong>网络进程&lt;/strong>：面向渲染进程和浏览器进程等提供网络下载功能。&lt;/li>
&lt;li>&lt;strong>渲染进程&lt;/strong>：主要职责是把从网络下载的 HTML、JavaScript、CSS、图片等资源解析为可以显示和交互的页面。
&lt;ul>
&lt;li>因为渲染进程所有的内容都是通过网络获取的，会存在一些恶意代码利用浏览器漏洞对系统进行攻击，所以运行在渲染进程里面的代码是不被信任的。&lt;/li>
&lt;li>这也是为什么 Chrome 会让渲染进程运行在安全沙箱里，就是为了保证系统的安全。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>简要流程：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>首先，浏览器进程接收到用户输入的 URL 请求，浏览器进程便将该 URL 转发给网络进程。&lt;/li>
&lt;li>然后，在网络进程中发起真正的 URL 请求。&lt;/li>
&lt;li>接着网络进程接收到了响应头数据，便解析响应头数据，并将数据转发给浏览器进程。&lt;/li>
&lt;li>浏览器进程接收到网络进程的响应头数据之后，发送“提交导航 (CommitNavigation)”消息到渲染进程。&lt;/li>
&lt;li>渲染进程接收到“提交导航”的消息之后，便开始准备接收 HTML 数据，接收数据的方式是直接和网络进程建立数据管道。&lt;/li>
&lt;li>最后渲染进程会向浏览器进程“确认提交”，这是告诉浏览器进程：“已经准备好接受和解析页面数据了”。&lt;/li>
&lt;li>浏览器进程接收到渲染进程“提交文档”的消息之后，便开始移除之前旧的文档，然后更新浏览器进程中的页面状态。&lt;/li>
&lt;/ol>
&lt;p>用户发出 URL 请求到页面开始解析的这个过程，就叫做 &lt;strong>导航&lt;/strong>。&lt;/p>
&lt;hr>
&lt;h1 id="详细阶段解析">详细阶段解析&lt;/h1>
&lt;h3 id="1-用户输入">1. 用户输入&lt;/h3>
&lt;p>当用户在地址栏中输入一个查询关键字时，地址栏会判断输入的关键字是 &lt;strong>搜索内容&lt;/strong>，还是 &lt;strong>请求的 URL&lt;/strong>。&lt;/p>
&lt;ul>
&lt;li>如果是搜索内容，地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的 URL。&lt;/li>
&lt;li>如果判断输入内容符合 URL 规则，比如输入的是 &lt;code>time.geekbang.org&lt;/code>，那么地址栏会根据规则，把这段内容加上协议，合成为完整的 URL，如 &lt;code>https://time.geekbang.org&lt;/code>。&lt;/li>
&lt;/ul>
&lt;p>当用户输入关键字并键入回车之后，这意味着当前页面即将要被替换成新的页面。不过在这个流程继续之前，浏览器还给了当前页面一次执行 &lt;code>beforeunload&lt;/code> 事件的机会。&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>beforeunload&lt;/code> 事件允许页面在退出之前执行一些数据清理操作，还可以询问用户是否要离开当前页面，比如当前页面可能有未提交完成的表单等情况，因此用户可以通过 &lt;code>beforeunload&lt;/code> 事件来取消导航，让浏览器不再执行任何后续工作。&lt;/p>
&lt;/blockquote>
&lt;p>当浏览器刚开始加载一个地址之后，标签页上的图标便进入了加载状态。但此时图中页面显示的依然是之前打开的页面内容，并没立即替换为极客时间的页面。因为需要等待提交文档阶段，页面内容才会被替换。&lt;/p>
&lt;h3 id="2-url-请求过程">2. URL 请求过程&lt;/h3>
&lt;p>浏览器进程会通过进程间通信（IPC）把 URL 请求发送至网络进程，网络进程接收到 URL 请求后，会在这里发起真正的 URL 请求流程。&lt;/p>
&lt;ol>
&lt;li>首先，网络进程会查找本地缓存是否缓存了该资源。如果有缓存资源，那么直接返回资源给浏览器进程；如果在缓存中没有查找到资源，那么直接进入网络请求流程。&lt;/li>
&lt;li>这请求前的第一步是要进行 DNS 解析，以获取请求域名的服务器 IP 地址。如果请求协议是 HTTPS，那么还需要建立 TLS 连接。&lt;/li>
&lt;li>接下来就是利用 IP 地址和服务器建立 TCP 连接。连接建立之后，浏览器端会构建请求行、请求头等信息，并把和该域名相关的 Cookie 等数据附加到请求头中，然后向服务器发送构建的请求信息。&lt;/li>
&lt;li>服务器接收到请求信息后，会根据请求信息生成响应数据（包括响应行、响应头和响应体等信息），并发给网络进程。等网络进程接收了响应行和响应头之后，就开始解析响应头的内容了。&lt;/li>
&lt;/ol>
&lt;p>在导航过程中，如果服务器响应行的状态码包含了 301、302 一类的跳转信息，浏览器会跳转到新的地址继续导航；如果响应行是 200，那么表示浏览器可以继续处理该请求。&lt;/p>
&lt;h4 id="1重定向">（1）重定向&lt;/h4>
&lt;p>在接收到服务器返回的响应头后，网络进程开始解析响应头，如果发现返回的状态码是 301 或者 302，那么说明服务器需要浏览器重定向到其他 URL。这时网络进程会从响应头的 &lt;code>Location&lt;/code> 字段里面读取重定向的地址，然后再发起新的 HTTP 或者 HTTPS 请求，一切又重头开始了。&lt;/p>
&lt;p>使用 &lt;code>curl -I + URL&lt;/code> 的命令可以接收服务器返回的响应头的信息。&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/2.jpg"
loading="lazy"
alt="响应头的信息示意图"
>&lt;/p>
&lt;p>HTTP 向极客时间服务器请求时，服务器会返回一个包含有 301 或者 302 状态码响应头，并把响应头的 &lt;code>Location&lt;/code> 字段中填上 HTTPS 的地址，这就是告诉了浏览器要重新导航到新的地址上。&lt;/p>
&lt;h4 id="2响应数据类型处理">（2）响应数据类型处理&lt;/h4>
&lt;p>&lt;code>Content-Type&lt;/code> 是 HTTP 头中一个非常重要的字段， 它告诉浏览器服务器返回的响应体数据是什么类型。&lt;/p>
&lt;p>&lt;strong>案例 A：HTML 类型&lt;/strong>
执行命令：&lt;code>curl -I https://time.geekbang.org/&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/3.jpg"
loading="lazy"
alt="响应数据类型处理示意图"
>&lt;/p>
&lt;p>响应头中的 &lt;code>Content-type&lt;/code> 字段的值是 &lt;code>text/html&lt;/code>，这就是告诉浏览器，服务器返回的数据是 &lt;strong>HTML 格式&lt;/strong>。&lt;/p>
&lt;p>&lt;strong>案例 B：下载类型&lt;/strong>
执行命令：&lt;code>curl -I https://res001.geekbang.org/.../geektime.apk&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/browser-principles-and-practice/4.jpg"
loading="lazy"
alt="响应数据类型处理示意图"
>&lt;/p>
&lt;p>从返回的响应头信息来看，其 &lt;code>Content-Type&lt;/code> 的值是 &lt;code>application/octet-stream&lt;/code>，显示数据是 &lt;strong>字节流类型&lt;/strong> 的，通常情况下，浏览器会按照 &lt;strong>下载类型&lt;/strong> 来处理该请求。&lt;/p>
&lt;p>如果 &lt;code>Content-Type&lt;/code> 字段的值被浏览器判断为下载类型，那么该请求会被提交给浏览器的下载管理器，同时该 URL 请求的导航流程就此结束。但如果是 HTML，那么浏览器则会继续进行导航流程。&lt;/p>
&lt;h3 id="3-准备渲染进程">3. 准备渲染进程&lt;/h3>
&lt;p>那什么情况下多个页面会同时运行在一个渲染进程中呢？&lt;/p>
&lt;p>&lt;strong>同一站点（same-site）&lt;/strong>：定义为 &lt;strong>根域名&lt;/strong>（例如，&lt;code>geekbang.org&lt;/code>）加上 &lt;strong>协议&lt;/strong>（例如，&lt;code>https://&lt;/code> 或者 &lt;code>http://&lt;/code>），还包含了该根域名下的所有子域名和不同的端口。&lt;/p>
&lt;p>Chrome 的默认策略是，每个标签对应一个渲染进程。但 &lt;strong>如果从一个页面打开了另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面会复用父页面的渲染进程&lt;/strong>。官方把这个默认策略叫 &lt;code>process-per-site-instance&lt;/code>。&lt;/p>
&lt;p>总结来说，打开一个新页面采用的 &lt;strong>渲染进程策略&lt;/strong> 就是：&lt;/p>
&lt;ul>
&lt;li>通常情况下，打开新的页面都会使用单独的渲染进程；&lt;/li>
&lt;li>如果从 A 页面打开 B 页面，且 A 和 B 都属于 &lt;strong>同一站点&lt;/strong> 的话，那么 B 页面复用 A 页面的渲染进程；&lt;/li>
&lt;li>如果是其他情况，浏览器进程则会为 B 创建一个新的渲染进程。&lt;/li>
&lt;/ul>
&lt;p>渲染进程准备好之后，还不能立即进入文档解析状态，因为此时的文档数据还在网络进程中，并没有提交给渲染进程。&lt;/p>
&lt;h3 id="4-提交文档">4. 提交文档&lt;/h3>
&lt;p>所谓提交文档，就是指浏览器进程将网络进程接收到的 HTML 数据提交给渲染进程。&lt;/p>
&lt;ol>
&lt;li>首先当浏览器进程接收到网络进程的响应头数据之后，便向渲染进程发起“提交文档”的消息；&lt;/li>
&lt;li>渲染进程接收到“提交文档”的消息后，会和网络进程建立传输数据的“管道”；&lt;/li>
&lt;li>等文档数据传输完成之后，渲染进程会返回“确认提交”的消息给浏览器进程；&lt;/li>
&lt;li>浏览器进程在收到“确认提交”的消息后，会更新浏览器界面状态，包括了安全状态、地址栏的 URL、前进后退的历史状态，并更新 Web 页面。&lt;/li>
&lt;/ol>
&lt;p>到这里，一个完整的导航流程就“走”完了，这之后就要进入渲染阶段了。&lt;/p>
&lt;h3 id="5-渲染阶段">5. 渲染阶段&lt;/h3>
&lt;p>一旦文档被提交，渲染进程便开始页面解析和子资源加载了。一旦页面生成完成，渲染进程会发送一个消息给浏览器进程，浏览器接收到消息后，会停止标签图标上的加载动画。&lt;/p>
&lt;h3 id="总结">总结&lt;/h3>
&lt;p>服务器可以根据响应头来控制浏览器的行为，如跳转、网络数据类型判断。&lt;/p>
&lt;p>Chrome 默认采用每个标签对应一个渲染进程，但是如果两个页面属于同一站点，那这两个标签会使用同一个渲染进程。&lt;/p>
&lt;p>浏览器的导航过程涵盖了从用户发起请求到提交文档给渲染进程的中间所有阶段。&lt;/p>
&lt;ol>
&lt;li>浏览器进程（Browser Process）主导：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>处理输入：区分是搜索关键字还是 URL。&lt;/li>
&lt;li>生命周期管理：触发 beforeunload 事件（允许页面清理或取消导航）。&lt;/li>
&lt;li>状态更新：加载动画开始，但页面内容需等待“提交文档”后才替换。&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>网络进程（Network Process）执行：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>资源查找：先查本地缓存，无缓存则发起网络请求。&lt;/li>
&lt;li>建立连接：DNS 解析 -&amp;gt; 建立 TCP 连接 -&amp;gt; 构建请求头/Cookie。&lt;/li>
&lt;li>处理响应：
&lt;ul>
&lt;li>重定向：若遇 301/302，读取 Location 重新发起请求。&lt;/li>
&lt;li>类型判断：通过 Content-Type 判断是下载（application/octet-stream）还是 HTML 导航（text/html）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>准备渲染进程（Render Process）：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>默认策略：通常每个标签页一个进程。&lt;/li>
&lt;li>同一站点（Same-site）策略：如果新页面与旧页面属于同一站点（根域名+协议相同），则复用父页面的渲染进程（process-per-site-instance）。&lt;/li>
&lt;/ul>
&lt;ol start="4">
&lt;li>提交文档（Commit Navigation）：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>这是导航流程的终点。浏览器进程通知渲染进程，渲染进程与网络进程建立数据管道接收 HTML。&lt;/li>
&lt;li>一旦确认提交，旧文档被移除，界面 UI（地址栏、后退按钮等）正式更新。&lt;/li>
&lt;/ul></description></item><item><title>Angular + Ng-Zorro 模态框拖拽功能</title><link>https://changxiangyu.cn/p/angular--ng-zorro-%E6%A8%A1%E6%80%81%E6%A1%86%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD/</link><pubDate>Mon, 22 Jan 2024 10:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/angular--ng-zorro-%E6%A8%A1%E6%80%81%E6%A1%86%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD/</guid><description>&lt;h2 id="基本原理">基本原理&lt;/h2>
&lt;p>通过监听鼠标的按下（mousedown），弹起（mouseup），移动（mousemove）三个事件来计算移动的距离，从而调整模态框的新位置。&lt;/p>
&lt;ul>
&lt;li>鼠标按下（mousedown）：
&lt;ul>
&lt;li>记录鼠标按下时的位置和弹窗当前的位置，并设置弹窗左侧和顶部边距为当前位置；&lt;/li>
&lt;li>将 &lt;code>canMove&lt;/code> 标志设置为 &lt;code>true&lt;/code>，表示模态框可以移动。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>鼠标弹起（mouseup）：
&lt;ul>
&lt;li>将 &lt;code>canMove&lt;/code> 标志设置为 &lt;code>false&lt;/code>，表示停止移动模态框。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>鼠标移动（mousemove）：
&lt;ul>
&lt;li>如果 &lt;code>canMove&lt;/code> 为 &lt;code>true&lt;/code>，则计算鼠标移动距离。&lt;/li>
&lt;li>根据鼠标的移动距离调整模态框的新位置，使用渲染器设置模态框的新左侧和顶部偏移值，从而实现拖拽效果。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="通过nz-modal模板生成的弹窗">通过nz-modal模板生成的弹窗&lt;/h2>
&lt;p>实现步骤：&lt;/p>
&lt;h3 id="1通过指令来绑定拖拽方法-drag-modaldirectivets-">1.通过指令来绑定拖拽方法( drag-modal.directive.ts )：&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { Directive, Input } from &amp;#39;@angular/core&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { NzModalRef } from &amp;#39;ng-zorro-antd/modal&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { ModalDragService } from &amp;#39;./drag-modal.service.ts&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@Directive({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector: &amp;#39;[dragModal]&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export class DragModalDirective {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Input() dragModal: NzModalRef;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> constructor(private modalDragService: ModalDragService) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ngAfterViewInit() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> setTimeout(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.modalDragService.enableModalDrag(this.dragModal);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }, 1000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2注册模块-modal-dragmodulets">2.注册模块 (modal-drag.module.ts)&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { NgModule } from &amp;#39;@angular/core&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { CommonModule } from &amp;#39;@angular/common&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { DragModalDirective } from &amp;#34;./drag-modal.directive&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { ModalDragService } from &amp;#39;./drag-modal.service.ts&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@NgModule({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> providers: [ModalDragService],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> declarations: [DragModalDirective],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imports: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CommonModule,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> exports: [DragModalDirective]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export class ModalDragModule { }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用方法：&lt;/p>
&lt;ol>
&lt;li>将 &lt;code>ModalDragModule&lt;/code> 导入到需要使用弹窗拖拽的功能模块中。&lt;/li>
&lt;li>在 &lt;code>&amp;lt;nz-modal&amp;gt;&lt;/code> 标签中增加一个模板引用变量（例如 &lt;code>#modal&lt;/code>）。&lt;/li>
&lt;li>将该变量传递给 &lt;code>dragModal&lt;/code> 指令。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-1.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-2.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="通过nzmodalservice服务创建的弹窗">通过NzModalService服务创建的弹窗&lt;/h2>
&lt;p>实现步骤：
利用服务把事件绑定在modal的header上，通过控制mousedown,mouseup,mousemove，来实现拖拽&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { Injectable, RendererFactory2 } from &amp;#39;@angular/core&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@Injectable({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> providedIn: &amp;#39;root&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export class ModalDragService {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> constructor(private rendererFactory2: RendererFactory2,) { }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 激活弹窗拖拽
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enableModalDrag(refModal) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> refModal.afterOpen.subscribe(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const render = this.rendererFactory2.createRenderer(null, null);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 整个悬浮层的dom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const modalBackground = refModal.getElement();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 弹窗的dom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const modalElement = refModal.getElement().querySelector(&amp;#39;.ant-modal-content&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 弹窗header的dom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const modalTitleElement = this.createModalTitleElement(render, modalElement);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 绑定拖拽事件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.dragListen(render, modalTitleElement, modalElement, modalBackground);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 自定义弹窗header拖拽区域的大小
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> createModalTitleElement(render, modalElement) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let element = document.createElement(&amp;#39;div&amp;#39;) as any;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;width&amp;#39;, &amp;#39;100%&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;height&amp;#39;, &amp;#39;54px&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;position&amp;#39;, &amp;#39;absolute&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;top&amp;#39;, &amp;#39;0&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;left&amp;#39;, &amp;#39;0&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;cursor&amp;#39;, &amp;#39;move&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-moz-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-webkit-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-ms-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-khtml-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.appendChild(modalElement, element);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return element;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 监听鼠标的mousedown，mouseup，mousemove事件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dragListen(render, modalTitleElement, modalElement, modalBackground) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.listen(modalTitleElement, &amp;#39;mousedown&amp;#39;, function (event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 记录了鼠标按下时的位置（mouseDownX 和 mouseDownY）。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 获取了模态框当前的位置（modalX 和 modalY）。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 设置模态框的左侧和顶部边距为当前位置。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 将 canMove 标志设置为 true，表示模态框可以移动。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.mouseDownX = event.clientX;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.mouseDownY = event.clientY;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.modalX = modalElement.offsetLeft;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.modalY = modalElement.offsetTop;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;left&amp;#39;, `${this.modalX}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;top&amp;#39;, `${this.modalY}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.canMove = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }.bind(this));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.listen(modalTitleElement, &amp;#39;mouseup&amp;#39;, function (event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 将 canMove 标志设置为 false，表示停止移动模态框
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.canMove = false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }.bind(this));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.listen(modalBackground, &amp;#39;mousemove&amp;#39;, function (event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 如果 canMove 为 true，则计算鼠标移动距离。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 根据鼠标的移动距离调整模态框的新位置。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 使用渲染器设置模态框的新左侧和顶部偏移值，从而实现拖拽效果。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (this.canMove) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let moveX = event.clientX - this.mouseDownX;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let moveY = event.clientY - this.mouseDownY;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let newModalX = this.modalX + moveX;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let newModalY = this.modalY + moveY;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;left&amp;#39;, `${newModalX}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;top&amp;#39;, `${newModalY}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }.bind(this));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在初始化&lt;code>modal&lt;/code>时，使用&lt;code>modalDragService&lt;/code>的&lt;code>enableModalDrag&lt;/code>方法激活拖拽功能；&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-3.png"
loading="lazy"
>&lt;/p>
&lt;p>使用方法：&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-4.png"
loading="lazy"
>&lt;/p></description></item><item><title>NVM 安装与配置完全指南</title><link>https://changxiangyu.cn/p/nvm-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 18 Jan 2024 11:02:00 +0800</pubDate><guid>https://changxiangyu.cn/p/nvm-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</guid><description>&lt;h1 id="nvm-安装与配置完全指南">NVM 安装与配置完全指南&lt;/h1>
&lt;p>NVM (Node Version Manager) 是管理 Node.js 版本的利器，允许您在同一台设备上切换不同版本的 Node.js，以适应不同的项目需求。&lt;/p>
&lt;h2 id="第一步清理旧环境重要">第一步：清理旧环境（重要）&lt;/h2>
&lt;p>&lt;strong>注意：&lt;/strong> 在安装 NVM 之前，必须彻底卸载电脑上现有的 Node.js 版本并删除残留文件，否则极易产生路径冲突。&lt;/p>
&lt;h3 id="windows-用户">Windows 用户&lt;/h3>
&lt;ol>
&lt;li>打开“控制面板” -&amp;gt; “卸载程序”，卸载 Node.js。&lt;/li>
&lt;li>手动检查并删除安装目录（通常为 &lt;code>C:\Program Files\nodejs&lt;/code>）。&lt;/li>
&lt;li>检查用户目录下（&lt;code>C:\Users\用户名&lt;/code>）是否存在 &lt;code>node_modules&lt;/code>、&lt;code>.npm&lt;/code> 或 &lt;code>.npmrc&lt;/code> 文件/文件夹，建议一并删除。&lt;/li>
&lt;/ol>
&lt;h3 id="macos-用户">macOS 用户&lt;/h3>
&lt;ul>
&lt;li>如果之前通过 pkg 安装，建议手动删除 &lt;code>/usr/local/bin/node&lt;/code>、&lt;code>/usr/local/lib/node_modules&lt;/code> 等相关文件。&lt;/li>
&lt;li>如果是通过 Homebrew 安装，运行：&lt;code>brew uninstall node&lt;/code>。&lt;/li>
&lt;/ul>
&lt;h2 id="第二步安装-nvm">第二步：安装 NVM&lt;/h2>
&lt;h3 id="方案-awindows-系统-nvm-windows">方案 A：Windows 系统 (nvm-windows)&lt;/h3>
&lt;h4 id="1-下载与安装">1. 下载与安装&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>下载地址&lt;/strong>：&lt;a class="link" href="https://github.com/coreybutler/nvm-windows/releases" target="_blank" rel="noopener"
>GitHub - nvm-windows releases&lt;/a>&lt;/li>
&lt;li>&lt;strong>操作&lt;/strong>：推荐下载 &lt;code>nvm-setup.exe&lt;/code>。双击运行，按照提示点击“下一步”即可。
&lt;ul>
&lt;li>&lt;em>提示&lt;/em>：安装路径建议保持默认，或者确保路径中&lt;strong>不包含空格和中文字符&lt;/strong>。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="2-环境变量配置-关键步骤">2. 环境变量配置 (关键步骤)&lt;/h4>
&lt;p>虽然安装程序通常会自动配置，但为了确保稳定性，建议手动检查以下配置：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>打开设置&lt;/strong>：右键“此电脑” -&amp;gt; “属性” -&amp;gt; “高级系统设置” -&amp;gt; “环境变量”。&lt;/li>
&lt;li>&lt;strong>检查/新建用户变量&lt;/strong>：&lt;/li>
&lt;/ol>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">变量名&lt;/th>
&lt;th style="text-align:left">变量值示例&lt;/th>
&lt;th style="text-align:left">说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;code>NVM_HOME&lt;/code>&lt;/td>
&lt;td style="text-align:left">&lt;code>C:\Users\YourUser\AppData\Roaming\nvm&lt;/code>&lt;/td>
&lt;td style="text-align:left">NVM 的安装目录&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>NVM_SYMLINK&lt;/code>&lt;/td>
&lt;td style="text-align:left">&lt;code>C:\Program Files\nodejs&lt;/code>&lt;/td>
&lt;td style="text-align:left">Node.js 的快捷方式映射目录&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ol start="3">
&lt;li>&lt;strong>编辑 Path 变量&lt;/strong>：
在“用户变量”或“系统变量”中找到 &lt;code>Path&lt;/code>，点击“编辑”，确保列表中包含以下两项引用：
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">%NVM_HOME%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%NVM_SYMLINK%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>&lt;strong>生效&lt;/strong>：保存设置后，&lt;strong>重启&lt;/strong> CMD 或 PowerShell 窗口。&lt;/li>
&lt;/ol>
&lt;h4 id="3-配置-nvm-国内镜像">3. 配置 NVM 国内镜像&lt;/h4>
&lt;p>为了解决下载慢的问题，请在&lt;strong>管理员权限&lt;/strong>的终端中运行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nvm node_mirror https://npmmirror.com/mirrors/node/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm npm_mirror https://npmmirror.com/mirrors/npm/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="进阶配置自定义-npm-全局路径-windows-推荐">进阶配置：自定义 NPM 全局路径 (Windows 推荐)&lt;/h4>
&lt;p>此步骤可选，但强烈建议配置，以便统一管理全局包（如 vue-cli, yarn）。&lt;/p>
&lt;ol>
&lt;li>新建文件夹
在您的 NVM 或任意目录下手动创建两个文件夹：&lt;/li>
&lt;/ol>
&lt;p>D:\nodejs\node_global (存放全局包)
D:\nodejs\node_cache (存放缓存)
2. 修改 NPM 配置
打开终端执行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 设置全局模块的安装路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config set prefix &amp;#34;D:\nodejs\node_global&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 设置缓存路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config set cache &amp;#34;D:\nodejs\node_cache&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>执行完毕后，您可以运行 npm config list 检查是否生效。&lt;/p>
&lt;ol start="3">
&lt;li>配置全局路径环境变量 (Environment Variables)&lt;/li>
&lt;/ol>
&lt;p>如果不配置此项，安装的全局命令（如 vue）将无法识别。&lt;/p>
&lt;p>操作路径：右键“此电脑” -&amp;gt; 属性 -&amp;gt; 高级系统设置 -&amp;gt; 环境变量。&lt;/p>
&lt;ul>
&lt;li>配置 Path 变量 (系统变量/用户变量)：
&lt;ul>
&lt;li>找到 &lt;code>Path&lt;/code> 变量 -&amp;gt; 编辑 -&amp;gt; 新建。&lt;/li>
&lt;li>添加路径：&lt;code>D:\nodejs\node_global&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>配置 NODE_PATH (系统变量)，在“系统变量”区域，点击“新建”：
&lt;ul>
&lt;li>新建变量名：&lt;code>NODE_PATH&lt;/code>&lt;/li>
&lt;li>变量值：&lt;code>D:\nodejs\node_global\node_modules&lt;/code>&lt;/li>
&lt;li>注意：必须多加一层 &lt;code>node_modules&lt;/code>，否则 require 无法找到模块。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>验证： 重启终端后，运行 &lt;code>npm install express -g&lt;/code>，检查是否安装到了新目录。&lt;/li>
&lt;/ul>
&lt;p>特别提示（如果您正在使用 NVM）
如果您是配合 NVM 使用此配置，这意味着所有 Node 版本都会共用这个 node_global。&lt;/p>
&lt;ul>
&lt;li>优点：切换 Node 版本后，不需要重新安装全局包（如 yarn, cnpm）。&lt;/li>
&lt;li>缺点：如果某个全局包依赖特定的 Node 版本（例如旧版 Sass），切换 Node 版本后可能会导致该工具报错。&lt;/li>
&lt;/ul>
&lt;h3 id="方案-bmacos--linux-系统-nvm">方案 B：macOS / Linux 系统 (nvm)&lt;/h3>
&lt;ol>
&lt;li>安装脚本
打开终端，运行官方安装脚本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>(如果网络连接失败，请尝试搜索“nvm gitee”寻找国内搬运脚本)&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>配置环境变量
安装脚本通常会自动写入配置文件。如果没有生效（输入 nvm 提示 command not found），请手动配置：&lt;/p>
&lt;/li>
&lt;li>
&lt;p>编辑配置文件：&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">macOS (Zsh): vim ~/.zshrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Linux (Bash): vim ~/.bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>添加以下内容：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export NVM_DIR=&amp;#34;$HOME/.nvm&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ -s &amp;#34;$NVM_DIR/nvm.sh&amp;#34; ] &amp;amp;&amp;amp; \. &amp;#34;$NVM_DIR/nvm.sh&amp;#34; # 加载 nvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ -s &amp;#34;$NVM_DIR/bash_completion&amp;#34; ] &amp;amp;&amp;amp; \. &amp;#34;$NVM_DIR/bash_completion&amp;#34; # 加载自动补全
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#在此处也可以直接配置国内镜像变量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export NVM_NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>使配置生效：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">source ~/.zshrc # 或 source ~/.bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="第三步使用-nvm-安装-nodejs">第三步：使用 NVM 安装 Node.js&lt;/h2>
&lt;p>配置好 NVM 后，即可灵活管理 Node 版本。&lt;/p>
&lt;ol>
&lt;li>查看可安装版本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm list available # Windows
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm ls-remote # Mac/Linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>安装指定版本（推荐安装 LTS 长期支持版）：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm install 18.17.0 # 安装具体的版本号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm install lts # 自动安装最新的 LTS 版本
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>切换/使用版本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm use 18.17.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(Windows 用户如果遇到 &amp;#34;exit status 1&amp;#34; 乱码报错，请右键选择*“以管理员身份运行”*终端)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>查看当前已安装版本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="第四步配置-npm-镜像加速依赖包下载">第四步：配置 NPM 镜像（加速依赖包下载）&lt;/h2>
&lt;p>安装完 Node.js 后，npm 命令自动可用。建议配置淘宝镜像（npmmirror）以加速 npm install。&lt;/p>
&lt;ol>
&lt;li>设置镜像源：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config set registry https://registry.npmmirror.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>验证是否成功：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config get registry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 预期输出: https://registry.npmmirror.com/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="常用命令速查表">常用命令速查表&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">命令&lt;/th>
&lt;th style="text-align:left">说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm install &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">安装指定版本 (如 nvm install 20.10.0)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm use &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">切换到指定版本&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm list&lt;/code>&lt;/td>
&lt;td style="text-align:left">列出本地已安装的所有版本&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm uninstall &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">卸载指定版本&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm alias default &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">(Mac/Linux) 设置默认版本，新开终端自动生效&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>node -v&lt;/code>&lt;/td>
&lt;td style="text-align:left">查看当前正在使用的 Node 版本&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>npm -v&lt;/code>&lt;/td>
&lt;td style="text-align:left">查看当前正在使用的 NPM 版本&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="-常见问题提示">💡 常见问题提示&lt;/h2>
&lt;p>权限问题：Windows 用户在执行 nvm use 切换版本时，必须使用管理员身份运行 CMD 或 PowerShell，否则无法创建软链接。
路径空格：确保 NVM 安装路径不包含空格（如 Program Files 有时会引起兼容性问题，建议安装在 C:\nvm 或类似简单路径）。&lt;/p></description></item><item><title>Git常用命令总结</title><link>https://changxiangyu.cn/p/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</link><pubDate>Sun, 26 Nov 2023 14:36:18 +0800</pubDate><guid>https://changxiangyu.cn/p/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</guid><description>&lt;h2 id="1-全局与局部配置-git-config">1. 全局与局部配置 (git config)&lt;/h2>
&lt;p>&lt;code>git config&lt;/code> 命令的作用是配置 Git 的相关信息。&lt;/p>
&lt;h3 id="用户名与邮箱配置">用户名与邮箱配置&lt;/h3>
&lt;p>&lt;strong>全局配置&lt;/strong> (适用于所有项目):
Mac 下可通过终端输入 &lt;code>cat ~/.gitconfig&lt;/code> 查看。&lt;/p>
&lt;p>&lt;code>git config --global user.name &amp;quot;name&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;code>git config --global user.email &amp;quot;email&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;strong>单个仓库配置&lt;/strong> (仅适用于当前项目): 进入项目根目录，输入 cat .git/config 查看。&lt;/p>
&lt;p>&lt;code>git config user.name &amp;quot;name&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;code>git config user.email &amp;quot;email&amp;quot;&lt;/code>&lt;/p>
&lt;h3 id="查看配置">查看配置&lt;/h3>
&lt;p>查看所有配置信息&lt;/p>
&lt;p>&lt;code> git config --list&lt;/code>&lt;/p>
&lt;p>查看当前配置的用户名&lt;/p>
&lt;p>&lt;code>git config user.name&lt;/code>&lt;/p>
&lt;p>查看当前配置的用户邮箱&lt;/p>
&lt;p>&lt;code>git config user.email &lt;/code>&lt;/p>
&lt;h3 id="定义命令别名-alias">定义命令别名 (Alias)&lt;/h3>
&lt;p>为了提高效率，可以给常用命令设置简写：&lt;/p>
&lt;p>&lt;code>git config --global alias.st status # git st = git status&lt;/code>&lt;/p>
&lt;p>&lt;code>git config --global alias.co checkout # git co = git checkout&lt;/code>&lt;/p>
&lt;p>&lt;code>git config --global alias.ci commit # git ci = git commit&lt;/code>&lt;/p>
&lt;p>&lt;code>git config --global alias.br branch # git br = git branch&lt;/code>&lt;/p>
&lt;h2 id="2-初始化与远程连接-git-init">2. 初始化与远程连接 (git init)&lt;/h2>
&lt;p>&lt;code>git init&lt;/code> 用于在当前目录初始化仓库，生成 &lt;code>.git&lt;/code> 目录。&lt;/p>
&lt;p>初始化仓库&lt;/p>
&lt;p>&lt;code>git init&lt;/code>&lt;/p>
&lt;p>连接远程项目 (origin 后接仓库地址)&lt;/p>
&lt;p>&lt;code>git remote add origin &amp;lt;git项目链接&amp;gt;&lt;/code>&lt;/p>
&lt;p>从远程项目拉取文件 (首次拉取建议加 &amp;ndash;rebase)&lt;/p>
&lt;p>&lt;code>git pull --rebase origin master&lt;/code>&lt;/p>
&lt;p>推送本地仓库到 Github (首次推送需 -u 绑定上游分支)&lt;/p>
&lt;p>&lt;code>git push -u origin master&lt;/code>&lt;/p>
&lt;h2 id="3-查看文件状态-git-status">3. 查看文件状态 (git status)&lt;/h2>
&lt;p>红色表示工作区修改未提交到暂存区，绿色表示已提交到暂存区。&lt;/p>
&lt;p>标准显示&lt;/p>
&lt;p>&lt;code>git status&lt;/code>&lt;/p>
&lt;p>极简方式显示&lt;/p>
&lt;p>&lt;code>git status -s&lt;/code>&lt;/p>
&lt;p>状态标识说明：&lt;/p>
&lt;ol>
&lt;li>本地新增的文件&lt;/li>
&lt;li>文件的一个新拷贝&lt;/li>
&lt;li>本地删除的文件&lt;/li>
&lt;li>修改过的文件 (红色：未暂存；绿色：已暂存)&lt;/li>
&lt;li>文件名被修改&lt;/li>
&lt;li>文件类型被修改&lt;/li>
&lt;li>文件未合并 (需解决冲突)&lt;/li>
&lt;li>未被 Git 管理的文件
已被修改但未暂存的文件，可用 &lt;code>git checkout -- fileName&lt;/code> 撤销更改。&lt;/li>
&lt;/ol>
&lt;h2 id="4-添加到暂存区-git-add">4. 添加到暂存区 (git add)&lt;/h2>
&lt;p>把所有修改的信息添加到暂存区&lt;/p>
&lt;p>&lt;code>git add .&lt;/code>&lt;/p>
&lt;p>仅添加被跟踪文件中被修改或删除的信息 (不处理新文件)&lt;/p>
&lt;p>&lt;code>git add -u&lt;/code>&lt;/p>
&lt;p>添加所有变化 (修改、删除、新增)&lt;/p>
&lt;p>&lt;code>git add -A&lt;/code>&lt;/p>
&lt;p>已提交到暂存区的文件，可以通过 &lt;code>git reset HEAD -- fileName&lt;/code> 撤销提交（移出暂存区）。&lt;/p>
&lt;h2 id="5-提交代码-git-commit">5. 提交代码 (git commit)&lt;/h2>
&lt;p>将暂存区的修改提交到本地仓库，生成 commit-id。&lt;/p>
&lt;p>提交暂存区修改&lt;/p>
&lt;p>&lt;code>git commit -m &amp;quot;message&amp;quot;&lt;/code>&lt;/p>
&lt;p>跳过 git add，直接将工作区修改提交 (不包含新文件)&lt;/p>
&lt;p>&lt;code>git commit -a -m &amp;quot;message&amp;quot;&lt;/code>&lt;/p>
&lt;p>修改最后一次提交 (用于漏掉文件或修改 commit 信息)&lt;/p>
&lt;p>&lt;code>git commit --amend&lt;/code>&lt;/p>
&lt;h2 id="6-拉取与获取-git-pull--git-fetch">6. 拉取与获取 (git pull &amp;amp; git fetch)&lt;/h2>
&lt;h3 id="git-pull">git pull&lt;/h3>
&lt;p>获取远程更新并与本地分支合并。逻辑上等于 git fetch + git merge。&lt;/p>
&lt;p>格式: git pull &amp;lt;远程主机名&amp;gt; &amp;lt;远程分支名&amp;gt;:&amp;lt;本地分支名&amp;gt;&lt;/p>
&lt;p>取回远程 dev 分支与本地 master 合并&lt;/p>
&lt;p>&lt;code>git pull origin dev:master&lt;/code>&lt;/p>
&lt;p>取回远程 dev 分支与当前分支合并&lt;/p>
&lt;p>&lt;code>git pull origin dev&lt;/code>&lt;/p>
&lt;h3 id="git-fetch">git fetch&lt;/h3>
&lt;p>仅将远程更新取回本地，不自动合并。&lt;/p>
&lt;p>获取远程 master 分支代码&lt;/p>
&lt;p>&lt;code>git fetch origin&lt;/code>&lt;/p>
&lt;p>获取远程 master 代码到本地新建的 test 分支&lt;/p>
&lt;p>&lt;code>git fetch origin master:test&lt;/code>&lt;/p>
&lt;h2 id="7-推送代码-git-push">7. 推送代码 (git push)&lt;/h2>
&lt;p>将本地 master 分支推送到远程&lt;/p>
&lt;p>&lt;code>git push origin master&lt;/code>&lt;/p>
&lt;p>删除远程 dev 分支&lt;/p>
&lt;p>&lt;code>git push origin --delete dev&lt;/code>&lt;/p>
&lt;h2 id="8-分支管理-git-branch">8. 分支管理 (git branch)&lt;/h2>
&lt;p>查看本地分支&lt;/p>
&lt;p>&lt;code>git branch&lt;/code>
查看本地和远程分支&lt;/p>
&lt;p>&lt;code>git branch -a&lt;/code>
新建分支&lt;/p>
&lt;p>&lt;code>git branch test&lt;/code>
重命名分支 (test 改为 dev)&lt;/p>
&lt;p>&lt;code>git branch -m test dev&lt;/code>
删除分支 (本地)&lt;/p>
&lt;p>&lt;code>git branch -d dev&lt;/code>&lt;/p>
&lt;h2 id="9-切换与撤销-git-checkout">9. 切换与撤销 (git checkout)&lt;/h2>
&lt;p>切换到指定 tag&lt;/p>
&lt;p>&lt;code>git checkout v1.0.0&lt;/code>&lt;/p>
&lt;p>基于 v1.0.0 创建并切换到 test 分支&lt;/p>
&lt;p>&lt;code>git checkout -b test v1.0.0&lt;/code>&lt;/p>
&lt;p>放弃工作区所有修改 (慎用)&lt;/p>
&lt;p>&lt;code>git checkout .&lt;/code>&lt;/p>
&lt;p>放弃指定文件的修改&lt;/p>
&lt;p>&lt;code>git checkout -- fileName&lt;/code>&lt;/p>
&lt;h2 id="10-标签管理-git-tag">10. 标签管理 (git tag)&lt;/h2>
&lt;p>查看已有标签&lt;/p>
&lt;p>&lt;code>git tag&lt;/code>&lt;/p>
&lt;p>#给最新 commit 打标签&lt;/p>
&lt;p>&lt;code>git tag v1.0.0&lt;/code>&lt;/p>
&lt;p>#给指定 commit id 打标签&lt;/p>
&lt;p>&lt;code>git tag v0.9.0 &amp;lt;commit-id&amp;gt;&lt;/code>&lt;/p>
&lt;h2 id="11-查看日志-git-log">11. 查看日志 (git log)&lt;/h2>
&lt;p>查看详细历史&lt;/p>
&lt;p>&lt;code>git log&lt;/code>&lt;/p>
&lt;p>单行显示 (简洁)&lt;/p>
&lt;p>&lt;code>git log --oneline&lt;/code>&lt;/p>
&lt;p>查看特定作者&lt;/p>
&lt;p>&lt;code>git log --author=&amp;quot;name&amp;quot;&lt;/code>&lt;/p>
&lt;p>#图形化显示分支合并历史&lt;/p>
&lt;p>&lt;code>git log --graph&lt;/code>&lt;/p>
&lt;p>显示前 n 条&lt;/p>
&lt;p>&lt;code>git log -n 5&lt;/code>&lt;/p>
&lt;p>按日期筛选&lt;/p>
&lt;p>&lt;code>git log --after=&amp;quot;2018-10-1&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;code>git log --before=&amp;quot;2018-10-7&amp;quot;&lt;/code>&lt;/p>
&lt;h2 id="12-版本回退-git-reset">12. 版本回退 (git reset)&lt;/h2>
&lt;p>&lt;code>git reset&lt;/code> 用于撤销暂存区修改或本地仓库提交。&lt;/p>
&lt;h3 id="撤销暂存区-git-add-后">撤销暂存区 (git add 后):&lt;/h3>
&lt;p>&lt;code>git reset HEAD fileName&lt;/code>&lt;/p>
&lt;p>&lt;code>git reset HEAD .&lt;/code>&lt;/p>
&lt;h3 id="撤销本地提交-git-commit-后">撤销本地提交 (git commit 后):&lt;/h3>
&lt;ul>
&lt;li>&amp;ndash;soft: 仅重置 HEAD 指针，保留暂存区和工作区内容 (相当于撤销 commit 命令)。&lt;/li>
&lt;li>&amp;ndash;mixed (默认): 重置 HEAD 指针和暂存区，保留工作区内容。&lt;/li>
&lt;li>&amp;ndash;hard: 重置 HEAD、暂存区和工作区，所有修改丢失。
回退到上一个版本&lt;/li>
&lt;/ul>
&lt;p>&lt;code>git reset --soft HEAD~1&lt;/code>&lt;/p>
&lt;p>回退到指定 commit-id&lt;/p>
&lt;p>&lt;code>git reset --hard a1b2c3d&lt;/code>&lt;/p>
&lt;h2 id="13-远程仓库管理-git-remote">13. 远程仓库管理 (git remote)&lt;/h2>
&lt;p>查看远程仓库名称&lt;/p>
&lt;p>&lt;code>git remote&lt;/code>&lt;/p>
&lt;p>查看详细信息 (fetch/push 地址)&lt;/p>
&lt;p>&lt;code>git remote -v&lt;/code>&lt;/p>
&lt;p>添加远程仓库&lt;/p>
&lt;p>&lt;code>git remote add origin &amp;lt;url&amp;gt;&lt;/code>&lt;/p>
&lt;p>删除远程关联&lt;/p>
&lt;p>&lt;code>git remote remove origin&lt;/code>&lt;/p>
&lt;p>修改远程仓库地址&lt;/p>
&lt;p>&lt;code>git remote set-url origin &amp;lt;new-url&amp;gt;&lt;/code>&lt;/p>
&lt;p>清理远程已删除分支的本地缓存&lt;/p>
&lt;p>&lt;code>git remote update origin --prune&lt;/code>&lt;/p>
&lt;h2 id="14-合并-git-merge">14. 合并 (git merge)&lt;/h2>
&lt;p>将 dev 分支合并到当前分支
&lt;code>git merge dev&lt;/code>&lt;/p>
&lt;h2 id="15-暂存更改-git-stash">15. 暂存更改 (git stash)&lt;/h2>
&lt;p>当需要切换分支但不想提交当前工作时使用。&lt;/p>
&lt;p>保存当前进度&lt;/p>
&lt;p>&lt;code>git stash&lt;/code>&lt;/p>
&lt;p>查看保存列表&lt;/p>
&lt;p>&lt;code>git stash list&lt;/code>&lt;/p>
&lt;p>恢复最近进度并删除记录&lt;/p>
&lt;p>&lt;code>git stash pop&lt;/code>&lt;/p>
&lt;p>恢复指定进度 (不删除记录)&lt;/p>
&lt;p>&lt;code>git stash apply stash@{0}&lt;/code>&lt;/p>
&lt;p>删除指定进度&lt;/p>
&lt;p>&lt;code>git stash drop stash@{0}&lt;/code>&lt;/p>
&lt;p>清空所有进度&lt;/p>
&lt;p>&lt;code>git stash clear&lt;/code>&lt;/p>
&lt;h2 id="16-忽略文件-gitignore">16. 忽略文件 (.gitignore)&lt;/h2>
&lt;p>在项目根目录创建 &lt;code>.gitignore&lt;/code> 文件，列出不需要 Git 管理的文件或目录（如系统文件、编译产物、密钥等）。GitHub 提供了标准模板。&lt;/p>
&lt;h2 id="17-实战新建项目并提交">17. 实战：新建项目并提交&lt;/h2>
&lt;ol>
&lt;li>初始化本地仓库: &lt;code>git init&lt;/code>&lt;/li>
&lt;li>添加文件到暂存区: &lt;code>git add .&lt;/code>&lt;/li>
&lt;li>提交到本地仓库: &lt;code>git commit -m &amp;quot;first commit&amp;quot;&lt;/code>&lt;/li>
&lt;li>关联远程仓库: &lt;code>git remote add origin https://github.com/user/repo.git&lt;/code>&lt;/li>
&lt;li>推送到远程: &lt;code>git push -u origin master&lt;/code>&lt;/li>
&lt;/ol>
&lt;h2 id="18-ssh-秘钥配置">18. SSH 秘钥配置&lt;/h2>
&lt;ol>
&lt;li>检查现有秘钥:
&lt;code>cd ~/.ssh ls&lt;/code>&lt;/li>
&lt;li>生成新秘钥:
&lt;code>ssh-keygen -t rsa -C &amp;quot;your_email@example.com&amp;quot;&lt;/code>
一路回车使用默认值即可。&lt;/li>
&lt;li>获取公钥:
&lt;code>cat ~/.ssh/id_rsa.pub&lt;/code>
复制输出内容配置到 GitHub/GitLab 的 SSH Keys 中。&lt;/li>
&lt;/ol>
&lt;h2 id="19-常见问题与修复">19. 常见问题与修复&lt;/h2>
&lt;p>Push 失败 (本地与远程分支不一致)
通常发生在远程&lt;/p></description></item><item><title>Markdown 与 Pandoc 的完美结合</title><link>https://changxiangyu.cn/p/markdown-%E4%B8%8E-pandoc-%E7%9A%84%E5%AE%8C%E7%BE%8E%E7%BB%93%E5%90%88/</link><pubDate>Fri, 27 Oct 2023 20:46:00 +0800</pubDate><guid>https://changxiangyu.cn/p/markdown-%E4%B8%8E-pandoc-%E7%9A%84%E5%AE%8C%E7%BE%8E%E7%BB%93%E5%90%88/</guid><description>&lt;h1 id="打造高效写作流markdown-与-pandoc-的完美结合">打造高效写作流：Markdown 与 Pandoc 的完美结合&lt;/h1>
&lt;p>在数字化写作的时代，我们经常面临一个痛点：&lt;strong>内容与格式的纠缠&lt;/strong>。在 Word 中调整缩进和字体往往占据了我们一半的创作时间。今天，我想分享一套“一次编写，到处运行”的高效写作方案：&lt;strong>Markdown + Pandoc&lt;/strong>。&lt;/p>
&lt;h2 id="为什么选择-markdown">为什么选择 Markdown？&lt;/h2>
&lt;p>Markdown 是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档。它的核心优势在于：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>专注内容&lt;/strong>：没有复杂的排版按钮，让你沉浸在写作逻辑中。&lt;/li>
&lt;li>&lt;strong>通用性强&lt;/strong>：几乎所有的代码编辑器和笔记软件都支持。&lt;/li>
&lt;li>&lt;strong>版本控制&lt;/strong>：纯文本文件非常适合用 Git 进行管理。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>“Markdown 的目标是实现‘易读易写’。” —— John Gruber&lt;/p>
&lt;/blockquote>
&lt;h2 id="神器登场pandoc-是什么">神器登场：Pandoc 是什么？&lt;/h2>
&lt;p>如果说 Markdown 是原材料，那么 &lt;a class="link" href="https://pandoc.org/" target="_blank" rel="noopener"
>Pandoc&lt;/a> 就是那台万能加工机。它是一个开源的文档转换工具，被誉为文档转换界的“瑞士军刀”。&lt;/p>
&lt;p>它支持在 Markdown、Word、PDF、LaTeX、HTML 等多种格式之间相互转换。这对于写简历、论文或技术文档来说，简直是救星。&lt;/p>
&lt;h3 id="核心功能">核心功能&lt;/h3>
&lt;ul>
&lt;li>保留 Markdown 的结构和可读性&lt;/li>
&lt;li>一键生成 PDF / Word / HTML&lt;/li>
&lt;li>支持自定义 CSS 样式和 LaTeX 模板&lt;/li>
&lt;/ul>
&lt;h2 id="实战演练如何安装与使用">实战演练：如何安装与使用&lt;/h2>
&lt;h3 id="1-安装-pandoc">1. 安装 Pandoc&lt;/h3>
&lt;p>根据你的操作系统，选择对应的安装方式：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Windows&lt;/strong>: 访问官网下载 &lt;code>.msi&lt;/code> 安装包，记得勾选 &amp;ldquo;Add to PATH&amp;rdquo;。&lt;/li>
&lt;li>&lt;strong>MacOS&lt;/strong>: 使用 Homebrew 安装。
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install pandoc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>&lt;strong>Linux&lt;/strong>:
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt install pandoc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>安装完成后，在终端输入 &lt;code>pandoc -v&lt;/code> 检查是否成功。&lt;/p>
&lt;h3 id="2-转换命令速查">2. 转换命令速查&lt;/h3>
&lt;p>假设你写好了一份名为 &lt;code>resume.md&lt;/code> 的简历，以下是几个常用的转换命令：&lt;/p>
&lt;p>&lt;strong>生成 Word 文档&lt;/strong>&lt;/p>
&lt;p>&lt;code>pandoc resume.md -o resume.docx&lt;/code>&lt;/p>
&lt;p>生成 PDF (推荐使用 wkhtmltopdf 引擎) 如果你希望保留 Markdown 中的 CSS 样式（比如带颜色的标题），建议使用以下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pandoc resume.md -o resume.pdf --pdf-engine&lt;span class="o">=&lt;/span>wkhtmltopdf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>进阶技巧：套用模板
Pandoc 最强大的地方在于支持模板。你可以下载大神们做好的 LaTeX 模板，让你的文档瞬间拥有出版级的排版。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pandoc resume.md -o resume.pdf --template&lt;span class="o">=&lt;/span>mytemplate.tex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>古风写真</title><link>https://changxiangyu.cn/p/%E5%8F%A4%E9%A3%8E%E5%86%99%E7%9C%9F/</link><pubDate>Mon, 07 Aug 2023 15:33:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%8F%A4%E9%A3%8E%E5%86%99%E7%9C%9F/</guid><description>&lt;img src="https://changxiangyu.cn/images/photo-antique-style/1-1.jpg" alt="Featured image of post 古风写真" />&lt;!-- 建议在 config.toml 中开启 canonifyURLs = true 或使用绝对路径 -->
&lt;blockquote>
&lt;p>记录我们最珍贵的时刻，每一张都是爱的见证。&lt;/p>
&lt;/blockquote>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822324312846.jpg" alt="婚纱照 慕爱01" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822332690089.jpg" alt="婚纱照 慕爱02" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822338217800.jpg" alt="婚纱照 慕爱03" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822341011285.jpg" alt="婚纱照 慕爱04" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822343388343.jpg" alt="婚纱照 慕爱05" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822345260352.jpg" alt="婚纱照 慕爱06" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822347181824.jpg" alt="婚纱照 慕爱07" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822349068329.jpg" alt="婚纱照 慕爱08" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822351127231.jpg" alt="婚纱照 慕爱09" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822352962776.jpg" alt="婚纱照 慕爱10" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822358885364.jpg" alt="婚纱照 慕爱11" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822361146468.jpg" alt="婚纱照 慕爱12" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822363099241.jpg" alt="婚纱照 慕爱13" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822363099242.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822367482410.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822371787881.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822378166654.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822380207795.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822382226697.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822384457744.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822386451746.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/13350822388311298.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;br>&lt;br>
&lt;img src="https://changxiangyu.cn/images/photo-antique-style/1969693435y34.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;/div></description></item><item><title>Vue 项目 Nginx 生产环境部署与配置全指南</title><link>https://changxiangyu.cn/p/vue-%E9%A1%B9%E7%9B%AE-nginx-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%85%A8%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 27 Apr 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/vue-%E9%A1%B9%E7%9B%AE-nginx-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%85%A8%E6%8C%87%E5%8D%97/</guid><description>&lt;h2 id="概述">概述&lt;/h2>
&lt;p>本文档旨在介绍 Vue 项目（包括 Vue CLI、Vite 及 UniApp H5）构建完成后，如何使用 Nginx 进行生产环境的部署与配置。内容涵盖 Nginx 的核心配置、前端路由与路径设置、环境变量管理以及在 Windows 环境下的特殊操作指南。&lt;/p>
&lt;h2 id="1-前置要求">1. 前置要求&lt;/h2>
&lt;p>在开始部署前，请确保满足以下条件：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>构建完成&lt;/strong>：Vue 项目已完成开发，并通过流水线或本地构建命令打包生成了静态资源（通常为 &lt;code>dist&lt;/code> 目录）。&lt;/li>
&lt;li>&lt;strong>环境准备&lt;/strong>：服务器已安装 Nginx。&lt;/li>
&lt;li>&lt;strong>文件部署&lt;/strong>：构建好的静态文件已上传至服务器指定目录。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="2-nginx-核心配置">2. Nginx 核心配置&lt;/h2>
&lt;p>以下是一个标准的 Nginx &lt;code>server&lt;/code> 配置块，适用于单页应用（SPA）的部署。&lt;/p>
&lt;h3 id="配置文件示例-nginxconf">配置文件示例 (&lt;code>nginx.conf&lt;/code>)&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">test.wxy.cn&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># 请替换为实际域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1. 开启 Gzip 压缩（优化加载速度）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">gzip&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_min_length&lt;/span> &lt;span class="mi">1k&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_comp_level&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_types&lt;/span> &lt;span class="s">text/plain&lt;/span> &lt;span class="s">text/css&lt;/span> &lt;span class="s">text/javascript&lt;/span> &lt;span class="s">application/json&lt;/span> &lt;span class="s">application/javascript&lt;/span> &lt;span class="s">application/xml+rss&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_vary&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_disable&lt;/span> &lt;span class="s">&amp;#34;MSIE&lt;/span> &lt;span class="s">[1-6]\.&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 2. 前端静态资源托管
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/usr/share/nginx/html&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># 静态资源存放路径
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 核心配置：解决 History 模式路由刷新 404 问题
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">try_files&lt;/span> &lt;span class="nv">$uri&lt;/span> &lt;span class="nv">$uri/&lt;/span> &lt;span class="s">/index.html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 3. 接口反向代理配置
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">/vpsmobileh5&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 如果需要重写路径，可取消注释下面这行
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1"># rewrite ^/vpsmobileh5(.*)$ \$1 break;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ⚠️ 注意：proxy_pass 结尾带 / 表示去除匹配路径
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://172.168.50.77:16690/&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_redirect&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Real-IP&lt;/span> &lt;span class="nv">$remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-For&lt;/span> &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 支持 WebSocket
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">&amp;#34;upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">client_max_body_size&lt;/span> &lt;span class="mi">200m&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">expires&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-关键注意事项">⚠️ 关键注意事项&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>proxy_pass 的斜杠&lt;/strong>：
&lt;ul>
&lt;li>&lt;code>proxy_pass http://ip:port/;&lt;/code>（带斜杠）：会将 &lt;code>/vpsmobileh5/api&lt;/code> 转发为 &lt;code>/api&lt;/code>（去除了前缀）。&lt;/li>
&lt;li>&lt;code>proxy_pass http://ip:port;&lt;/code>（不带斜杠）：会将 &lt;code>/vpsmobileh5/api&lt;/code> 转发为 &lt;code>/vpsmobileh5/api&lt;/code>（保留前缀）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="3-前端项目配置详解">3. 前端项目配置详解&lt;/h2>
&lt;p>为了配合 Nginx 部署，前端代码层面也需要进行相应的适配。&lt;/p>
&lt;h3 id="31-路由模式与基础路径">3.1 路由模式与基础路径&lt;/h3>
&lt;p>Vue Router 主要有两种模式：&lt;code>hash&lt;/code> 和 &lt;code>history&lt;/code>。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>推荐配置&lt;/strong>：虽然 History 模式 URL 更美观，但若为了简化服务器配置或兼容性，&lt;strong>Hash 模式&lt;/strong>通常更省心。&lt;/li>
&lt;li>&lt;strong>路径配置&lt;/strong>：建议设置 &lt;code>base&lt;/code> 为相对路径 &lt;code>./&lt;/code>，使静态资源能自动适应部署的子目录。
配置示例 (manifest.json 或 router 配置):&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;h5&amp;#34; : {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;router&amp;#34; : {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;mode&amp;#34; : &amp;#34;hash&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;base&amp;#34;: &amp;#34;./&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>资源引用规范：&lt;/p>
&lt;ul>
&lt;li>❌ 避免使用 &lt;code>../../static/icon/logo.png&lt;/code> 这种跨层级相对路径。&lt;/li>
&lt;li>✅ 推荐使用 &lt;code>static/icon/logo.png&lt;/code> 或绝对路径，确保基于当前目录结构查找。&lt;/li>
&lt;/ul>
&lt;h3 id="32-环境变量管理-api-基地址">3.2 环境变量管理 (API 基地址)&lt;/h3>
&lt;p>根据构建工具的不同（Vite vs Webpack/Vue CLI），环境变量的处理方式有所区别。&lt;/p>
&lt;p>&lt;strong>场景 A：Vite 项目 (Vue 3 / UniApp)&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>创建配置文件 &lt;code>.env.production&lt;/code>:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">NODE_ENV=production
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 变量名必须以 VITE_ 开头
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VITE_BASE_URL=http://api.prod.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>代码中调用:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">console.log(&amp;#39;当前环境&amp;#39;, import.meta.env.MODE);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export const defaultUrl = import.meta.env.MODE === &amp;#39;production&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ? import.meta.env.VITE_BASE_URL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> : &amp;#39;http://172.168.50.73:6603&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>场景 B：Vue CLI 项目 (Vue 2)&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>创建配置文件 &lt;code>.env.production&lt;/code>:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">NODE_ENV=production
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 变量名必须以 VUE_APP_ 开头
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VUE_APP_BASE_URL=http://api.prod.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>代码中调用:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">console.log(&amp;#39;当前环境&amp;#39;, process.env.NODE_ENV);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export const defaultUrl = process.env.NODE_ENV === &amp;#39;production&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ? process.env.VUE_APP_BASE_URL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> : &amp;#39;http://172.168.81.177:9001&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="33-构建公共路径-vite-config">3.3 构建公共路径 (Vite Config)&lt;/h3>
&lt;p>在 &lt;code>vite.config.js&lt;/code> 中配置 &lt;code>base&lt;/code>，决定了 HTML 中引入 JS/CSS 的路径前缀。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { defineConfig } from &amp;#34;vite&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import uni from &amp;#34;@dcloudio/vite-plugin-uni&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export default defineConfig({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> plugins: [uni()],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> base: &amp;#39;/&amp;#39;, // 默认值，表示从根路径加载。如果部署在子目录，请修改此处
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9011,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="4-windows-环境与-iis-混合部署指南">4. Windows 环境与 IIS 混合部署指南&lt;/h2>
&lt;p>如果您的生产环境是 Windows Server，且涉及 IIS 与 Nginx 共存，请参考以下操作。&lt;/p>
&lt;h3 id="41-部署结构建议">4.1 部署结构建议&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>IIS 配置&lt;/strong>：新建网站，指向项目物理路径（如 &lt;code>D:\WebSite\YKT&lt;/code>）。&lt;/li>
&lt;li>&lt;strong>Nginx 配置&lt;/strong>：作为反向代理或静态服务器，配置文件位于 &lt;code>D:\Nginx\nginx-1.15.6\conf\nginx.conf&lt;/code>。&lt;/li>
&lt;/ol>
&lt;h3 id="42-nginx-常用命令-cmd">4.2 Nginx 常用命令 (CMD)&lt;/h3>
&lt;p>请在 Nginx 安装目录（如 &lt;code>D:\Nginx\nginx-1.15.6&lt;/code>）下打开 CMD 执行：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">操作&lt;/th>
&lt;th style="text-align:left">命令&lt;/th>
&lt;th style="text-align:left">说明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>启动&lt;/strong>&lt;/td>
&lt;td style="text-align:left">&lt;code>start nginx&lt;/code>&lt;/td>
&lt;td style="text-align:left">启动服务，在 Windows 下窗口闪退属正常现象（进程已在后台运行）。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>重载&lt;/strong>&lt;/td>
&lt;td style="text-align:left">&lt;code>nginx -s reload&lt;/code>&lt;/td>
&lt;td style="text-align:left">修改 &lt;code>nginx.conf&lt;/code> 后，无需重启，热加载新配置。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>停止&lt;/strong>&lt;/td>
&lt;td style="text-align:left">&lt;code>nginx -s stop&lt;/code>&lt;/td>
&lt;td style="text-align:left">快速停止 Nginx 服务。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>退出&lt;/strong>&lt;/td>
&lt;td style="text-align:left">&lt;code>nginx -s quit&lt;/code>&lt;/td>
&lt;td style="text-align:left">处理完当前请求后，优雅退出服务。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>检测&lt;/strong>&lt;/td>
&lt;td style="text-align:left">&lt;code>nginx -t&lt;/code>&lt;/td>
&lt;td style="text-align:left">&lt;strong>强烈推荐&lt;/strong>。在重载前运行，用于检测配置文件语法是否正确。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="43-排查端口占用">4.3 排查端口占用&lt;/h3>
&lt;p>如果启动失败，通常是端口冲突导致。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 1. 查看占用 80 端口的进程 PID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">netstat -aon | findstr &amp;#34;80&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 2. 根据 PID 查看是哪个程序 (假设 PID 为 2276)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tasklist | findstr &amp;#34;2276&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-windows-下的严重警告">⚠️ Windows 下的严重警告&lt;/h3>
&lt;p>&lt;strong>不要使用记事本 (Notepad) 编辑&lt;/strong> &lt;code>nginx.conf&lt;/code>！ 记事本保存时会自动添加 &lt;strong>BOM (Byte Order Mark)&lt;/strong> 头，这会导致 Nginx 读取配置文件失败。 &lt;strong>解决方案&lt;/strong>：请使用 VS Code、Notepad++ 或 Sublime Text 等专业编辑器。&lt;/p>
&lt;h2 id="5-常见问题排查-faq">5. 常见问题排查 (FAQ)&lt;/h2>
&lt;p>Q1: 部署后静态资源（JS/CSS）加载 404？&lt;/p>
&lt;ul>
&lt;li>
&lt;p>原因：构建时的 &lt;code>publicPath&lt;/code> (Vue CLI) 或 &lt;code>base&lt;/code> (Vite) 配置与 Nginx 的部署目录不一致。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解决：如果部署在根目录，设置为 &lt;code>/&lt;/code>；如果部署在 &lt;code>/app/&lt;/code> 子目录，设置为 &lt;code>/app/&lt;/code> 或 &lt;code>./&lt;/code>。
Q2: 环境变量不生效？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>原因：前缀错误或文件未加载。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解决：&lt;/p>
&lt;ul>
&lt;li>Vite 必须用 &lt;code>VITE_&lt;/code>开头。&lt;/li>
&lt;li>Vue CLI 必须用 &lt;code>VUE_APP_&lt;/code> 开头。&lt;/li>
&lt;li>确保 &lt;code>.env.production&lt;/code> 文件位于项目根目录。
Q3: 刷新页面出现 404 错误？&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>原因：使用了 History 路由模式，但 Nginx 未配置重定向。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解决：确保 Nginx 配置中包含 &lt;code>try_files $uri $uri/ /index.html;&lt;/code>。&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>乾坤(Qiankun)微前端路由</title><link>https://changxiangyu.cn/p/%E4%B9%BE%E5%9D%A4qiankun%E5%BE%AE%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1/</link><pubDate>Thu, 27 Apr 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E4%B9%BE%E5%9D%A4qiankun%E5%BE%AE%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1/</guid><description>&lt;p>在微前端架构中，主应用与子应用的技术栈差异往往会带来一些意想不到的路由同步问题。本文将分享一个在 Vue3 主应用 + Angular 子应用 场景下，遇到的“三级路由回退导致导航失效”的各种坑及其解决方案。&lt;/p>
&lt;h2 id="1-问题描述">1. 问题描述&lt;/h2>
&lt;p>场景&lt;/p>
&lt;ul>
&lt;li>主应用：Vue3 + Vue Router (Hash 模式)&lt;/li>
&lt;li>子应用：Angular (使用 Qiankun 接入)&lt;/li>
&lt;li>操作路径：进入 Angular 子应用 -&amp;gt; 进入二级页面 -&amp;gt; 进入三级页面 -&amp;gt; 点击“返回”按钮回退到上一级。
症状
当从三级路由回退后，再次点击主应用侧边栏或其他菜单时，页面无反应。查看浏览器控制台，出现类似 &lt;code>route undefined&lt;/code> 的报错。&lt;/li>
&lt;/ul>
&lt;h2 id="2-原因深度分析">2. 原因深度分析&lt;/h2>
&lt;p>经过源码排查，发现问题的根源在于 &lt;strong>Vue Router&lt;/strong> 与 &lt;strong>Angular Router&lt;/strong> 对底层 &lt;strong>History API&lt;/strong> 的使用差异。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Vue Router 的机制&lt;/strong>： Vue3 的路由跳转底层调用了 &lt;code>changeLocation&lt;/code> 函数。该函数在执行时，高度依赖 &lt;code>history.state&lt;/code> 来获取路由信息。如果 &lt;code>history.state&lt;/code> 为空或缺少关键字段（如 &lt;code>current&lt;/code>），Vue Router 可能无法正确识别当前位置，从而导致跳转逻辑中断。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Angular Router 的差异&lt;/strong>： Angular 的默认路由跳转（特别是使用 HTML 中的 &lt;code>[routerLink]=&amp;quot;['../']&amp;quot;&lt;/code> 指令时），并不会默认向 &lt;code>history.state&lt;/code> 中写入 Vue Router 所需的元数据。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>结论：当在 Angular 子应用中进行路由回退时，由于没有正确更新 &lt;code>history.state&lt;/code>，导致主应用（Vue3）接管路由时读取到了空状态或错误状态，最终引发路由报错。&lt;/p>
&lt;h2 id="3-解决方案">3. 解决方案&lt;/h2>
&lt;p>为了解决这个问题，我们需要在“子应用跳转”和“主应用监听”两个层面进行改造。&lt;/p>
&lt;h3 id="步骤一改造-angular-子应用的跳转方式">步骤一：改造 Angular 子应用的跳转方式&lt;/h3>
&lt;p>&lt;strong>核心策略&lt;/strong>：放弃 HTML 模板中的 &lt;code>[routerLink]&lt;/code> 跳转，改用 API 编程式导航，并手动注入 &lt;code>state&lt;/code>。&lt;/p>
&lt;p>Angular 的 &lt;code>Router.navigate&lt;/code> 方法允许我们传递 &lt;code>NavigationExtras&lt;/code>，其中的 &lt;code>state&lt;/code> 属性可以让我们自定义路由状态。这正好可以用来模拟 Vue Router 所需的数据结构。&lt;br>
代码实现 (Angular 子应用)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// 在组件中注入 Router
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { Router } from &amp;#39;@angular/router&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">constructor(private _router: Router) {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 替代原本的 [routerLink]=&amp;#34;[&amp;#39;../&amp;#39;]&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">back() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 手动构建 state 对象，模拟 Vue Router 的 current 字段
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 注意：这里的路径需要根据实际业务调整
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const state = { current: &amp;#39;/kq/kqGroup&amp;#39; };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 使用 navigate 跳转，并带上 state
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this._router.navigate([&amp;#39;/kqGroup&amp;#39;], { state: state });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意：建议三级路由跳转时，URL 中尽量不要直接携带参数，可以考虑通过 Service 或 State 传递数据，以减少路由匹配的复杂度。&lt;/p>
&lt;h3 id="步骤二改造-vue3-主应用的路由守卫">步骤二：改造 Vue3 主应用的路由守卫&lt;/h3>
&lt;p>&lt;strong>核心策略&lt;/strong>：在主应用的全局路由守卫中，主动检测并修复 &lt;code>history.state&lt;/code>。&lt;/p>
&lt;p>我们需要在 &lt;code>router.beforeEach&lt;/code> 中监听路由变化。如果发现 &lt;code>history.state&lt;/code> 丢失或不完整（缺少 current 字段），则使用 &lt;code>history.replaceState&lt;/code> 强制补全，确保 Vue Router 能正常工作。&lt;/p>
&lt;p>代码实现 (Vue3 主应用)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { createRouter, createWebHashHistory } from &amp;#39;vue-router&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">const router = createRouter({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history: createWebHashHistory(),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> routes,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">});
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router.beforeEach(async (to, from, next) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 1. 核心修复逻辑：补全 history.state
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 如果 state 存在但没有 current 字段，说明可能是子应用过来的跳转，手动补全
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (history.state &amp;amp;&amp;amp; !history.state.current) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#39;检测到 state 缺失，执行 replaceState 修复&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> window.history.replaceState({ current: to.path }, &amp;#39;&amp;#39;, to.path);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 调试日志
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#39;微前端 history.state ===&amp;#39;, history.state);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#39;微前端 window.location ===&amp;#39;, window.location);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 2. 特殊业务场景修复（如巡更业务）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 修复通过菜单切换后，history.state 丢失应用前缀信息的问题
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const current = history.state?.current;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const pathname = window.location.pathname;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (pathname &amp;amp;&amp;amp; pathname.startsWith(&amp;#39;/xg&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (current !== pathname) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history.replaceState(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> { back: from.path, current: window.location.pathname },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> to.path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 3. 常规鉴权与路由分发逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!verifyToken() &amp;amp;&amp;amp; to.path !== &amp;#39;/login&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ... 处理登录逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (noLoginPage.includes(to.path)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ path: &amp;#39;/login&amp;#39;, query: { fromPath: to.fullPath } });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 清理缓存逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (to.path === &amp;#39;/home&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sessionStorage.removeItem(&amp;#39;currentMenu&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sessionStorage.removeItem(&amp;#39;currentPage&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 动态路由加载逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (store.state.menus.routers.length === 0 &amp;amp;&amp;amp; to.path !== &amp;#39;/login&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 处理菜单基合菜单列表
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const res = await store.dispatch(&amp;#39;menus/getMenus&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> res.forEach((route) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (router.hasRoute(&amp;#39;Main&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router.addRoute(&amp;#39;Main&amp;#39;, route);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const routers = router.getRoutes();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Tips不检查门禁监控菜单
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (routers.find((item) =&amp;gt; item.path === to.path || /\/monitor\/mj\//.test(to.path))) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ ...to, replace: true });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ path: &amp;#39;/not-find&amp;#39; });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 404 检测
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const routers = router.getRoutes();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 简单的白名单检查
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (routers.find(item =&amp;gt; item.path === to.path || /\/monitor\/mj\//.test(to.path))) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ path: &amp;#39;/not-find&amp;#39; });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="4-总结">4. 总结&lt;/h2>
&lt;p>在乾坤微前端架构中，不同框架对 &lt;code>History API&lt;/code> 的操作习惯不同是导致路由不同步的常见原因。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Angular&lt;/strong> 侧：利用 &lt;code>navigate&lt;/code> 的 &lt;code>state&lt;/code> 参数主动配合主应用的路由机制。&lt;/li>
&lt;li>&lt;strong>Vue&lt;/strong> 侧：利用 &lt;code>beforeEach&lt;/code> 守卫进行兜底，确保 &lt;code>history.state&lt;/code> 始终包含 &lt;code>current&lt;/code> 字段。
通过双向奔赴的改造，我们成功解决了三级路由回退后的“死锁”问题，保证了微前端应用的流畅体验。&lt;/li>
&lt;/ul></description></item><item><title>微信支付接入指南：JSAPI、H5与小程序</title><link>https://changxiangyu.cn/p/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97jsapih5%E4%B8%8E%E5%B0%8F%E7%A8%8B%E5%BA%8F/</link><pubDate>Sun, 12 Mar 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97jsapih5%E4%B8%8E%E5%B0%8F%E7%A8%8B%E5%BA%8F/</guid><description>&lt;p>本文总结了前端开发中常见的微信支付三种接入场景及其核心流程。&lt;/p>
&lt;h2 id="1-公众号支付-jsapi">1. 公众号支付 (JSAPI)&lt;/h2>
&lt;p>&lt;strong>适用场景&lt;/strong>：微信内置浏览器、微信客户端扫码、企业微信网页。&lt;/p>
&lt;h3 id="核心流程">核心流程&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>网页授权获取 Code&lt;/strong>：
引导用户访问微信授权链接，获取 &lt;code>code&lt;/code>。
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-http" data-lang="http">&lt;span class="line">&lt;span class="cl">&lt;span class="err">https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=snsapi_base&amp;amp;state=123#wechat_redirect
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>&lt;strong>获取 OpenID&lt;/strong>：
后端使用 &lt;code>appid&lt;/code>、&lt;code>secret&lt;/code> 和前端传来的 &lt;code>code&lt;/code> 换取用户的 &lt;code>openid&lt;/code>。&lt;/li>
&lt;li>&lt;strong>统一下单&lt;/strong>：
后端调用微信统一下单接口，获取支付参数（&lt;code>timeStamp&lt;/code>, &lt;code>nonceStr&lt;/code>, &lt;code>package&lt;/code>, &lt;code>signType&lt;/code>, &lt;code>paySign&lt;/code>）。&lt;/li>
&lt;li>&lt;strong>唤起支付&lt;/strong>：
前端使用 &lt;code>WeixinJSBridge.invoke&lt;/code> 或 &lt;code>wx.chooseWXPay&lt;/code> 调起支付窗口。&lt;/li>
&lt;/ol>
&lt;h3 id="-注意事项">⚠️ 注意事项&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>授权域名&lt;/strong>：&lt;code>redirect_uri&lt;/code> 的域名必须在&lt;strong>微信公众平台&lt;/strong>的“网页授权域名”中配置。&lt;/li>
&lt;li>&lt;strong>支付目录&lt;/strong>：支付页面的路径必须在&lt;strong>微信商户平台&lt;/strong>配置“JSAPI支付授权目录”。&lt;/li>
&lt;li>&lt;strong>AppID&lt;/strong>：此处使用&lt;strong>公众号&lt;/strong>的 AppID。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="2-h5-支付">2. H5 支付&lt;/h2>
&lt;p>&lt;strong>适用场景&lt;/strong>：外部移动端浏览器（如 Safari, Chrome）、App 内嵌 H5（非微信环境）。&lt;/p>
&lt;h3 id="核心流程-1">核心流程&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>后端下单&lt;/strong>：
后端调用微信统一下单接口（交易类型为 &lt;code>MWEB&lt;/code>）。&lt;/li>
&lt;li>&lt;strong>获取跳转链接&lt;/strong>：
接口返回 &lt;code>mweb_url&lt;/code>（即原文中的 &lt;code>pay_url&lt;/code>）。&lt;/li>
&lt;li>&lt;strong>跳转支付&lt;/strong>：
前端直接跳转该链接，微信会中间页唤起微信客户端进行支付。
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 示例：跳转并指定支付后的回调页
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mweb_url&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&amp;amp;redirect_url=&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">encodeURIComponent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="-注意事项-1">⚠️ 注意事项&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>Referer 校验&lt;/strong>：微信会校验发起支付请求的域名（Referer），需在商户平台配置“H5支付域名”。&lt;/li>
&lt;li>&lt;strong>AppID&lt;/strong>：此处使用&lt;strong>商户绑定的移动应用或公众号&lt;/strong> AppID。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="3-小程序支付">3. 小程序支付&lt;/h2>
&lt;p>&lt;strong>适用场景&lt;/strong>：微信小程序原生环境。&lt;/p>
&lt;h3 id="核心流程-2">核心流程&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>获取登录凭证&lt;/strong>：
前端调用 &lt;code>wx.login()&lt;/code> 获取 &lt;code>code&lt;/code>。&lt;/li>
&lt;li>&lt;strong>获取 OpenID&lt;/strong>：
后端通过 &lt;code>appid&lt;/code>、&lt;code>secret&lt;/code> 和 &lt;code>code&lt;/code> 换取 &lt;code>openid&lt;/code>。&lt;/li>
&lt;li>&lt;strong>后端下单&lt;/strong>：
后端调用统一下单接口，返回支付核心参数（&lt;code>paySign&lt;/code> 等）。&lt;/li>
&lt;li>&lt;strong>唤起支付&lt;/strong>：
前端调用小程序 API 进行支付：
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">requestPayment&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">timeStamp&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">nonceStr&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">package&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">signType&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;MD5&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">paySign&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">success&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fail&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="-注意事项-2">⚠️ 注意事项&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>AppID&lt;/strong>：此处必须使用&lt;strong>小程序&lt;/strong>的 AppID。&lt;/li>
&lt;li>&lt;strong>账号关联&lt;/strong>：小程序必须已关联到微信商户号。&lt;/li>
&lt;/ul>
&lt;h2 id="4-附录前端环境判断工具">4. 附录：前端环境判断工具&lt;/h2>
&lt;p>在发起支付前，我们需要根据当前运行环境（User Agent）来决定调用 JSAPI 支付还是 H5 支付。可以使用以下工具函数进行判断：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 获取当前运行平台
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @returns {string} &amp;#39;wecom&amp;#39; | &amp;#39;wechat&amp;#39; | &amp;#39;h5&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function getPlat() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const ua = window.navigator.userAgent.toLowerCase();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ua.includes(&amp;#39;wxwork&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;wecom&amp;#39;; // 企业微信环境（需使用企业微信JS-SDK或兼容JSAPI）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else if (ua.includes(&amp;#39;micromessenger&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;wechat&amp;#39;; // 微信内置浏览器（使用 JSAPI 支付）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;h5&amp;#39;; // 普通浏览器（使用 H5 支付）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 业务逻辑调用示例
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">const platform = getPlat();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if (platform === &amp;#39;wechat&amp;#39; || platform === &amp;#39;wecom&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 执行 JSAPI 支付逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#34;检测到微信环境，准备唤起 JSAPI 支付&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // doJSAPIPay();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">} else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 执行 H5 支付逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#34;检测到外部浏览器，准备唤起 H5 支付&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // doH5Pay();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="补充说明">补充说明&lt;/h3>
&lt;ul>
&lt;li>企业微信兼容性：在企业微信（wxwork）中，通常也兼容微信的 JSAPI 支付，但建议参考企业微信官方文档确认是否需要引入特定的 jweixin-module。&lt;/li>
&lt;li>小程序环境判断：如果您还需要判断是否在小程序 Webview 中，可以增加一个判断条件：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">if (ua.includes(&amp;#39;miniprogram&amp;#39;) || window.__wxjs_environment === &amp;#39;miniprogram&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;miniprogram&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>uniapp-h5自定义配置文件</title><link>https://changxiangyu.cn/p/uniapp-h5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</link><pubDate>Wed, 25 Jan 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/uniapp-h5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</guid><description>&lt;p>uniapp项目H5发行（发行-&amp;gt;网站-PC web或手机H5）打包后&lt;br>
如果要给项目封装一个请求，但请求地址必须读取配置文件，从配置文件中拿地址，后续随时更改配置文件，直接让请求地址发生变化。&lt;/p>
&lt;h2 id="解决方案">解决方案&lt;/h2>
&lt;p>核心思路：利用打包后的&lt;code>index.html&lt;/code>文件，原生&lt;code>&amp;lt;script&amp;gt;&lt;/code>引入配置文件，在全局可调用。
uniapp 官方解决方案（建议看一眼）：&lt;a class="link" href="https://uniapp.dcloud.io/collocation/manifest.html#h5=template" target="_blank" rel="noopener"
>&lt;/a>&lt;/p>
&lt;ol>
&lt;li>建立一个&lt;code>config.js&lt;/code>配置文件：
&lt;code>var config = { defaultUrl: &amp;quot;https://c3test.dassoft.cn&amp;quot;, tenantCode: &amp;quot;admin&amp;quot; }&lt;/code>&lt;br>
保存到桌面上即可，无需放到项目中。&lt;/li>
&lt;li>在项目根目录新建&lt;code>temp.h5.html&lt;/code>空文件，cli创建的话同理&lt;/li>
&lt;li>打开&lt;code>temp.h5.html&lt;/code>复制以下模板代码，&lt;code>&amp;lt;script&amp;gt;&lt;/code>引入配置文件：
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> &amp;lt;html lang=&amp;#34;zh-CN&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;meta charset=&amp;#34;utf-8&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;meta http-equiv=&amp;#34;X-UA-Compatible&amp;#34; content=&amp;#34;IE=edge&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;%= htmlWebpackPlugin.options.title %&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- Open Graph data --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:title&amp;#34; content=&amp;#34;Title Here&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:url&amp;#34; content=&amp;#34;http://www.example.com/&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:image&amp;#34; content=&amp;#34;http://example.com/image.jpg&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:description&amp;#34; content=&amp;#34;Description Here&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var coverSupport = &amp;#39;CSS&amp;#39; in window &amp;amp;&amp;amp; typeof CSS.supports === &amp;#39;function&amp;#39; &amp;amp;&amp;amp; (CSS.supports(&amp;#39;top: env(a)&amp;#39;) || CSS.supports(&amp;#39;top: constant(a)&amp;#39;))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> document.write(&amp;#39;&amp;lt;meta name=&amp;#34;viewport&amp;#34; content=&amp;#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&amp;#39; + (coverSupport ? &amp;#39;, viewport-fit=cover&amp;#39; : &amp;#39;&amp;#39;) + &amp;#39;&amp;#34; /&amp;gt;&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;link rel=&amp;#34;stylesheet&amp;#34; href=&amp;#34;&amp;lt;%= BASE_URL %&amp;gt;static/index.&amp;lt;%= VUE_APP_INDEX_CSS_HASH %&amp;gt;.css&amp;#34; /&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;noscript&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;strong&amp;gt;Please enable JavaScript to continue.&amp;lt;/strong&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/noscript&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;div id=&amp;#34;app&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- built files will be auto injected --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;script language=&amp;#34;javascript&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //使用了 sessionStorage和时间戳，这样可以防止 js和css的缓存,页面会话刷新时间为半小时
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var timestamp = new Date().getTime();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var versionStamp = sessionStorage.version;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (versionStamp == null || (timestamp - versionStamp) &amp;gt; 1800000) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sessionStorage.version = timestamp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> document.write(&amp;#39;&amp;lt;script src=&amp;#34;./config.js?v=&amp;#39; + sessionStorage.version + &amp;#39;&amp;#34;&amp;gt;&amp;lt;\/script\&amp;gt;&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/html&amp;gt;```
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>提前写好获取配置文件的代码（在哪里用配置文件就在那里写）&lt;br>
&lt;code>export const defaultUrl = config.defaultUrl;&lt;/code>&lt;br>
开发中，可以先写死参数，后续要打包后在变更。&lt;/li>
&lt;li>打开&lt;code>manifest.json&lt;/code>文件，将&lt;code>temp.h5.html&lt;/code>关联：
&lt;img src="https://changxiangyu.cn/images/uniapp/20251230_161923.png"
loading="lazy"
alt="展示示意图"
>&lt;/li>
&lt;li>都配置好后，执行编辑器菜单-&amp;gt;发行-&amp;gt;网站-PC web或手机H5,进行打包：
打包完成后，把&lt;code>h5&lt;/code>目录复制到桌面，如下图所示文件夹位置。
&lt;img src="https://changxiangyu.cn/images/uniapp/20251230163111.jpg"
loading="lazy"
alt="展示示意图"
>&lt;/li>
&lt;li>将配置文件&lt;code>config.js&lt;/code>加入到根目录，确保与&lt;code>index.html&lt;/code>同级&lt;/li>
&lt;li>&lt;img src="https://changxiangyu.cn/images/uniapp/20251230163119.jpg"
loading="lazy"
alt="展示示意图"
>
此时&lt;code>index.html&lt;/code>中的&lt;code>&amp;lt;script src=&amp;quot;./config.js&amp;gt;&lt;/code>就能正确找到配置文件，从而实现读取。
可以改变&lt;code>config.js&lt;/code>文件配置，然后刷新浏览器页面，查看是否更改。&lt;/li>
&lt;/ol></description></item><item><title>Docker容器占用大量存储</title><link>https://changxiangyu.cn/p/docker%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F%E5%AD%98%E5%82%A8/</link><pubDate>Tue, 17 Jan 2023 11:02:00 +0800</pubDate><guid>https://changxiangyu.cn/p/docker%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F%E5%AD%98%E5%82%A8/</guid><description>&lt;p>服务产生大量core文件，导致存储空间被占满
可通过命令&lt;code>find /home/docker -name core.*&lt;/code>查看产生core文件的路径（docker数据目录以现场配置为准）&lt;/p>
&lt;ol>
&lt;li>删除所有容器，包含base和c3目录下的
&lt;code>docker-compose down&lt;/code>&lt;/li>
&lt;li>使用df -h检查空间是否已经恢复&lt;/li>
&lt;li>修改&lt;code>docker-compose.yml&lt;/code>,在每个服务的最后增加以下配置：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> ulimits:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> core: 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://changxiangyu.cn/images/web/docker-1.png"
loading="lazy"
>
5. 启动docker容器
&lt;code>docker-compose up -d&lt;/code>&lt;/p></description></item><item><title>Uniapp H5端解决图片拍照旋转与压缩上传方案</title><link>https://changxiangyu.cn/p/uniapp-h5%E7%AB%AF%E8%A7%A3%E5%86%B3%E5%9B%BE%E7%89%87%E6%8B%8D%E7%85%A7%E6%97%8B%E8%BD%AC%E4%B8%8E%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0%E6%96%B9%E6%A1%88/</link><pubDate>Mon, 09 Jan 2023 10:00:00 +0800</pubDate><guid>https://changxiangyu.cn/p/uniapp-h5%E7%AB%AF%E8%A7%A3%E5%86%B3%E5%9B%BE%E7%89%87%E6%8B%8D%E7%85%A7%E6%97%8B%E8%BD%AC%E4%B8%8E%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0%E6%96%B9%E6%A1%88/</guid><description>&lt;p>在 Uniapp 开发 H5 应用时，涉及到手机拍照上传的功能往往会遇到两个棘手的问题：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>图片方向不对&lt;/strong>：不同厂商的手机（尤其是 iOS 和部分 Android）在拍照时，图片实际上是“横着”保存的，通过 EXIF 信息标记了方向。直接在 &lt;code>img&lt;/code> 标签显示可能正常，但一旦绘制到 Canvas 或上传到服务器，图片就会歪掉（通常是旋转了 90 度）。&lt;/li>
&lt;li>&lt;strong>图片体积过大&lt;/strong>：手机原图动辄 5MB+，直接上传消耗流量且速度慢，需要在前端进行压缩。&lt;/li>
&lt;/ol>
&lt;p>本文将分享一个基于 &lt;code>Exif.js&lt;/code> 和 &lt;code>Canvas&lt;/code> 的完整解决方案。&lt;/p>
&lt;h2 id="准备工作">准备工作&lt;/h2>
&lt;p>我们需要引入两个核心工具库：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Exif.js&lt;/strong>：用于读取图片的元数据（Metadata），核心是获取 &lt;code>Orientation&lt;/code>（方向）标识。&lt;/li>
&lt;li>&lt;strong>Mobile-detect&lt;/strong>（可选）：用于辅助判断设备类型，处理特定机型的兼容性差异。&lt;/li>
&lt;/ol>
&lt;h3 id="1-引入-exifjs">1. 引入 Exif.js&lt;/h3>
&lt;p>由于 &lt;code>exif.js&lt;/code> 是一个较老的库，建议将其源码保存到项目中，例如 &lt;code>common/js/toolJs/exif.js&lt;/code>。
&lt;em>(注：由于源码较长，此处不贴出完整库代码，请直接下载官方版本或使用 npm 安装)&lt;/em>&lt;/p>
&lt;h3 id="2-核心组件实现">2. 核心组件实现&lt;/h3>
&lt;p>我们将功能封装在一个 Vue 组件中。主要流程如下：
&lt;code>选择图片&lt;/code> -&amp;gt; &lt;code>读取EXIF方向&lt;/code> -&amp;gt; &lt;code>Canvas重绘(旋转+压缩)&lt;/code> -&amp;gt; &lt;code>获取Base64&lt;/code> -&amp;gt; &lt;code>上传&lt;/code>。&lt;/p>
&lt;h4 id="html-结构">HTML 结构&lt;/h4>
&lt;p>简单的界面，包含预览图、拍照按钮和上传按钮。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;template&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;container&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;image :src=&amp;#34;photoSrc&amp;#34; mode=&amp;#34;aspectFit&amp;#34; style=&amp;#34;width: 100%; height: 300px;&amp;#34;&amp;gt;&amp;lt;/image&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;button type=&amp;#34;primary&amp;#34; @click=&amp;#34;takePhoto&amp;#34;&amp;gt;拍照/选图&amp;lt;/button&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;button type=&amp;#34;primary&amp;#34; @click=&amp;#34;uploadPhoto&amp;#34; :disabled=&amp;#34;!photoSrc&amp;#34;&amp;gt;上传&amp;lt;/button&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/template&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="核心-js-逻辑">核心 JS 逻辑&lt;/h3>
&lt;p>首先引入必要的库：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import EXIF from &amp;#39;../../common/js/toolJs/exif.js&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import MobileDetect from &amp;#39;mobile-detect&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export default {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> data() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> photoSrc: &amp;#39;&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> methods: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ...后续方法
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="关键步骤解析">关键步骤解析&lt;/h3>
&lt;ol>
&lt;li>获取图片并开启处理流程
使用 &lt;code>uni.chooseImage&lt;/code> 获取图片，然后调用 &lt;code>detail&lt;/code> 方法进行处理。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">takePhoto() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uni.chooseImage({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> count: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> success: async (res) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 开启异步处理流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.photoSrc = await this.detail(res.tempFilePaths[0])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fail: (res) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.error(res)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>读取 EXIF Orientation 信息
这是修正方向的关键。我们需要封装一个 Promise 方法来读取图片的 Orientation 标签。&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>1: 正常&lt;/li>
&lt;li>6: 顺时针旋转90度&lt;/li>
&lt;li>8: 逆时针旋转90度&lt;/li>
&lt;li>3: 旋转180度&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">getImageTag(file, tag, suc) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!file) return 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return new Promise((resolve, reject) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let imgObj = new Image()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imgObj.src = file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uni.getImageInfo({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> src: file,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> success(res) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EXIF.getData(imgObj, function() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EXIF.getAllTags(this);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 获取方向标记
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let or = EXIF.getTag(this, &amp;#39;Orientation&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resolve(suc(or))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>Canvas 旋转与压缩
这是最复杂的环节。我们需要根据 &lt;code>Orientation&lt;/code> 的值，利用 &lt;code>Canvas&lt;/code> 的 &lt;code>rotate&lt;/code> 方法将图片“扳正”。同时，通过控制 &lt;code>Canvas&lt;/code> 的尺寸来实现压缩。&lt;/li>
&lt;/ol>
&lt;p>注意：代码中加入了一个 &lt;code>getPlat()&lt;/code> 判断，这是因为在实际测试中发现，部分 Android 环境下 Canvas 的旋转行为可能与 iOS 不一致，需要做特殊处理。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// 判断是否为 Android 终端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">getPlat() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let u = navigator.userAgent;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return u.indexOf(&amp;#39;Android&amp;#39;) &amp;gt; -1 || u.indexOf(&amp;#39;Adr&amp;#39;) &amp;gt; -1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">async detail(url) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let maxWidth = 800; // 设置最大宽度进行压缩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let Orientation = 1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 1. 获取方向
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await this.getImageTag(url, &amp;#39;Orientation&amp;#39;, function(e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (e != undefined) Orientation = e;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var img = null;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var canvas = null;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 2. 加载图片资源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await this.comprossImage(url, maxWidth, function(e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img = e.img;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas = e.canvas;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#34;图片方向角:&amp;#34;, Orientation)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let baseStr = &amp;#39;&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 3. 根据方向角进行旋转修正
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 注意：这里针对不同平台做了一些特定逻辑处理（根据实际调试情况调整）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switch (Orientation) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 6: // 需要顺时针（向右）90度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.getPlat() ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;right&amp;#39;, canvas) :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;&amp;#39;, canvas); // 某些安卓机型可能不需要手动旋，视具体Webview内核而定
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 8: // 需要逆时针（向左）90度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.getPlat() ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;left&amp;#39;, canvas) :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;&amp;#39;, canvas);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 3: // 180度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.rotateImg(img, &amp;#39;right&amp;#39;, canvas, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.rotateImg(img, &amp;#39;&amp;#39;, canvas);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return baseStr;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>旋转的具体实现 (rotateImg)
利用 &lt;code>Canvas&lt;/code> 上下文的 &lt;code>rotate&lt;/code> 和 &lt;code>drawImage&lt;/code>。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rotateImg(img, direction, canvas, times = 1) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ...初始化参数，计算宽高...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var width = img.width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var height = img.height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 压缩逻辑：限制最大宽度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let maxWidth = 800;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (width &amp;gt; maxWidth) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> height = Math.floor(height * (maxWidth / width));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> width = maxWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 旋转角度计算
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var step = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (direction == &amp;#39;right&amp;#39;) step += times;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else if (direction == &amp;#39;left&amp;#39;) step -= times;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var degree = step * 90 * Math.PI / 180;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var ctx = canvas.getContext(&amp;#39;2d&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switch (step) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 1: // 旋转90度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.rotate(degree);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, 0, -height, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 2: // 旋转180度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.rotate(degree);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, -width, -height, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 3: // 旋转270度（-90度）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.rotate(degree);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, -width, 0, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default: // 不旋转
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, 0, 0, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 输出压缩后的 Base64，quality 设置为 0.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return canvas.toDataURL(&amp;#34;image/jpeg&amp;#34;, 0.8);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>上传逻辑
最后，将获取到的 Base64 字符串（去除头部信息后）发送给后端。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">uploadPhoto() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!this.photoSrc) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let obj = {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 去除 base64 头部，后端通常只需要内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Photo: this.photoSrc.split(&amp;#39;;base64,&amp;#39;)[1],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimeStamp: new Date().getTime(),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ...其他业务参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 发起请求
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // this.$http.baseRequest(...)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="遇到的坑与总结">遇到的坑与总结&lt;/h2>
&lt;ul>
&lt;li>Canvas 宽高混淆：当图片旋转 90 度时，Canvas 的 width 和 height 必须互换，否则图片会被裁剪或拉伸。&lt;/li>
&lt;li>Android 兼容性：代码中 this.getPlat() 的判断非常重要。部分 Android 手机的 WebView 或者浏览器在上传图片时会自动修正方向，如果我们再手动旋转一次，图片反而会歪掉。建议在真机上多测试几款主流机型。&lt;/li>
&lt;li>内存溢出：对于超大分辨率的图片（如 4000x3000），Canvas 绘制可能会导致 iOS Webview 崩溃（OOM）。解决方案是在绘制前先大幅度压缩图片尺寸（如限制 maxWidth）。&lt;/li>
&lt;/ul>
&lt;p>通过以上方案，我们不仅解决了图片“歪脖子”的问题，还实现了前端压缩，大大减轻了服务器带宽压力。&lt;/p></description></item><item><title>uniapp拍照上传图片h5</title><link>https://changxiangyu.cn/p/uniapp%E6%8B%8D%E7%85%A7%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87h5/</link><pubDate>Fri, 30 Dec 2022 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/uniapp%E6%8B%8D%E7%85%A7%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87h5/</guid><description>&lt;h1 id="step-1-界面代码实现">Step 1: 界面代码实现&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;template&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;body&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;btn&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;picture-img&amp;#34; ref=&amp;#34;uploadContent&amp;#34; id=&amp;#34;uploadContent&amp;#34; @click=&amp;#34;takePhotos()&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;div class=&amp;#34;loader-19&amp;#34; v-if=&amp;#34;loader&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;点击修改
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/template&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="step-2-使用到的方法">Step 2: 使用到的方法&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;span class="lnt">96
&lt;/span>&lt;span class="lnt">97
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">takePhotos() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const _that = this;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (document.getElementById(&amp;#34;take-picture&amp;#34;) == null) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let input = _that.createInputAndSetAttribute();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.$refs.uploadContent.$el.appendChild(input);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.onchange = async (event) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.loader = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var files = event.target.files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (files &amp;amp;&amp;amp; files.length &amp;gt; 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const file = files[0];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 压缩图片需要的一些元素和对象
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var reader = new FileReader(),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img = new Image();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 缩放图片需要的canvas
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var canvas = document.createElement(&amp;#39;canvas&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var context = canvas.getContext(&amp;#39;2d&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // base64地址图片加载完毕后
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.onload = function() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 图片原始尺寸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var originWidth = this.width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var originHeight = this.height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 最大尺寸限制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var maxWidth = 960,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxHeight = 1280;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 目标尺寸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var targetWidth = originWidth,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = originHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 图片尺寸超过400x400的限制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth &amp;gt; maxWidth || originHeight &amp;gt; maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth / originHeight &amp;gt; maxWidth / maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 更宽，按照宽度限定尺寸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = maxWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = Math.round(maxWidth * (originHeight / originWidth));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = maxHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = Math.round(maxHeight * (originWidth / originHeight));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // canvas对图片进行缩放
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = targetWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = targetHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 清除画布
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.clearRect(0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 图片压缩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.drawImage(img, 0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // canvas转为blob并上传
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.toBlob(async (blob) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const newFile = new File([blob], &amp;#39;123.jpg&amp;#39;, {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: blob.type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const imgPath = await upload(newFile, file.path, `/qy/photo`)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const detectionRes = await detection(imgPath)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await editFacePhoto(detectionRes).then(res =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (res.code === 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.photoSrc = res.imgUrl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.$u.toast(&amp;#34;上传成功！&amp;#34;, 2000)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.$u.toast(res.msg, 3000)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.loader = false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.removeDocument()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }, file.type || &amp;#39;image/png&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 文件base64化，以便获知图片原始尺寸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.onload = function(e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.src = e.target.result;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.readAsDataURL(file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> document.querySelector(&amp;#34;#take-picture&amp;#34;).click();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 创建input并设置input的属性
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">createInputAndSetAttribute() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var input = document.createElement(&amp;#39;input&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.type = &amp;#39;file&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.id = &amp;#39;take-picture&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.accept = &amp;#39;image/*&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // input.capture = &amp;#39;user&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.opacity = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.position = &amp;#39;absolute&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.top = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.left = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.width = &amp;#39;50px&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.height = &amp;#39;50px&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return input;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// 移除input节点
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">removeDocument() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const uploadContent = document.getElementById(&amp;#34;uploadContent&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const takePicture = document.getElementById(&amp;#34;take-picture&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uploadContent.removeChild(takePicture);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可参考： &lt;a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" target="_blank" rel="noopener"
>https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file&lt;/a>&lt;/p>
&lt;h2 id="目前的实现方式有几个优化点">目前的实现方式有几个优化点：&lt;/h2>
&lt;ol>
&lt;li>Vue 违规操作：在 Vue/Uniapp 中频繁使用 document.createElement、appendChild 和 removeChild 是不推荐的（这是 jQuery 时代的思维），应该利用 Vue 的模板语法。&lt;/li>
&lt;li>回调地狱：FileReader、Image.onload、canvas.toBlob 层层嵌套，代码难以维护。&lt;/li>
&lt;li>逻辑耦合：压缩逻辑、上传逻辑和 UI 交互混在一起。
以下是优化后的版本，采用 Vue 数据驱动 的方式，并将压缩逻辑封装为 Promise，使代码清晰易读。&lt;/li>
&lt;/ol>
&lt;h2 id="优化思路">优化思路&lt;/h2>
&lt;ol>
&lt;li>&lt;strong>移除 DOM 操作&lt;/strong>：将 &lt;code>&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;&lt;/code> 直接写在 &lt;code>&amp;lt;template&amp;gt;&lt;/code> 中并通过 &lt;code>v-show&lt;/code> 隐藏，通过 &lt;code>ref&lt;/code> 触发点击，避免动态创建销毁 DOM。&lt;/li>
&lt;li>&lt;strong>异步扁平化&lt;/strong>：将图片加载和 Canvas 压缩逻辑封装成 &lt;code>Promise&lt;/code>，使用 &lt;code>async/await&lt;/code> 替代回调函数。&lt;/li>
&lt;li>&lt;strong>功能拆分&lt;/strong>：将“选择图片”、“压缩图片”、“上传业务”拆分为独立方法。&lt;/li>
&lt;/ol>
&lt;h2 id="step-1-界面代码实现-1">Step 1: 界面代码实现&lt;/h2>
&lt;p>使用 &lt;code>ref&lt;/code> 引用隐藏的 input 元素，保持页面结构整洁。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">view&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;body&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">view&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;btn&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- 触发按钮 --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">view&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;picture-img&amp;#34;&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="na">click&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;triggerSelect&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;loader-19&amp;#34;&lt;/span> &lt;span class="na">v-if&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;loader&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {{ loader ? &amp;#39;处理中...&amp;#39; : &amp;#39;点击修改&amp;#39; }}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">view&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- 隐藏的原生Input，用于H5调用相机/文件 --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- accept=&amp;#34;image/*&amp;#34; 限制图片，capture=&amp;#34;user&amp;#34; 可选：强制调用前置摄像头 --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;file&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">ref&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;fileInput&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">accept&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;image/*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;hidden-input&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">@&lt;/span>&lt;span class="na">change&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;handleFileChange&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">view&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">view&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">style&lt;/span> &lt;span class="na">scoped&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>&lt;span class="nc">hidden-input&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">display&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c">/* 隐藏input */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">/* 你的其他样式... */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="step-2-逻辑实现-script">Step 2: 逻辑实现 (Script)&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">export default {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> data() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> loader: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> photoSrc: &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> methods: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 1. 触发文件选择
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> triggerSelect() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 在Uniapp H5中，通过$refs获取原生DOM元素并点击
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 注意：App端不支持此操作，App端请使用 uni.chooseImage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$refs.fileInput.click();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 2. 监听文件改变
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> async handleFileChange(event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const files = event.target.files;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!files || files.length === 0) return;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.loader = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const file = files[0];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> try {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // A. 压缩图片
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const { blob, filename } = await this.compressImage(file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // B. 构造新的File对象 (解决部分浏览器兼容性)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const newFile = new File([blob], filename || &amp;#39;compressed.jpg&amp;#39;, { type: blob.type });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // C. 执行上传业务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await this.uploadProcess(newFile, file.path); // file.path 在H5 input中可能不存在，视业务需求调整
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } catch (error) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.error(&amp;#34;处理失败&amp;#34;, error);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$u.toast(&amp;#34;图片处理失败&amp;#34;, 2000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } finally {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.loader = false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 清空value，确保下次选择同一张图也能触发change事件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> event.target.value = &amp;#39;&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 3. 核心：图片压缩工具函数 (返回Promise)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> compressImage(file) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return new Promise((resolve, reject) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const reader = new FileReader();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.readAsDataURL(file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.onload = (e) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const img = new Image();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.src = e.target.result;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.onload = () =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 原始尺寸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const originWidth = img.width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const originHeight = img.height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 目标尺寸配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const maxWidth = 960;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const maxHeight = 1280;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let targetWidth = originWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let targetHeight = originHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 计算缩放比例
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth &amp;gt; maxWidth || originHeight &amp;gt; maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth / originHeight &amp;gt; maxWidth / maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = maxWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = Math.round(maxWidth * (originHeight / originWidth));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = maxHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = Math.round(maxHeight * (originWidth / originHeight));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Canvas 绘制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const canvas = document.createElement(&amp;#39;canvas&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const context = canvas.getContext(&amp;#39;2d&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = targetWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = targetHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.clearRect(0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.drawImage(img, 0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 导出 Blob
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.toBlob((blob) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (blob) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resolve({ blob, filename: file.name });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reject(new Error(&amp;#39;Canvas to Blob failed&amp;#39;));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }, file.type || &amp;#39;image/jpeg&amp;#39;, 0.8); // 0.8 为压缩质量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.onerror = (err) =&amp;gt; reject(err);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.onerror = (err) =&amp;gt; reject(err);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 4. 上传业务逻辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> async uploadProcess(file, originalPath) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 假设 upload, detection, editFacePhoto 已导入或定义
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const imgPath = await upload(file, originalPath, `/qy/photo`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const detectionRes = await detection(imgPath);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const res = await editFacePhoto(detectionRes);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (res.code === 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.photoSrc = res.imgUrl;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$u.toast(&amp;#34;上传成功！&amp;#34;, 2000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$u.toast(res.msg, 3000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="关键改进点说明">关键改进点说明&lt;/h3>
&lt;ol>
&lt;li>Input 复用：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>原代码每次点击都 &lt;code>createElement&lt;/code>，不仅性能低，而且在部分安卓 WebView 中可能因为 DOM 未完全插入而无法唤起相机。&lt;/li>
&lt;li>新代码将&lt;code> &amp;lt;input&amp;gt;&lt;/code> 静态化，利用 &lt;code>event.target.value = ''&lt;/code> 重置状态，确保稳定性。&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>Promise 封装：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>原代码在 &lt;code>img.onload&lt;/code> 内部嵌套了大量业务逻辑。&lt;/li>
&lt;li>新代码将压缩逻辑提取为 &lt;code>compressImage&lt;/code>，返回 Promise，使得主流程 &lt;code>handleFileChange&lt;/code> 可以使用 &lt;code>await&lt;/code> 顺序执行，逻辑一目了然。&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>兼容性处理：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>增加了 &lt;code>canvas.toBlob&lt;/code> 的质量参数（0.8），可进一步减小体积。&lt;/li>
&lt;li>增加了 &lt;code>input&lt;/code> 的 &lt;code>display: none&lt;/code> 样式，避免页面出现奇怪的占位。&lt;/li>
&lt;/ul></description></item><item><title>单服务器绑定多个域名</title><link>https://changxiangyu.cn/p/%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%91%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%9F%9F%E5%90%8D/</link><pubDate>Wed, 05 Oct 2022 20:46:00 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%91%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%9F%9F%E5%90%8D/</guid><description>&lt;blockquote>
&lt;p>参考: &lt;a class="link" href="https://cloud.tencent.com/document/product/400/35244" target="_blank" rel="noopener"
>https://cloud.tencent.com/document/product/400/35244&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h1 id="环境">环境&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">~$ nginx -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx version: nginx/1.18.0 (Ubuntu)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="申请-ssl-证书">申请 SSL 证书&lt;/h1>
&lt;p>&lt;a class="link" href="https://console.cloud.tencent.com/ssl" target="_blank" rel="noopener"
>腾讯云&lt;/a>&lt;/p>
&lt;p>下载 Nginx 服务器类型&lt;/p>
&lt;p>解压发送&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">scp {chenjinxin.cn_bundle.crt,chenjinxin.cn.key} root@changxiangyu.cn:/usr/share/nginx/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="编辑服务器-nginx-配置文件-etcnginxnginxconf">编辑服务器 Nginx 配置文件 /etc/nginx/nginx.conf&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">user www-data;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker_processes auto;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pid /run/nginx.pid;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">include /etc/nginx/modules-enabled/*.conf;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">events {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> worker_connections 768;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # multi_accept on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">http {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # changxiangyu.cn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen [::]:80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name changxiangyu.cn www.changxiangyu.cn;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #把http的域名请求转成https
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # root /home/sammy/blog/public;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #location /images {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # root /home/sammy/data/;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # autoindex on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 443 ssl;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /usr/share/nginx/changxiangyu.cn_bundle.crt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /usr/share/nginx/changxiangyu.cn.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_session_timeout 5m;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #请按照以下协议配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_prefer_server_ciphers on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name changxiangyu.cn www.changxiangyu.cn;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /home/sammy/blog/public;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location /images {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /home/sammy/data/;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> autoindex on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # chenjinxin.cn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen [::]:80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name chenjinxin.cn www.chenjinxin.cn;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #把http的域名请求转成https
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 443 ssl;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /usr/share/nginx/chenjinxin.cn_bundle.crt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /usr/share/nginx/chenjinxin.cn.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_session_timeout 5m;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #请按照以下协议配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_prefer_server_ciphers on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name chenjinxin.cn www.chenjinxin.cn;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /home/sammy/cjx_blog/public;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location /images {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /home/sammy/data/;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> autoindex on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Basic Settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sendfile on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tcp_nopush on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tcp_nodelay on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> keepalive_timeout 65;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> types_hash_max_size 2048;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # server_tokens off;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # server_names_hash_bucket_size 64;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # server_name_in_redirect off;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/mime.types;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default_type application/octet-stream;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # SSL Settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_prefer_server_ciphers on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Logging Settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access_log /var/log/nginx/access.log;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> error_log /var/log/nginx/error.log;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Gzip Settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gzip on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # gzip_vary on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # gzip_proxied any;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # gzip_comp_level 6;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # gzip_buffers 16 8k;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # gzip_http_version 1.1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Virtual Host Configs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/conf.d/*.conf;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/sites-enabled/*;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#mail {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># # See sample authentication script at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># # auth_http localhost/auth.php;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># # pop3_capabilities &amp;#34;TOP&amp;#34; &amp;#34;USER&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># # imap_capabilities &amp;#34;IMAP4rev1&amp;#34; &amp;#34;UIDPLUS&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># listen localhost:110;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># protocol pop3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># proxy on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># listen localhost:143;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># protocol imap;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># proxy on;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="验证配置文件问题">验证配置文件问题&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo /usr/sbin/nginx -t
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="重载-nginx">重载 Nginx&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo /usr/sbin/nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>成功后即可使用 &lt;code>chenjinxin.cn&lt;/code> 进行访问&lt;/p></description></item><item><title>ssh服务</title><link>https://changxiangyu.cn/p/ssh%E6%9C%8D%E5%8A%A1/</link><pubDate>Tue, 13 Sep 2022 14:44:00 +0800</pubDate><guid>https://changxiangyu.cn/p/ssh%E6%9C%8D%E5%8A%A1/</guid><description>&lt;h2 id="更新源">更新源&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装ssh服务">安装ssh服务&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt-get install openssh-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="验证ssh服务">验证SSH服务&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl status ssh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="创建密钥">创建密钥&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ssh-keygen
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Linux命令行上传文件到百度网盘</title><link>https://changxiangyu.cn/p/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/</link><pubDate>Wed, 07 Sep 2022 14:18:00 +0800</pubDate><guid>https://changxiangyu.cn/p/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/</guid><description>&lt;blockquote>
&lt;p>参考: &lt;a class="link" href="https://www.jianshu.com/p/dc7e86b171cb" target="_blank" rel="noopener"
>https://www.jianshu.com/p/dc7e86b171cb&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="安装软件工具">安装软件工具&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pip install requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip install bypy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="授权登陆">授权登陆&lt;/h2>
&lt;p>执行 bypy info，显示下边信息，根据提示，通过浏览器访问下边灰色的https链接，如果此时百度网盘账号正在登陆，会出现长串授权码，复制。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@yu~]# bypy info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please visit: # 访问下边这个连接，复制授权码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://openapi.baidu.com/oauth/2.0/authorize?scope=basic+netdisk&amp;amp;redirect_uri=oob&amp;amp;response_type=code&amp;amp;client_id=q8WE4EpCsau1oS0MplgMKNBn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">And authorize this app
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Paste the Authorization Code here within 10 minutes.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press [Enter] when you are done # 提示在下边粘贴授权码
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在下边图示位置粘贴授权码，耐心等待一会即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Press [Enter] when you are done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2d2416c9e27c5b19f14da97c82daf18e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authorizing, please be patient, it may take upto 300 seconds...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Quota: 14.020TB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Used: 5.497TB
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>授权成功。&lt;/p>
&lt;h2 id="测试上传和同步本地文件到云盘">测试上传和同步本地文件到云盘&lt;/h2>
&lt;p>由于百度PCS API权限限制，程序只能存取百度云端/apps/bypy目录下面的文件和目录。我们可以通过：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@yu~]# bypy list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/apps/bypy ($t $f $s $m $d):
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把本地当前目录下的文件同步到百度云盘：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bypy upload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把云盘上的内容同步到本地:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bypy downdir
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>比较本地当前目录和云盘根目录，看是否一致，来判断是否同步成功：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bypy compare
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>SSH远程执行脚本报错command not found和环境变量问题</title><link>https://changxiangyu.cn/p/ssh%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%8A%A5%E9%94%99command-not-found%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%97%AE%E9%A2%98/</link><pubDate>Tue, 06 Sep 2022 11:33:18 +0800</pubDate><guid>https://changxiangyu.cn/p/ssh%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%8A%A5%E9%94%99command-not-found%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%97%AE%E9%A2%98/</guid><description>&lt;p>参考: &lt;a class="link" href="https://blog.csdn.net/nklinsirui/article/details/104673286" target="_blank" rel="noopener"
>https://blog.csdn.net/nklinsirui/article/details/104673286&lt;/a>&lt;/p>
&lt;h1 id="ssh远程执行脚本报错">SSH远程执行脚本报错&lt;/h1>
&lt;p>SSH 远程执行脚本报错&amp;quot;command not found&amp;quot;。在宿主机可以执行命令。&lt;/p>
&lt;p>原因是之前将环境变量配置在了 /etc/profile 中，但是SSH远程执行脚本时实际上执行的是 non-login shell，而 non-login shell不会读取 /etc/profile 配置文件，只读取 ~/.bashrc。&lt;/p>
&lt;h1 id="login-shell和non-login-shell">login shell和non-login shell&lt;/h1>
&lt;p>用SSH客户端登陆Linux系统时，要求输入用户名/密码登录或根据SSH key登录时，就是login shell。&lt;/p>
&lt;p>而在A机器上再用SSH免密码登录B机器，在B机器上执行Shell脚本，就是non-login shell。&lt;/p>
&lt;p>用Ansible在目标机器上远程执行Shell脚本时，也是non-login shell，因为Ansible是基于SSH的。&lt;/p>
&lt;h2 id="login-shell和non-login-shell读取的环境变量配置文件">login shell和non-login shell读取的环境变量配置文件&lt;/h2>
&lt;p>login-shell读取环境变量配置文件：&lt;/p>
&lt;ul>
&lt;li>/etc/profile&lt;/li>
&lt;li>~/.bash_profile&lt;/li>
&lt;li>~/.profile&lt;/li>
&lt;li>~/.bashrc&lt;/li>
&lt;li>/etc/bashrc&lt;/li>
&lt;/ul>
&lt;p>注意：~/.bash_profile中已经引入了~/.bashrc，而~/.bashrc引入了/etc/bashrc，因此login shell可以读取到~/.bashrc和/etc/bashrc的配置。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Get the aliases and functions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if [ -f ~/.bashrc ]; then
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> . ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>non-login shell读取环境变量配置文件：&lt;/p>
&lt;ul>
&lt;li>/etc/bashrc&lt;/li>
&lt;li>~/.bashrc&lt;/li>
&lt;/ul>
&lt;h1 id="解决non-login-shell的环境配置问题">解决non-login shell的环境配置问题&lt;/h1>
&lt;p>方法一：&lt;/p>
&lt;p>将login-shell和non-login shell都需要的环境配置放在~/.bashrc中，其它配置放在~/.bash_profile中。&lt;/p>
&lt;p>方法二：&lt;/p>
&lt;p>如果环境配置只放在~/.bash_profile中，需要执行non-login shell时先source ~/.bash_profile再执行命令。&lt;/p>
&lt;p>方法三：&lt;/p>
&lt;p>在 ~/.bashrc 里添加: . /etc/profile。（立即生效需要: source ~/.bashrc）&lt;/p></description></item><item><title>VLC播放器快捷键</title><link>https://changxiangyu.cn/p/vlc%E6%92%AD%E6%94%BE%E5%99%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/</link><pubDate>Sun, 04 Sep 2022 16:25:18 +0800</pubDate><guid>https://changxiangyu.cn/p/vlc%E6%92%AD%E6%94%BE%E5%99%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/</guid><description>&lt;p>参考: &lt;a class="link" href="https://www.cnblogs.com/pandabang/p/10441242.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/pandabang/p/10441242.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>音量大/小：上/下&lt;/p>
&lt;/li>
&lt;li>
&lt;p>静音开/关：M&lt;/p>
&lt;/li>
&lt;li>
&lt;p>回退/快进：ALT+左/右（步进10s），CTRL+左/右（步进1min）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>跳到指定时间：CTRL+T&lt;/p>
&lt;/li>
&lt;li>
&lt;p>播放/暂停：空格&lt;/p>
&lt;/li>
&lt;li>
&lt;p>停止播放：S（与暂停不同，按下停止后播放进度条回到视频最开始，且窗口不显示视频；而暂停时，窗口显示暂停时的视频）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>播放速度：{或- 减慢，最慢速度0.02倍正常速度；} 加速，最快速度31.25倍正常速度； = 正常速度&lt;/p>
&lt;/li>
&lt;li>
&lt;p>全屏开/关：F&lt;/p>
&lt;/li>
&lt;li>
&lt;p>纵横比切换：A（默认、16:9、4:3、1:1、16:10、2.21:1、2:35:1、2.39:1、5:4）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>窗口尺寸切换：Z（¼、½、原始尺寸、2倍原始尺寸）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>显示播放时间/总时长：T&lt;/p>
&lt;/li>
&lt;li>
&lt;p>播放控件显示/不显示：CTRL+H&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>linux 系统，使用源码安装 Python</title><link>https://changxiangyu.cn/p/linux-%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85-python/</link><pubDate>Fri, 26 Aug 2022 16:27:18 +0800</pubDate><guid>https://changxiangyu.cn/p/linux-%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85-python/</guid><description>&lt;p>参考：https://blog.csdn.net/wxhcyy/article/details/107718794&lt;/p>
&lt;ol>
&lt;li>下载安装文件&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 链接从官方找
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://www.python.org/ftp/python/3.6.8/Python-3.6.8.tar.xz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>解压&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">export d_path=&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xf Python-3.6.8.tar.xz -C $d_path
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>安装&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd $d_path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./configure --prefix=$d_path/python3.6.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>测试&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$d_path/python3.6.8/python -V
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>pycharm 项目配置虚拟环境</title><link>https://changxiangyu.cn/p/pycharm-%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/</link><pubDate>Fri, 26 Aug 2022 15:04:18 +0800</pubDate><guid>https://changxiangyu.cn/p/pycharm-%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/</guid><description>&lt;p>File -&amp;gt; Settings -&amp;gt; Project: project_name -&amp;gt; Project Interpreter -&amp;gt; Add&amp;hellip; -&amp;gt; Virtualenv Environment -&amp;gt; (配置) -&amp;gt; OK&lt;/p>
&lt;p>source project_path/venv/bin/activate&lt;/p>
&lt;h3 id="命令行">命令行&lt;/h3>
&lt;p>Installation&lt;/p>
&lt;p>To install virtualenv via pip run:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ pip3 install virtualenv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Usage&lt;/p>
&lt;p>Creation of virtualenv:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virtualenv -p python3 &amp;lt;desired-path&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Activate the virtualenv:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ source &amp;lt;desired-path&amp;gt;/bin/activate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Deactivate the virtualenv:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ deactivate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>git http方式免密提交</title><link>https://changxiangyu.cn/p/git-http%E6%96%B9%E5%BC%8F%E5%85%8D%E5%AF%86%E6%8F%90%E4%BA%A4/</link><pubDate>Fri, 26 Aug 2022 14:36:18 +0800</pubDate><guid>https://changxiangyu.cn/p/git-http%E6%96%B9%E5%BC%8F%E5%85%8D%E5%AF%86%E6%8F%90%E4%BA%A4/</guid><description>&lt;p>转载：https://juejin.cn/post/6844903602968854542&lt;/p>
&lt;h2 id="设置记住密码默认15分钟">设置记住密码（默认15分钟）&lt;/h2>
&lt;p>可以将你的密码缓存下来，只用输一次密码，以后都可以不用输入了。缺点就是密码都明文保存在 &lt;code>~/.git-credential&lt;/code> 文件中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git config --global credential.helper cache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果想自己设置时间，可以使用以下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git config credential.helper &amp;#39;cache --timeout=3600&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就设置一个小时之后失效&lt;/p>
&lt;h2 id="长期存储密码">长期存储密码：&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git config --global credential.helper store
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>增加远程地址的时候带上密码也是可以的。(推荐)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">http://yourname:password@git.oschina.net/name/project.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>补充：使用客户端也可以存储密码。&lt;/p>
&lt;h2 id="如果你正在使用ssh而且想体验https带来的高速那么你可以这样做">如果你正在使用ssh而且想体验https带来的高速，那么你可以这样做：&lt;/h2>
&lt;p>切换到项目目录下 ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd project/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>移除远程ssh方式的仓库地址&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git remote rm origin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>复制代码增加https远程仓库地址&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git remote add origin http://yourname:password@git.oschina.net/name/project.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>远程传输文件-rsync</title><link>https://changxiangyu.cn/p/%E8%BF%9C%E7%A8%8B%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6-rsync/</link><pubDate>Fri, 19 Aug 2022 17:03:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E8%BF%9C%E7%A8%8B%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6-rsync/</guid><description>&lt;p>参考链接&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.ruanyifeng.com/blog/2020/08/rsync.html" target="_blank" rel="noopener"
>https://www.ruanyifeng.com/blog/2020/08/rsync.html&lt;/a>&lt;/li>
&lt;li>How To Use Rsync to Sync Local and Remote Directories on a VPS, Justin Ellingwood&lt;/li>
&lt;li>Mirror Your Web Site With rsync, Falko Timme&lt;/li>
&lt;li>Examples on how to use Rsync, Egidio Docile&lt;/li>
&lt;li>How to create incremental backups using rsync on Linux, Egidio Docile&lt;/li>
&lt;/ul>
&lt;h1 id="一简介">一、简介&lt;/h1>
&lt;p>rsync 是一个常用的 Linux 应用程序，用于文件同步。&lt;/p>
&lt;p>它可以在本地计算机与远程计算机之间，或者两个本地目录之间同步文件（但不支持两台远程计算机之间的同步）。它也可以当作文件复制工具，替代cp和mv命令。&lt;/p>
&lt;p>它名称里面的r指的是 remote，rsync 其实就是&amp;quot;远程同步&amp;quot;（remote sync）的意思。与其他文件传输工具（如 FTP 或 scp）不同，rsync 的最大特点是会检查发送方和接收方已有的文件，仅传输有变动的部分（默认规则是文件大小或修改时间有变动）。&lt;/p>
&lt;h1 id="二安装">二、安装&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Ubuntu/Debian
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo apt-get install rsync
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># CentOS/Red Hat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo yum install rsync
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意，传输的双方都必须安装 rsync。&lt;/p>
&lt;h2 id="三基本用法">三、基本用法&lt;/h2>
&lt;h2 id="31--r-参数">3.1 -r 参数&lt;/h2>
&lt;p>本机使用 rsync 命令时，可以作为cp和mv命令的替代方法，将源目录同步到目标目录。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -r source destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令中，-r表示递归，即包含子目录。注意，-r是必须的，否则 rsync 运行不会成功。source目录表示源目录，destination表示目标目录。&lt;/p>
&lt;p>如果有多个文件或目录需要同步，可以写成下面这样。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -r source1 source2 destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令中，source1、source2都会被同步到destination目录。&lt;/p>
&lt;h2 id="32--a-参数">3.2 -a 参数&lt;/h2>
&lt;p>-a参数可以替代-r，除了可以递归同步以外，还可以同步元信息（比如修改时间、权限等）。由于 rsync 默认使用文件大小和修改时间决定文件是否需要更新，所以-a比-r更有用。下面的用法才是常见的写法。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -a source destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>目标目录destination如果不存在，rsync 会自动创建。执行上面的命令后，源目录source被完整地复制到了目标目录destination下面，即形成了destination/source的目录结构。&lt;/p>
&lt;p>如果只想同步源目录source里面的内容到目标目录destination，则需要在源目录后面加上斜杠。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -a source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令执行后，source目录里面的内容，就都被复制到了destination目录里面，并不会在destination下面创建一个source子目录。&lt;/p>
&lt;h2 id="33--n-参数">3.3 -n 参数&lt;/h2>
&lt;p>如果不确定 rsync 执行后会产生什么结果，可以先用-n或&amp;ndash;dry-run参数模拟执行的结果。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -anv source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令中，-n参数模拟命令执行的结果，并不真的执行命令。-v参数则是将结果输出到终端，这样就可以看到哪些内容会被同步。&lt;/p>
&lt;h2 id="34---delete-参数">3.4 &amp;ndash;delete 参数&lt;/h2>
&lt;p>默认情况下，rsync 只确保源目录的所有内容（明确排除的文件除外）都复制到目标目录。它不会使两个目录保持相同，并且不会删除文件。如果要使得目标目录成为源目录的镜像副本，则必须使用&amp;ndash;delete参数，这将删除只存在于目标目录、不存在于源目录的文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --delete source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令中，&amp;ndash;delete参数会使得destination成为source的一个镜像。&lt;/p>
&lt;h1 id="四排除文件">四、排除文件&lt;/h1>
&lt;h2 id="41---exclude-参数">4.1 &amp;ndash;exclude 参数&lt;/h2>
&lt;p>有时，我们希望同步时排除某些文件或目录，这时可以用&amp;ndash;exclude参数指定排除模式。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --exclude=&amp;#39;*.txt&amp;#39; source/ destination
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 或者
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ rsync -av --exclude &amp;#39;*.txt&amp;#39; source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令排除了所有 TXT 文件。&lt;/p>
&lt;p>注意，rsync 会同步以&amp;quot;点&amp;quot;开头的隐藏文件，如果要排除隐藏文件，可以这样写&amp;ndash;exclude=&amp;quot;.*&amp;quot;。&lt;/p>
&lt;p>如果要排除某个目录里面的所有文件，但不希望排除目录本身，可以写成下面这样。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --exclude &amp;#39;dir1/*&amp;#39; source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>多个排除模式，可以用多个&amp;ndash;exclude参数。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --exclude &amp;#39;file1.txt&amp;#39; --exclude &amp;#39;dir1/*&amp;#39; source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>多个排除模式也可以利用 Bash 的大扩号的扩展功能，只用一个&amp;ndash;exclude参数。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --exclude={&amp;#39;file1.txt&amp;#39;,&amp;#39;dir1/*&amp;#39;} source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果排除模式很多，可以将它们写入一个文件，每个模式一行，然后用&amp;ndash;exclude-from参数指定这个文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --exclude-from=&amp;#39;exclude-file.txt&amp;#39; source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="42---include-参数">4.2 &amp;ndash;include 参数&lt;/h2>
&lt;p>&amp;ndash;include参数用来指定必须同步的文件模式，往往与&amp;ndash;exclude结合使用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av --include=&amp;#34;*.txt&amp;#34; --exclude=&amp;#39;*&amp;#39; source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令指定同步时，排除所有文件，但是会包括 TXT 文件。&lt;/p>
&lt;h1 id="五远程同步">五、远程同步&lt;/h1>
&lt;h2 id="51-ssh-协议">5.1 SSH 协议&lt;/h2>
&lt;p>rsync 除了支持本地两个目录之间的同步，也支持远程同步。它可以将本地内容，同步到远程服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av source/ username@remote_host:destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>也可以将远程内容同步到本地。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av username@remote_host:source/ destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>rsync 默认使用 SSH 进行远程登录和数据传输。&lt;/p>
&lt;p>由于早期 rsync 不使用 SSH 协议，需要用-e参数指定协议，后来才改的。所以，下面-e ssh可以省略。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av -e ssh source/ user@remote_host:/destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>但是，如果 ssh 命令有附加的参数，则必须使用-e参数指定所要执行的 SSH 命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av -e &amp;#39;ssh -p 2234&amp;#39; source/ user@remote_host:/destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令中，-e参数指定 SSH 使用2234端口。&lt;/p>
&lt;h2 id="52-rsync-协议">5.2 rsync 协议&lt;/h2>
&lt;p>除了使用 SSH，如果另一台服务器安装并运行了 rsync 守护程序，则也可以用rsync://协议（默认端口873）进行传输。具体写法是服务器与目标目录之间使用双冒号分隔::。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av source/ 192.168.122.32::module/destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意，上面地址中的module并不是实际路径名，而是 rsync 守护程序指定的一个资源名，由管理员分配。&lt;/p>
&lt;p>如果想知道 rsync 守护程序分配的所有 module 列表，可以执行下面命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync rsync://192.168.122.32
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>rsync 协议除了使用双冒号，也可以直接用rsync://协议指定地址。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -av source/ rsync://192.168.122.32/module/destination
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="六增量备份">六、增量备份&lt;/h1>
&lt;p>rsync 的最大特点就是它可以完成增量备份，也就是默认只复制有变动的文件。&lt;/p>
&lt;p>除了源目录与目标目录直接比较，rsync 还支持使用基准目录，即将源目录与基准目录之间变动的部分，同步到目标目录。&lt;/p>
&lt;p>具体做法是，第一次同步是全量备份，所有文件在基准目录里面同步一份。以后每一次同步都是增量备份，只同步源目录与基准目录之间有变动的部分，将这部分保存在一个新的目标目录。这个新的目标目录之中，也是包含所有文件，但实际上，只有那些变动过的文件是存在于该目录，其他没有变动的文件都是指向基准目录文件的硬链接。&lt;/p>
&lt;p>&amp;ndash;link-dest参数用来指定同步时的基准目录。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ rsync -a --delete --link-dest /compare/path /source/path /target/path
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面命令中，&amp;ndash;link-dest参数指定基准目录/compare/path，然后源目录/source/path跟基准目录进行比较，找出变动的文件，将它们拷贝到目标目录/target/path。那些没变动的文件则会生成硬链接。这个命令的第一次备份时是全量备份，后面就都是增量备份了。&lt;/p>
&lt;p>下面是一个脚本示例，备份用户的主目录。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A script to perform incremental backups using rsync&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -o errexit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -o nounset
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -o pipefail
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">SOURCE_DIR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">HOME&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">BACKUP_DIR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/mnt/data/backups&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">DATETIME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>date &lt;span class="s1">&amp;#39;+%Y-%m-%d_%H:%M:%S&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">BACKUP_PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BACKUP_DIR&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">DATETIME&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">LATEST_LINK&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BACKUP_DIR&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/latest&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BACKUP_DIR&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rsync -av --delete &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">SOURCE_DIR&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --link-dest &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">LATEST_LINK&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --exclude&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;.cache&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BACKUP_PATH&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">LATEST_LINK&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BACKUP_PATH&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">LATEST_LINK&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面脚本中，每一次同步都会生成一个新目录${BACKUP_DIR}/${DATETIME}，并将软链接${BACKUP_DIR}/latest指向这个目录。下一次备份时，就将${BACKUP_DIR}/latest作为基准目录，生成新的备份目录。最后，再将软链接${BACKUP_DIR}/latest指向新的备份目录。&lt;/p>
&lt;h1 id="七配置项">七、配置项&lt;/h1>
&lt;p>-a、&amp;ndash;archive参数表示存档模式，保存所有的元数据，比如修改时间（modification time）、权限、所有者等，并且软链接也会同步过去。&lt;/p>
&lt;p>&amp;ndash;append参数指定文件接着上次中断的地方，继续传输。&lt;/p>
&lt;p>&amp;ndash;append-verify参数跟&amp;ndash;append参数类似，但会对传输完成后的文件进行一次校验。如果校验失败，将重新发送整个文件。&lt;/p>
&lt;p>-b、&amp;ndash;backup参数指定在删除或更新目标目录已经存在的文件时，将该文件更名后进行备份，默认行为是删除。更名规则是添加由&amp;ndash;suffix参数指定的文件后缀名，默认是~。&lt;/p>
&lt;p>&amp;ndash;backup-dir参数指定文件备份时存放的目录，比如&amp;ndash;backup-dir=/path/to/backups。&lt;/p>
&lt;p>&amp;ndash;bwlimit参数指定带宽限制，默认单位是 KB/s，比如&amp;ndash;bwlimit=100。&lt;/p>
&lt;p>-c、&amp;ndash;checksum参数改变rsync的校验方式。默认情况下，rsync 只检查文件的大小和最后修改日期是否发生变化，如果发生变化，就重新传输；使用这个参数以后，则通过判断文件内容的校验和，决定是否重新传输。&lt;/p>
&lt;p>&amp;ndash;delete参数删除只存在于目标目录、不存在于源目标的文件，即保证目标目录是源目标的镜像。&lt;/p>
&lt;p>-e参数指定使用 SSH 协议传输数据。&lt;/p>
&lt;p>&amp;ndash;exclude参数指定排除不进行同步的文件，比如&amp;ndash;exclude=&amp;quot;*.iso&amp;quot;。&lt;/p>
&lt;p>&amp;ndash;exclude-from参数指定一个本地文件，里面是需要排除的文件模式，每个模式一行。&lt;/p>
&lt;p>&amp;ndash;existing、&amp;ndash;ignore-non-existing参数表示不同步目标目录中不存在的文件和目录。&lt;/p>
&lt;p>-h参数表示以人类可读的格式输出。&lt;/p>
&lt;p>-h、&amp;ndash;help参数返回帮助信息。&lt;/p>
&lt;p>-i参数表示输出源目录与目标目录之间文件差异的详细情况。&lt;/p>
&lt;p>&amp;ndash;ignore-existing参数表示只要该文件在目标目录中已经存在，就跳过去，不再同步这些文件。&lt;/p>
&lt;p>&amp;ndash;include参数指定同步时要包括的文件，一般与&amp;ndash;exclude结合使用。&lt;/p>
&lt;p>&amp;ndash;link-dest参数指定增量备份的基准目录。&lt;/p>
&lt;p>-m参数指定不同步空目录。&lt;/p>
&lt;p>&amp;ndash;max-size参数设置传输的最大文件的大小限制，比如不超过200KB（&amp;ndash;max-size=&amp;lsquo;200k&amp;rsquo;）。&lt;/p>
&lt;p>&amp;ndash;min-size参数设置传输的最小文件的大小限制，比如不小于10KB（&amp;ndash;min-size=10k）。&lt;/p>
&lt;p>-n参数或&amp;ndash;dry-run参数模拟将要执行的操作，而并不真的执行。配合-v参数使用，可以看到哪些内容会被同步过去。&lt;/p>
&lt;p>-P参数是&amp;ndash;progress和&amp;ndash;partial这两个参数的结合。&lt;/p>
&lt;p>&amp;ndash;partial参数允许恢复中断的传输。不使用该参数时，rsync会删除传输到一半被打断的文件；使用该参数后，传输到一半的文件也会同步到目标目录，下次同步时再恢复中断的传输。一般需要与&amp;ndash;append或&amp;ndash;append-verify配合使用。&lt;/p>
&lt;p>&amp;ndash;partial-dir参数指定将传输到一半的文件保存到一个临时目录，比如&amp;ndash;partial-dir=.rsync-partial。一般需要与&amp;ndash;append或&amp;ndash;append-verify配合使用。&lt;/p>
&lt;p>&amp;ndash;progress参数表示显示进展。&lt;/p>
&lt;p>-r参数表示递归，即包含子目录。&lt;/p>
&lt;p>&amp;ndash;remove-source-files参数表示传输成功后，删除发送方的文件。&lt;/p>
&lt;p>&amp;ndash;size-only参数表示只同步大小有变化的文件，不考虑文件修改时间的差异。&lt;/p>
&lt;p>&amp;ndash;suffix参数指定文件名备份时，对文件名添加的后缀，默认是~。&lt;/p>
&lt;p>-u、&amp;ndash;update参数表示同步时跳过目标目录中修改时间更新的文件，即不同步这些有更新的时间戳的文件。&lt;/p>
&lt;p>-v参数表示输出细节。-vv表示输出更详细的信息，-vvv表示输出最详细的信息。&lt;/p>
&lt;p>&amp;ndash;version参数返回 rsync 的版本。&lt;/p>
&lt;p>-z参数指定同步时压缩数据。&lt;/p></description></item><item><title>替换文件夹中所有文件内容的特定字符串</title><link>https://changxiangyu.cn/p/%E6%9B%BF%E6%8D%A2%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/</link><pubDate>Wed, 17 Aug 2022 17:38:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E6%9B%BF%E6%8D%A2%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">find . -type f -name &amp;#34;*.yaml&amp;#34; | xargs sed -i &amp;#34;s#host_path#$host_path#g&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Linux 下使用 awk 操作文件内容</title><link>https://changxiangyu.cn/p/linux-%E4%B8%8B%E4%BD%BF%E7%94%A8-awk-%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9/</link><pubDate>Wed, 17 Aug 2022 10:03:18 +0800</pubDate><guid>https://changxiangyu.cn/p/linux-%E4%B8%8B%E4%BD%BF%E7%94%A8-awk-%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9/</guid><description>&lt;p>参考: &lt;a class="link" href="https://blog.csdn.net/laobai1015/article/details/98628860" target="_blank" rel="noopener"
>https://blog.csdn.net/laobai1015/article/details/98628860&lt;/a>&lt;/p>
&lt;h2 id="需求">需求&lt;/h2>
&lt;ol>
&lt;li>把 /etc/rancher/k3s/k3s.yaml 文件的内容，每行前面加 4 个空格，追加到 ai-service-platform/yamls/config/kube-config.yaml 文件中；&lt;/li>
&lt;li>把 ai-service-platform/yamls/config/kube-config.yaml 文件中的 127.0.0.1 替换成 $master_host_ip。&lt;/li>
&lt;/ol>
&lt;p>脚本：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">function fix_kube_config(){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo awk &amp;#39;{print &amp;#34; &amp;#34; $0 &amp;gt;&amp;gt; &amp;#34;ai-service-platform/yamls/config/kube-config.yaml&amp;#34;}&amp;#39; /etc/rancher/k3s/k3s.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &amp;#34;s/127.0.0.1/$master_host_ip/g&amp;#34; ai-service-platform/yamls/config/kube-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="扩展">扩展&lt;/h2>
&lt;p>在前面、后面、指定列添加相同字符&lt;/p>
&lt;ol>
&lt;li>给一个文件中的每一行开头插入字符的方法：awk &amp;lsquo;{print &amp;ldquo;需要添加的字符&amp;rdquo; $0}&amp;rsquo; fileName&lt;/li>
&lt;li>给一个文件中的每一行结尾插入字符的方法：awk &amp;lsquo;{print $0 &amp;ldquo;需要添加的字符&amp;rdquo;}&amp;rsquo; fileName&lt;/li>
&lt;li>给一个文件中的每一行的指定列插入字符的方法：awk &amp;lsquo;$0=$0 X&amp;quot;&amp;rsquo; fileName&lt;/li>
&lt;/ol>
&lt;p>删除某一个列&lt;/p>
&lt;ol>
&lt;li>删除文件中的第一列：awk &amp;lsquo;{$1=&amp;quot;&amp;quot;;print $0}&amp;rsquo; fileName 或者另一种方法 sed -e &amp;rsquo;s/[^ ]* //&amp;rsquo; text&lt;/li>
&lt;li>删除指定列：awk &amp;lsquo;{$Num=&amp;quot;&amp;quot;;print $0}&amp;rsquo; fileName&lt;/li>
&lt;/ol>
&lt;p>把Num换成要删除的列数即可&lt;/p>
&lt;h2 id="练习">练习&lt;/h2>
&lt;p>给文件中的每一行开头添加drop tables&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">awk &amp;#39;{print &amp;#34;drop table &amp;#34;$0}&amp;#39; aa.txt &amp;gt; bb.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>给文件中的每一行结尾添加分号&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">awk &amp;#39;{print $0&amp;#34;;&amp;#34;}&amp;#39; bb.txt &amp;gt; cc.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Python 实现 Linux 的 'df -h' 命令</title><link>https://changxiangyu.cn/p/python-%E5%AE%9E%E7%8E%B0-linux-%E7%9A%84-df-h-%E5%91%BD%E4%BB%A4/</link><pubDate>Mon, 15 Aug 2022 17:03:18 +0800</pubDate><guid>https://changxiangyu.cn/p/python-%E5%AE%9E%E7%8E%B0-linux-%E7%9A%84-df-h-%E5%91%BD%E4%BB%A4/</guid><description>&lt;p>参考: &lt;a class="link" href="https://developer.aliyun.com/article/53579" target="_blank" rel="noopener"
>https://developer.aliyun.com/article/53579&lt;/a>&lt;/p>
&lt;p>mycode&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import os
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import math
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if __name__ == &amp;#39;__main__&amp;#39;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vfs = os.statvfs(&amp;#34;/home/manager&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> g = 1024 * 1024 * 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 总容量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> k_blocks = vfs.f_bsize * vfs.f_blocks / g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Used,使用量，总容量减去空闲容量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> used = vfs.f_bsize * (vfs.f_blocks - vfs.f_bfree) / g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Available，有效容量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> available = vfs.f_bsize * vfs.f_bavail / g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # use%,使用量，%,round(浮点数，精确到小数点后的位数）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> use = round(used / (used + available) * 100, 2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> print({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;容量&amp;#34;: k_blocks,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;已用&amp;#34;: used,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;可用&amp;#34;: available,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;已用%&amp;#34;: use,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> print({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;容量&amp;#34;: f&amp;#39;{math.ceil(k_blocks)}G&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;已用&amp;#34;: f&amp;#39;{math.ceil(used)}G&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;可用&amp;#34;: f&amp;#39;{math.ceil(available)}G&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;已用%&amp;#34;: f&amp;#39;{math.ceil(use)}%&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行测试&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ df -h /home/manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">文件系统 容量 已用 可用 已用% 挂载点
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/nvme0n1p2 457G 325G 110G 75% /
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python test.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{&amp;#39;容量&amp;#39;: 456.8854446411133, &amp;#39;已用&amp;#39;: 324.40053939819336, &amp;#39;可用&amp;#39;: 109.20629501342773, &amp;#39;已用%&amp;#39;: 74.81}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{&amp;#39;容量&amp;#39;: &amp;#39;457G&amp;#39;, &amp;#39;已用&amp;#39;: &amp;#39;325G&amp;#39;, &amp;#39;可用&amp;#39;: &amp;#39;110G&amp;#39;, &amp;#39;已用%&amp;#39;: &amp;#39;75%&amp;#39;}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Ubuntu 设置合上笔记本盖子不休眠的方法</title><link>https://changxiangyu.cn/p/ubuntu-%E8%AE%BE%E7%BD%AE%E5%90%88%E4%B8%8A%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%9B%96%E5%AD%90%E4%B8%8D%E4%BC%91%E7%9C%A0%E7%9A%84%E6%96%B9%E6%B3%95/</link><pubDate>Sat, 13 Aug 2022 15:33:18 +0800</pubDate><guid>https://changxiangyu.cn/p/ubuntu-%E8%AE%BE%E7%BD%AE%E5%90%88%E4%B8%8A%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%9B%96%E5%AD%90%E4%B8%8D%E4%BC%91%E7%9C%A0%E7%9A%84%E6%96%B9%E6%B3%95/</guid><description>&lt;p>编辑文件：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo gedit /etc/systemd/logind.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#HandlePowerKey按下电源键后的行为，默认power off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#HandleSleepKey 按下挂起键后的行为，默认suspend
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#HandleHibernateKey按下休眠键后的行为，默认hibernate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#HandleLidSwitch合上笔记本盖后的行为，一般为默认suspend（改为ignore；即合盖不休眠）在原文件中，还要去掉前面的#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">然后将其中的：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#HandleLidSwitch=suspend
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">复制一行到下面，去掉“#”号：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HandleLidSwitch=ignore
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后重启服务&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">service systemd-logind restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>python 清理包</title><link>https://changxiangyu.cn/p/python-%E6%B8%85%E7%90%86%E5%8C%85/</link><pubDate>Mon, 08 Aug 2022 18:13:18 +0800</pubDate><guid>https://changxiangyu.cn/p/python-%E6%B8%85%E7%90%86%E5%8C%85/</guid><description>&lt;p>pip freeze &amp;gt; test.txt&lt;/p>
&lt;p>pip uninstall -r test.txt -y&lt;/p>
&lt;p>pip install -r requirements.txt&lt;/p></description></item><item><title>电脑开不了机</title><link>https://changxiangyu.cn/p/%E7%94%B5%E8%84%91%E5%BC%80%E4%B8%8D%E4%BA%86%E6%9C%BA/</link><pubDate>Mon, 08 Aug 2022 18:13:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E7%94%B5%E8%84%91%E5%BC%80%E4%B8%8D%E4%BA%86%E6%9C%BA/</guid><description>&lt;p>准备检查：内存条，硬盘，主板电池&lt;/p></description></item><item><title>婚纱照 15x15 相册精选</title><link>https://changxiangyu.cn/p/%E5%A9%9A%E7%BA%B1%E7%85%A7-15x15-%E7%9B%B8%E5%86%8C%E7%B2%BE%E9%80%89/</link><pubDate>Sun, 07 Aug 2022 15:47:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%A9%9A%E7%BA%B1%E7%85%A7-15x15-%E7%9B%B8%E5%86%8C%E7%B2%BE%E9%80%89/</guid><description>&lt;img src="https://changxiangyu.cn/images/small-15x15-album/fm-15.jpg" alt="Featured image of post 婚纱照 15x15 相册精选" />&lt;!-- 建议在 config.toml 中开启 canonifyURLs = true 或使用绝对路径 -->
&lt;blockquote>
&lt;p>记录我们最珍贵的时刻，每一张都是爱的见证。&lt;/p>
&lt;/blockquote>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/1.jpg" alt="婚纱照 慕爱01" loading="lazy" width="100%">
&lt;!-- 分割线样式：宽度 200px，上下间距 30px，灰色 -->
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/2.jpg" alt="婚纱照 慕爱02" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/3.jpg" alt="婚纱照 慕爱03" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/4.jpg" alt="婚纱照 慕爱04" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/5.jpg" alt="婚纱照 慕爱05" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/6.jpg" alt="婚纱照 慕爱06" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/7.jpg" alt="婚纱照 慕爱07" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/8.jpg" alt="婚纱照 慕爱08" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/9.jpg" alt="婚纱照 慕爱09" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/10.jpg" alt="婚纱照 慕爱10" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/11.jpg" alt="婚纱照 慕爱11" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/12.jpg" alt="婚纱照 慕爱12" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/13.jpg" alt="婚纱照 慕爱13" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-15x15-album/14.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;/div></description></item><item><title>婚纱照 12x12 相册</title><link>https://changxiangyu.cn/p/%E5%A9%9A%E7%BA%B1%E7%85%A7-12x12-%E7%9B%B8%E5%86%8C/</link><pubDate>Sun, 07 Aug 2022 15:33:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%A9%9A%E7%BA%B1%E7%85%A7-12x12-%E7%9B%B8%E5%86%8C/</guid><description>&lt;img src="https://changxiangyu.cn/images/small-12x12-album/fm-15.jpg" alt="Featured image of post 婚纱照 12x12 相册" />&lt;!-- 建议在 config.toml 中开启 canonifyURLs = true 或使用绝对路径 -->
&lt;blockquote>
&lt;p>记录我们最珍贵的时刻，每一张都是爱的见证。&lt;/p>
&lt;/blockquote>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/1.jpg" alt="婚纱照 慕爱01" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/2.jpg" alt="婚纱照 慕爱02" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/3.jpg" alt="婚纱照 慕爱03" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/4.jpg" alt="婚纱照 慕爱04" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/5.jpg" alt="婚纱照 慕爱05" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/6.jpg" alt="婚纱照 慕爱06" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/7.jpg" alt="婚纱照 慕爱07" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/8.jpg" alt="婚纱照 慕爱08" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/9.jpg" alt="婚纱照 慕爱09" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/10.jpg" alt="婚纱照 慕爱10" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/11.jpg" alt="婚纱照 慕爱11" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/12.jpg" alt="婚纱照 慕爱12" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/13.jpg" alt="婚纱照 慕爱13" loading="lazy" width="100%">
&lt;hr style="width: 200px; margin: 30px auto; border: 0; border-top: 1px solid #ddd;">
&lt;img src="https://changxiangyu.cn/images/small-12x12-album/14.jpg" alt="婚纱照 慕爱14" loading="lazy" width="100%">
&lt;/div></description></item><item><title>婚纱照摆件</title><link>https://changxiangyu.cn/p/%E5%A9%9A%E7%BA%B1%E7%85%A7%E6%91%86%E4%BB%B6/</link><pubDate>Sun, 07 Aug 2022 15:33:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%A9%9A%E7%BA%B1%E7%85%A7%E6%91%86%E4%BB%B6/</guid><description>&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_259.jpg" alt="Featured image of post 婚纱照摆件" />&lt;h1 id="初见三摆台">初见三摆台&lt;/h1>
&lt;!-- 使用Flex布局实现三图横排，justify-content: space-between 实现两端对齐 -->
&lt;div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_057.jpg" alt="初见三摆台" style="width: 32%; border-radius: 5px;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_050.jpg" alt="初见三摆台" style="width: 32%; border-radius: 5px;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_055.jpg" alt="初见三摆台" style="width: 32%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="至美三件套艺术组合">至美三件套艺术组合&lt;/h1>
&lt;div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_081.jpg" alt="至美三件套艺术组合" style="width: 32%; border-radius: 5px;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_113.jpg" alt="至美三件套艺术组合" style="width: 32%; border-radius: 5px;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_127.jpg" alt="至美三件套艺术组合" style="width: 32%; border-radius: 5px;">
&lt;/div>
&lt;!-- 以下单张图片建议居中显示，保持整洁 -->
&lt;h1 id="10x8英寸时尚绢丝相架一幅">10X8英寸时尚绢丝相架一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_073.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="10x8英寸精美思慕相架一幅">10X8英寸精美思慕相架一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_181.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="30x20英寸时尚绢丝挂画一幅">30X20英寸时尚绢丝挂画一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_192.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="48x24至美相框一幅">48X24至美相框一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_030.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="6x8英寸时尚蓝色恋人相架一幅">6X8英寸时尚蓝色恋人相架一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_115.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="8x12英寸精美米娜相架一幅">8X12英寸精美米娜相架一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_812.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div>
&lt;h1 id="8x8英寸安琪相架一幅">8X8英寸安琪相架一幅&lt;/h1>
&lt;div style="text-align: center;">
&lt;img src="https://changxiangyu.cn/images/small-photos-decorations/y_226.jpg" alt="慕爱" style="max-width: 80%; border-radius: 5px;">
&lt;/div></description></item><item><title>Ubuntu下在命令行批量生成缩略图</title><link>https://changxiangyu.cn/p/ubuntu%E4%B8%8B%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90%E7%BC%A9%E7%95%A5%E5%9B%BE/</link><pubDate>Sun, 07 Aug 2022 02:33:18 +0800</pubDate><guid>https://changxiangyu.cn/p/ubuntu%E4%B8%8B%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90%E7%BC%A9%E7%95%A5%E5%9B%BE/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 准备工作：安装 imagemagick
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install imagemagick
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#大图所在的目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /path/to/big/images
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#创建小图对应的目录结构
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">find . -type d -print -exec mkdir &amp;#39;../small/{}&amp;#39; -p \;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#批量转换! 等比例缩小到320x320之内 320x: 只设置宽度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">find . -type f -name &amp;#39;*.jpg&amp;#39; -print -exec \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">convert &amp;#39;{}&amp;#39; -resize 320x320 &amp;#39;../small/{}&amp;#39; \;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Quick Start</title><link>https://changxiangyu.cn/p/quick-start/</link><pubDate>Mon, 01 Aug 2022 19:52:18 +0800</pubDate><guid>https://changxiangyu.cn/p/quick-start/</guid><description>&lt;h1 id="step-1-install-hugo">Step 1: Install Hugo&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Ubuntu 系统
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install hugo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>验证您的新安装:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hugo version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Output
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo v0.101.0-9f74196ce611cdf6d355bfb99fd8eba5c68ef7f8+extended linux/amd64 BuildDate=2022-06-28T10:02:18Z VendorInfo=snap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="step-2-create-a-new-site">Step 2: Create a New Site&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hugo new site quickstart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个命令会创建一个名为 quickstart 的目录，这就是博客的根目录。目录结构如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">├── archetypes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── default.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── config.toml # 博客站点的配置文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── content # 博客文章所在目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── layouts # 网站布局
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── static # 一些静态内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── themes # 博客主题
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="step-3-add-a-theme">Step 3: Add a Theme&lt;/h1>
&lt;p>首先，从 GitHub 下载主题并将其添加到站点的主题目录中：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-v" data-lang="v">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">cd&lt;/span> &lt;span class="nv">quickstart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">git&lt;/span> &lt;span class="nv">init&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">git&lt;/span> &lt;span class="nv">submodule&lt;/span> &lt;span class="nv">add&lt;/span> &lt;span class="nv">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后，将主题添加到站点配置中：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo theme = \&amp;#34;ananke\&amp;#34; &amp;gt;&amp;gt; config.toml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="step-4-add-some-content">Step 4: Add Some Content&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hugo new posts/my-first-post.md
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果需要，可以编辑新创建的内容文件，它将以如下内容开头：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">title: &amp;#34;My First Post&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">date: 2019-03-26T08:47:11+01:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">draft: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="step-5-start-the-hugo-server">Step 5: Start the Hugo server&lt;/h1>
&lt;p>现在，启动启用草稿的 Hugo 服务器：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hugo server -D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 可以在其它机器访问
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo server --bind=&amp;#34;0.0.0.0&amp;#34; -D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 可以在其它机器访问, -p 修改端口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo server --bind=&amp;#34;0.0.0.0&amp;#34; -p 80 -D
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 http://114.132.247.115:1313/ 导航到您的新站点。&lt;/p>
&lt;h1 id="第-6-步自定义主题">第 6 步：自定义主题&lt;/h1>
&lt;p>在文本编辑器中打开 config.toml：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">baseURL = &amp;#34;https://example.org/&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">languageCode = &amp;#34;en-us&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">title = &amp;#34;My New Hugo Site&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">theme = &amp;#34;ananke&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="第-7-步构建静态页面">第 7 步：构建静态页面&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hugo -D
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>将博客部署在GitHub上</title><link>https://changxiangyu.cn/p/%E5%B0%86%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2%E5%9C%A8github%E4%B8%8A/</link><pubDate>Mon, 01 Aug 2022 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/p/%E5%B0%86%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2%E5%9C%A8github%E4%B8%8A/</guid><description>&lt;h1 id="准备要部署的内容">准备要部署的内容&lt;/h1>
&lt;p>在github 上创建一个仓库: chenjinxin.github.io&lt;/p>
&lt;p>要向仓库中存放的内容，使用 hugo 命令生成的。在当前目录下，运行 hugo 命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">➜ quickstart git:(master) ✗ pwd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/cjx/quickstart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">➜ quickstart git:(master) hugo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start building sites …
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo v0.101.0-9f74196ce611cdf6d355bfb99fd8eba5c68ef7f8+extended linux/amd64 BuildDate=2022-06-28T10:02:18Z VendorInfo=snap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | EN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------+-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Pages | 28
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Paginator pages | 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Non-page files | 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Static files | 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Processed images | 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Aliases | 12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sitemaps | 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cleaned | 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total in 33 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>执行成功后，会生成一个public 目录，这个目录中的内容，就是我们博客系统的所有内容，我们需要将这些内容存放在Git 仓库中。&lt;/p>
&lt;h1 id="部署到-github">部署到 GitHub&lt;/h1>
&lt;p>按照如下步骤将博客内容上传到Git 仓库，在public 目录下，依次执行下面的命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 初始化仓库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 将所有内容添加到git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 提交到git 本地
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git commit -m &amp;#34;我的博客第一次提交&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 关联到远程git，注意这里需要写你自己的git 地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git remote add origin git@github.com:chenjinxin1124/chenjinxin.github.io.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 推送到远程git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git push --set-upstream origin master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>推送到GitHub</title><link>https://changxiangyu.cn/p/%E6%8E%A8%E9%80%81%E5%88%B0github/</link><pubDate>Mon, 01 Aug 2022 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/p/%E6%8E%A8%E9%80%81%E5%88%B0github/</guid><description>&lt;h1 id="初始化本地仓库">初始化本地仓库&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="添加代码">添加代码&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git add .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="提交代码">提交代码&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git commit -m&amp;#39;first commit&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="添加远程仓库地址">添加远程仓库地址&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git remote add origin git@github.com:jinyumantangcjx/hugo.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="把本地仓库的变化连接到远程仓库主分支">把本地仓库的变化连接到远程仓库主分支&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git push --set-upstream origin master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>修改博客主题</title><link>https://changxiangyu.cn/p/%E4%BF%AE%E6%94%B9%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98/</link><pubDate>Mon, 01 Aug 2022 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/p/%E4%BF%AE%E6%94%B9%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98/</guid><description>&lt;h3 id="下载博客主题">下载博客主题&lt;/h3>
&lt;p>创建好博客项目后，接下来是下载&lt;a class="link" href="https://link.zhihu.com/?target=https%3A//themes.gohugo.io/" target="_blank" rel="noopener"
>hugo博客的主题&lt;/a>，这里有很多主题，我们可以任意挑选，比如我们选择了&lt;a class="link" href="https://link.zhihu.com/?target=https%3A//themes.gohugo.io/hugo-theme-bootstrap4-blog/" target="_blank" rel="noopener"
>bootstrap4-blog 主题&lt;/a>。&lt;/p>
&lt;p>然后在 Blog 目录下使用git 命令来下载主题：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/alanorth/hugo-theme-bootstrap4-blog.git themes/hugo-theme-bootstrap4-blog
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下载下来的主题会放在themes 目录中：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">└── hugo-theme-bootstrap4-blog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── CHANGELOG.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── LICENSE.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── archetypes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── assets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── exampleSite # 本主题示例内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | ├── content # 示例博客文章
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │ |-- static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │ |-- config.toml # 本主题配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── i18n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── images
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── layouts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── package-lock.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── package.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── screenshot.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── source
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── theme.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── webpack.config.js
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="使用主题">使用主题&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vim config.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">theme = &amp;#34;hugo-theme-bootstrap4-blog&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Archives</title><link>https://changxiangyu.cn/archives/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/archives/</guid><description/></item><item><title>Links</title><link>https://changxiangyu.cn/links/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/links/</guid><description/></item><item><title>Search</title><link>https://changxiangyu.cn/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/search/</guid><description/></item><item><title>关于</title><link>https://changxiangyu.cn/%E5%85%B3%E4%BA%8E/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://changxiangyu.cn/%E5%85%B3%E4%BA%8E/</guid><description>&lt;div class="resume-wrapper">
&lt;h1 id="常香玉--前端开发工程师--6-年">常香玉 | 前端开发工程师 | 6 年+&lt;/h1>
&lt;h2 id="基本信息">基本信息&lt;/h2>
&lt;ul>
&lt;li>手机：17111124608&lt;/li>
&lt;li>邮箱：changxiangyu@changxiangyu.cn&lt;/li>
&lt;li>GitHub 主页：https://github.com/changxiangyu666&lt;/li>
&lt;li>作品组织：https://github.com/jinyumantangcjx，https://github.com/xinhuizhineng&lt;/li>
&lt;li>毕业院校及专业：黑河学院 | 20届 | 计算机科学与技术专业（本科）&lt;/li>
&lt;li>我的博客: &lt;a class="link" href="https://changxiangyu.cn" target="_blank" rel="noopener"
>https://changxiangyu.cn&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="核心技能">核心技能&lt;/h2>
&lt;ul>
&lt;li>编程语言： JavaScript (ES6+), TypeScript, Dart, Python, Java, HTML5, CSS3&lt;/li>
&lt;li>前端框架： Vue.js (Avue), Angular, qiankun (微前端), Ionic, amis&lt;/li>
&lt;li>移动/小程序： uni-app, Flutter, 微信小程序/公众号, 企业微信/支付宝对接&lt;/li>
&lt;li>后端技术： Node.js, Flask, MVC 架构&lt;/li>
&lt;li>数据库： MySQL, Redis, MongoDB, SQL&lt;/li>
&lt;li>可视化/GIS： ECharts, OpenLayers, 高德地图 API, Photoshop (切图/处理)&lt;/li>
&lt;li>工具/运维： Git/GitHub/GitLab, Nginx, IIS, npm/yarn&lt;/li>
&lt;li>相关知识: HTTP协议、浏览器工作原理。&lt;/li>
&lt;li>能够独立从0到1搭建前端项目。&lt;/li>
&lt;/ul>
&lt;h2 id="工作经历">工作经历&lt;/h2>
&lt;h3 id="达实集团--达实物联网--研发部-前端工程师">达实集团 / 达实物联网 | 研发部-前端工程师&lt;/h3>
&lt;p>&lt;em>2021.03 - 至今&lt;/em>&lt;/p>
&lt;h4 id="改单类项目">&lt;strong>改单类项目&lt;/strong>&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>技术栈&lt;/strong>：HTML5、CSS3、JavaScript、gulp 构建工具、uniapp（跨平台框架）、Vue、Angular、Axios（接口请求）、ES6、Promise 异步处理、WebSocket&lt;/li>
&lt;li>&lt;strong>功能模块&lt;/strong>：
&lt;ul>
&lt;li>支付系统：微信 H5、小程序、支付宝、银行卡支付&lt;/li>
&lt;li>考勤系统：基于高德地图定位签到&lt;/li>
&lt;li>访客与梯控：访客预约、梯控权限管理&lt;/li>
&lt;li>&lt;strong>人脸识别门禁&lt;/strong>：支持用户通过移动端上传/拍摄人脸照片 → 后端提取人脸特征并存储 → 门禁设备调用人脸识别算法实时比对 → 验证通过后自动开门&lt;/li>
&lt;li>数据大屏：自适应布局，实时展示数据&lt;/li>
&lt;li>C3v8 访客机：硬件设备数据交互与界面展示&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>性能优化&lt;/strong>：
&lt;ul>
&lt;li>接口统一封装，支持异常处理与重试&lt;/li>
&lt;li>上传人脸照片时进行图片压缩与格式校验，控制文件大小 ≤ 500KB，减少网络延迟&lt;/li>
&lt;li>识别算法调用优化，准确率提升至 98%+，平均响应时间 &amp;lt; 1.5 秒&lt;/li>
&lt;li>资源文件按需加载，减少首屏时间&lt;/li>
&lt;li>前端缓存策略减少重复请求&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>部署与适配&lt;/strong>：
&lt;ul>
&lt;li>适配 iOS / Android ，微信小程序，微信公众号，企业微信，h5 嵌入 app 应用等多终端&lt;/li>
&lt;li>配置微信/企业微信平台接口权限&lt;/li>
&lt;li>部署至 Nginx 与 IIS，确保多终端运行稳定&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>成果&lt;/strong>：
&lt;ul>
&lt;li>负责整个改单的建立、开发、h5的改单使用nginx部署项目，小程序的需审核发布，企业微信的项目使用测试企业微信部署测试，以及后期的维护&lt;/li>
&lt;li>独立完成页面开发与数据接口对接&lt;/li>
&lt;li>项目跨终端正常运行，支付与考勤模块稳定性提升&lt;/li>
&lt;li>系统部署效率提升&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="pc-端内部管理平台">&lt;strong>PC 端内部管理平台&lt;/strong>&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>技术栈&lt;/strong>：Vue、Angular、qiankun 微前端框架、Node.js、Element UI&lt;/li>
&lt;li>&lt;strong>功能模块&lt;/strong>：
&lt;ul>
&lt;li>DAS-MP 内部管理平台（高级管理：标签定义、分类定义、词汇定义、基本产品、产品包分类管理、序列管理、短信渠道、默认关闭管理、数据导出、前端资源传输到环境，一级菜单：模块功能点、菜单管理、URL定义、接口返回定义、前端资源、设备类型定义、数据选项管理、参数定义、数据实体、数据模版、消息定义，租户及授权：销售产品包管理、授权基本项定义、租户管理、C3-Plus授权、融合C3-Plus和AIoT授权），登录、修改密码、用户管理、角色管理、环境配置管理、个人设置）&lt;/li>
&lt;li>C3-Plus OM 运管平台（模块功能点、菜单管理、URL功能点、APICodeMsg、服务管理、产品数据更新、使用许可证、功能关闭与黑白名单管理，登录），&lt;/li>
&lt;li>C3-Plus SaaS 系统维护（租户管理、租户数据库升级、用户管理、设备列表、解析器配置，登录）&lt;/li>
&lt;li>C3-Plus 运管平台（消费、考勤、门禁监控、设备服务（设备列表、解析器配置、设备权限下载查询、FTP下载任务查询、设备权限差异汇总、设备权限差异详情、派梯楼层查询、设备运行日志、服务集群、设备接入，系统配置）、主应用等子系统）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>性能优化&lt;/strong>：
&lt;ul>
&lt;li>微前端架构优化，支持多系统无缝集成&lt;/li>
&lt;li>图表数据懒加载，减少渲染压力&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>部署与适配&lt;/strong>：
&lt;ul>
&lt;li>跨浏览器兼容（Chrome、IE11）&lt;/li>
&lt;li>模块按需加载，降低首屏压力&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>成果&lt;/strong>：
&lt;ul>
&lt;li>构建DAS-MP 内部管理平台，C3-Plus OM 运管平台和C3-Plus SaaS 系统维护，负责主要开发和维护&lt;/li>
&lt;li>C3-Plus 运管平台参与消费、考勤、门禁监控、设备服务、主应用等子系统开发&lt;/li>
&lt;li>提升多系统协作效率&lt;/li>
&lt;li>前端性能提升&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="移动端-c3-plus-应用">&lt;strong>移动端 C3-Plus 应用&lt;/strong>&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>技术栈&lt;/strong>：uniapp、uView UI 框架、Vuex、Axios、ES6、Promise&lt;/li>
&lt;li>&lt;strong>功能模块&lt;/strong>：
&lt;ul>
&lt;li>登录/注册（微信授权登录、Token 鉴权）&lt;/li>
&lt;li>主页（信息总览、快捷入口）&lt;/li>
&lt;li>我的（个人信息管理、消息通知）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>性能优化&lt;/strong>：
&lt;ul>
&lt;li>使用 Vuex 管理全局状态，减少数据冗余&lt;/li>
&lt;li>图片资源按需加载，首页加载速度提升&lt;/li>
&lt;li>接口请求统一封装，支持错误处理与重试机制&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>部署与适配&lt;/strong>：
&lt;ul>
&lt;li>适配 iOS / Android 与微信小程序&lt;/li>
&lt;li>按需引入组件，减少包体积&lt;/li>
&lt;li>Flex 布局与媒体查询实现多屏幕适配&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>成果&lt;/strong>：
&lt;ul>
&lt;li>提升移动端用户操作流畅度&lt;/li>
&lt;li>统一 UI 风格，降低维护成本&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="中联智科高新技术有限公司--研发部-前端开发">中联智科高新技术有限公司 | 研发部-前端开发&lt;/h3>
&lt;p>&lt;em>2020.03 - 2021.03&lt;/em>&lt;/p>
&lt;h4 id="智慧鱼池">&lt;strong>智慧鱼池&lt;/strong>&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>技术栈&lt;/strong>：Angular、Ionic（移动端）、Vue、Avue、Element UI、OpenLayers 地图&lt;/li>
&lt;li>&lt;strong>功能模块&lt;/strong>：实时监控鱼池环境，日志管理与多租户支持，养鱼设备管理与消息通知，ERP 系统集成&lt;/li>
&lt;li>&lt;strong>性能优化&lt;/strong>：地图数据分层加载，表格分页与虚拟滚动优化&lt;/li>
&lt;li>&lt;strong>部署与适配&lt;/strong>：移动端与 PC 端双平台适配，组件按需加载，减少资源占用&lt;/li>
&lt;li>&lt;strong>成果&lt;/strong>：建立移动端模型和PC端的构建，移动端与 PC 端功能稳定运行，数据可视化响应速度提升&lt;/li>
&lt;/ul>
&lt;h4 id="智慧畜牧">&lt;strong>智慧畜牧&lt;/strong>&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>技术栈&lt;/strong>：Angular、Ionic（移动端）、Vue、Avue、Element UI、OpenLayers 地图&lt;/li>
&lt;li>&lt;strong>功能模块&lt;/strong>：牲畜实时监控，颈圈佩戴与电子围栏管理，地图定位与轨迹回放，牛脸识别与日志管理，消息管理，入栏数数和设备管理。&lt;/li>
&lt;li>&lt;strong>性能优化&lt;/strong>：实时定位数据压缩传输，图片识别接口并发优化&lt;/li>
&lt;li>&lt;strong>部署与适配&lt;/strong>：移动端与 PC 双平台支持&lt;/li>
&lt;li>&lt;strong>成果&lt;/strong>：实现散养与圈养模式切换，数据传输稳定性提升，实现摄像头，颈圈的安装，拆卸，转换，查看。牲畜管理，牲畜跨越电子围栏实时定位牲畜位置。&lt;/li>
&lt;/ul>
&lt;h3 id="析研科技有限公司实习--开发部-前端开发工程师">析研科技有限公司（实习） | 开发部-前端开发工程师&lt;/h3>
&lt;p>&lt;em>2019.10 - 2020.01&lt;/em>&lt;/p>
&lt;h4 id="香港补习教育系统">&lt;strong>香港补习教育系统&lt;/strong>&lt;/h4>
&lt;ul>
&lt;li>技术栈：Vue、Spring Boot、Element UI、WebSocket&lt;/li>
&lt;li>项目描述：该项目属于线上补习教育类，基于多语言处理的前后端分离开发，支持Web端和手机端线上服务。有学生端和教师端。上堂以实时直播的形式实现，根据个人信息级、筛选条件和课程安排选择配对。&lt;/li>
&lt;li>功能模块：时间表管理、课程配对、我的，笔记管理与上堂等。&lt;/li>
&lt;li>性能优化：WebSocket 保持低延迟实时通信，界面组件按需加载&lt;/li>
&lt;li>部署与适配：跨浏览器兼容&lt;/li>
&lt;li>成果：完成核心交互逻辑与数据渲染，提升直播课程稳定性。对接数据接口，封装函数处理数据库中的json数据，展示到页面。根据UI 设计的项目设计稿，使用Element中的组件，编写代码实现页面展示。测试前端功能和前端与后端数据接口的实现。&lt;/li>
&lt;/ul>
&lt;h2 id="项目经验毕业设计">项目经验（毕业设计）&lt;/h2>
&lt;p>&lt;strong>图片分享网站 | 独立开发&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>类似 Instagram，支持注册登录、上传图片、评论、点赞&lt;/li>
&lt;li>七牛云图片存储与处理，腾讯云服务器，百度云数据库&lt;/li>
&lt;li>图片懒加载、MD5+Salt 密码加密、响应式图片缩放&lt;/li>
&lt;li>项目地址：https://github.com/changxiangyu666/PycharmProjects&lt;/li>
&lt;/ul>
&lt;h2 id="荣誉奖项">荣誉奖项&lt;/h2>
&lt;ul>
&lt;li>优秀学生二等奖学金&lt;/li>
&lt;li>优秀学生三等奖学金&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://changxiangyu.cn/images/credential/biyezhengshu.jpg"
loading="lazy"
alt="毕业证书"
>
&lt;img src="https://changxiangyu.cn/images/credential/xueweizhengshu.jpg"
loading="lazy"
alt="学位证书"
>&lt;/p>
&lt;/div>
&lt;style>
/* ==========================================================================
1. 全局变量定义 (方便统一调整)
========================================================================== */
:root {
/* 核心配色 */
--primary-color: #007bff; /* 主色调：蓝色 */
--text-main: #2c3e50; /* 主要文字颜色 */
--text-sub: #666666; /* 次要文字颜色 */
--bg-header: #f8f9fa; /* 标题背景色 */
/* 间距与字体 */
--spacing-base: 20px;
--font-base: 16px; /* 网页浏览字体大小 */
--line-height: 1.6;
}
/* 简历容器 - 模拟 A4 纸质感或干净的网页布局 */
.resume-wrapper {
max-width: 850px;
margin: 40px auto;
padding: 40px;
background: #fff;
color: #333;
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
line-height: var(--line-height);
}
/* ---------------- 头部信息 ---------------- */
.resume-wrapper h1 {
font-size: 2.5rem;
color: var(--text-main);
border-bottom: none;
margin-bottom: 0.5rem;
text-align: center;
font-weight: 700;
}
/* 基本信息列表转横排 */
.resume-wrapper h1 + ul {
list-style: none;
padding: 0;
text-align: center;
margin-bottom: 30px;
font-size: 0.95rem;
color: var(--text-sub);
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 15px;
}
.resume-wrapper h1 + ul li {
display: inline-block;
}
/* 链接样式 */
.resume-wrapper a {
color: var(--primary-color);
text-decoration: none;
border-bottom: 1px dashed var(--primary-color);
transition: all 0.2s;
}
.resume-wrapper a:hover {
color: #0056b3;
border-bottom-style: solid;
}
/* ---------------- 标题通用样式 ---------------- */
.resume-wrapper h2 {
font-size: 1.8rem;
color: var(--text-main);
border-bottom: 2px solid #eaeaea;
padding-bottom: 10px;
margin-top: 40px;
margin-bottom: 20px;
position: relative;
}
.resume-wrapper h2::after {
content: '';
position: absolute;
bottom: -2px;
left: 0;
width: 60px;
height: 2px;
background-color: #007bff; /* 强调色条 */
}
/* ---------------- 核心技能 ---------------- */
/* 针对技能列表的样式优化 */
.resume-wrapper h2 + ul li {
margin-bottom: 8px;
}
.resume-wrapper h2 + ul li strong {
color: var(--text-main);
font-weight: 600;
display: inline-block;
min-width: 100px; /* 让技能分类对齐 */
}
/* ---------------- 工作经历 ---------------- */
/* 建议 HTML 结构：
&lt;h3>
&lt;span>公司名称&lt;/span>
&lt;span class="job-title">职位名称&lt;/span>
&lt;span class="job-date">2020.01 - 至今&lt;/span>
&lt;/h3>
如果无法修改HTML，以下CSS依然兼容您的 h3 + p 结构
*/
.resume-wrapper h3 {
font-size: 1.6rem;
color: #333;
margin-top: 25px;
margin-bottom: 15px;
background-color: var(--bg-header);
padding: 10px 0 10px 26px;
border-left: 4px solid var(--primary-color);
border-radius: 0 4px 4px 0;
/* Flex 布局实现两端对齐 */
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
}
/* 针对原结构的补丁：如果时间写在 h3 外面的 p 标签里 */
.resume-wrapper h3 + p {
margin: -38px 15px 15px 0; /* 负边距拉上去 */
text-align: right;
pointer-events: none; /* 防止遮挡点击 */
}
/* 处理时间段 */
.resume-wrapper h3 + p em {
display: block;
margin-bottom: 15px;
font-style: normal;
color: var(--text-sub);
font-size: 1.4rem;
text-align: right;
margin-top: -40px; /* 调整位置与标题同行或紧随其后 */
padding-right: 15px;
background: var(--bg-header); /* 遮挡背景防止文字重叠 */
}
/* 项目名称 */
.resume-wrapper h4 {
font-size: 1.5rem;
color: #444;
margin-top: 20px;
margin-bottom: 10px;
font-weight: 600;
}
/* 项目详情列表 */
.resume-wrapper ul {
padding-left: 20px;
}
.resume-wrapper li {
margin-bottom: 6px;
color: #444;
}
/* ---------------- 图片展示 ---------------- */
.resume-wrapper img {
max-width: 100%;
height: auto;
margin: 10px;
border: 1px solid #ddd;
padding: 5px;
border-radius: 4px;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
/* ==========================================================================
4. 打印专用样式 (Ctrl+P 触发)
========================================================================== */
@media print {
@page {
margin: 1cm; /* 标准 A4 边距 */
size: A4 portrait;
}
/* 1. 全局净化：隐藏所有无关元素 */
body * {
visibility: hidden;
}
/* 2. 独显主角：只显示简历容器及其子元素 */
.resume-wrapper, .resume-wrapper * {
visibility: visible;
}
/* 同时也建议去掉页面的默认边距，防止产生额外线条 */
body, html {
margin: 0;
padding: 0;
}
body {
background: #fff;
-webkit-print-color-adjust: exact; /* 强制打印背景色 (Chrome/Safari) */
print-color-adjust: exact; /* 强制打印背景色 (Firefox) */
}
.resume-wrapper {
position: absolute;
left: 0;
top: 0;
width: 100%;
max-width: none;
margin: 0;
padding: 0;
border: none;
/* 关键：去除所有可能产生边框的样式 */
border: none !important;
box-shadow: none !important;
outline: none !important; /* 有时候是轮廓线 */
border-radius: 0 !important;
background: transparent !important; /* 防止背景色形成色块 */
}
/* 字体调整：使用 pt 单位更适合打印 */
.resume-wrapper { font-size: 10.5pt; line-height: 1.4; }
.resume-wrapper h1 { font-size: 18pt; margin-bottom: 5pt; }
.resume-wrapper h1 + ul { font-size: 9pt; margin-bottom: 15pt; gap: 10pt; }
.resume-wrapper h2 { font-size: 14pt; margin-top: 15pt; margin-bottom: 8pt; padding-bottom: 3pt; }
.resume-wrapper h3 {
font-size: 11pt;
margin-top: 10pt;
padding: 4pt 8pt 4pt 30px; /* 调整了左内边距，让文字离边框近一点，更美观 */
}
.resume-wrapper h3 + p {
/* 核心修复代码 START */
border-left: 4px solid #007bff !important; /* 1. 加上 !important */
-webkit-print-color-adjust: exact; /* 2. 强制该元素打印背景/边框颜色 */
print-color-adjust: exact; /* 3. Firefox 兼容 */
background-color: rgba(0, 123, 255, 0.05) !important; /* 4. 可选：加个极淡的背景色增强存在感 */
/* 核心修复代码 END */
page-break-after: avoid;
}
.resume-wrapper h4 { font-size: 11pt; margin-top: 8pt; }
/* 隐藏网页端特有的元素 */
.resume-wrapper a { border-bottom: none; color: #000; text-decoration: none; }
/* 关键：分页控制 */
h2, h3, h4 { page-break-after: avoid; } /* 标题后不分页 */
li { page-break-inside: avoid; } /* 列表项内部不分页 */
section, div { page-break-inside: auto; }
/* 打印时的布局微调 */
.resume-wrapper h3 + p {
margin-top: -32px; /* 打印时微调位置 */
}
/* 移除不必要的装饰 */
.resume-wrapper img { display: none; } /* 简历通常不打印装饰图片，除非是作品集 */
.sidebar,.right-sidebar,.left-sidebar,.sticky,.article-details,.site-footer,.disqus-container,.article-footer { display: none; }
}
/* ==========================================================================
5. 移动端适配
========================================================================== */
@media (max-width: 600px) {
.resume-wrapper {
padding: 20px;
margin: 0;
border-radius: 0;
}
/* 移动端取消负边距，改为流式布局 */
.resume-wrapper h3 {
flex-direction: column;
align-items: flex-start;
}
.resume-wrapper h3 + p {
margin: 0 0 10px 0;
text-align: left;
}
.resume-wrapper h3 + p em {
background: none;
padding-left: 0;
display: block;
margin-bottom: 5px;
color: #888;
font-size: 0.85rem;
}
}
&lt;/style></description></item></channel></rss>