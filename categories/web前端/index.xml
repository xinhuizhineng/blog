<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Webå‰ç«¯ on æˆ‘çš„ç©ºé—´</title><link>https://changxiangyu.cn/categories/web%E5%89%8D%E7%AB%AF/</link><description>Recent content in Webå‰ç«¯ on æˆ‘çš„ç©ºé—´</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 22 Jan 2024 10:05:18 +0800</lastBuildDate><atom:link href="https://changxiangyu.cn/categories/web%E5%89%8D%E7%AB%AF/index.xml" rel="self" type="application/rss+xml"/><item><title>Angular + Ng-Zorro æ¨¡æ€æ¡†æ‹–æ‹½åŠŸèƒ½</title><link>https://changxiangyu.cn/p/angular--ng-zorro-%E6%A8%A1%E6%80%81%E6%A1%86%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD/</link><pubDate>Mon, 22 Jan 2024 10:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/angular--ng-zorro-%E6%A8%A1%E6%80%81%E6%A1%86%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD/</guid><description>&lt;h2 id="åŸºæœ¬åŸç†">åŸºæœ¬åŸç†&lt;/h2>
&lt;p>é€šè¿‡ç›‘å¬é¼ æ ‡çš„æŒ‰ä¸‹ï¼ˆmousedownï¼‰ï¼Œå¼¹èµ·ï¼ˆmouseupï¼‰ï¼Œç§»åŠ¨ï¼ˆmousemoveï¼‰ä¸‰ä¸ªäº‹ä»¶æ¥è®¡ç®—ç§»åŠ¨çš„è·ç¦»ï¼Œä»è€Œè°ƒæ•´æ¨¡æ€æ¡†çš„æ–°ä½ç½®ã€‚&lt;/p>
&lt;ul>
&lt;li>é¼ æ ‡æŒ‰ä¸‹ï¼ˆmousedownï¼‰ï¼š
&lt;ul>
&lt;li>è®°å½•é¼ æ ‡æŒ‰ä¸‹æ—¶çš„ä½ç½®å’Œå¼¹çª—å½“å‰çš„ä½ç½®ï¼Œå¹¶è®¾ç½®å¼¹çª—å·¦ä¾§å’Œé¡¶éƒ¨è¾¹è·ä¸ºå½“å‰ä½ç½®ï¼›&lt;/li>
&lt;li>å°† &lt;code>canMove&lt;/code> æ ‡å¿—è®¾ç½®ä¸º &lt;code>true&lt;/code>ï¼Œè¡¨ç¤ºæ¨¡æ€æ¡†å¯ä»¥ç§»åŠ¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é¼ æ ‡å¼¹èµ·ï¼ˆmouseupï¼‰ï¼š
&lt;ul>
&lt;li>å°† &lt;code>canMove&lt;/code> æ ‡å¿—è®¾ç½®ä¸º &lt;code>false&lt;/code>ï¼Œè¡¨ç¤ºåœæ­¢ç§»åŠ¨æ¨¡æ€æ¡†ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é¼ æ ‡ç§»åŠ¨ï¼ˆmousemoveï¼‰ï¼š
&lt;ul>
&lt;li>å¦‚æœ &lt;code>canMove&lt;/code> ä¸º &lt;code>true&lt;/code>ï¼Œåˆ™è®¡ç®—é¼ æ ‡ç§»åŠ¨è·ç¦»ã€‚&lt;/li>
&lt;li>æ ¹æ®é¼ æ ‡çš„ç§»åŠ¨è·ç¦»è°ƒæ•´æ¨¡æ€æ¡†çš„æ–°ä½ç½®ï¼Œä½¿ç”¨æ¸²æŸ“å™¨è®¾ç½®æ¨¡æ€æ¡†çš„æ–°å·¦ä¾§å’Œé¡¶éƒ¨åç§»å€¼ï¼Œä»è€Œå®ç°æ‹–æ‹½æ•ˆæœã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="é€šè¿‡nz-modalæ¨¡æ¿ç”Ÿæˆçš„å¼¹çª—">é€šè¿‡nz-modalæ¨¡æ¿ç”Ÿæˆçš„å¼¹çª—&lt;/h2>
&lt;p>å®ç°æ­¥éª¤ï¼š&lt;/p>
&lt;h3 id="1é€šè¿‡æŒ‡ä»¤æ¥ç»‘å®šæ‹–æ‹½æ–¹æ³•-drag-modaldirectivets-">1.é€šè¿‡æŒ‡ä»¤æ¥ç»‘å®šæ‹–æ‹½æ–¹æ³•( drag-modal.directive.ts )ï¼š&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { Directive, Input } from &amp;#39;@angular/core&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { NzModalRef } from &amp;#39;ng-zorro-antd/modal&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { ModalDragService } from &amp;#39;./drag-modal.service.ts&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@Directive({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector: &amp;#39;[dragModal]&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export class DragModalDirective {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @Input() dragModal: NzModalRef;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> constructor(private modalDragService: ModalDragService) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ngAfterViewInit() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> setTimeout(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.modalDragService.enableModalDrag(this.dragModal);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }, 1000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2æ³¨å†Œæ¨¡å—-modal-dragmodulets">2.æ³¨å†Œæ¨¡å— (modal-drag.module.ts)&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { NgModule } from &amp;#39;@angular/core&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { CommonModule } from &amp;#39;@angular/common&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { DragModalDirective } from &amp;#34;./drag-modal.directive&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { ModalDragService } from &amp;#39;./drag-modal.service.ts&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@NgModule({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> providers: [ModalDragService],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> declarations: [DragModalDirective],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imports: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CommonModule,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> exports: [DragModalDirective]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export class ModalDragModule { }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>å°† &lt;code>ModalDragModule&lt;/code> å¯¼å…¥åˆ°éœ€è¦ä½¿ç”¨å¼¹çª—æ‹–æ‹½çš„åŠŸèƒ½æ¨¡å—ä¸­ã€‚&lt;/li>
&lt;li>åœ¨ &lt;code>&amp;lt;nz-modal&amp;gt;&lt;/code> æ ‡ç­¾ä¸­å¢åŠ ä¸€ä¸ªæ¨¡æ¿å¼•ç”¨å˜é‡ï¼ˆä¾‹å¦‚ &lt;code>#modal&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>å°†è¯¥å˜é‡ä¼ é€’ç»™ &lt;code>dragModal&lt;/code> æŒ‡ä»¤ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-1.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-2.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="é€šè¿‡nzmodalserviceæœåŠ¡åˆ›å»ºçš„å¼¹çª—">é€šè¿‡NzModalServiceæœåŠ¡åˆ›å»ºçš„å¼¹çª—&lt;/h2>
&lt;p>å®ç°æ­¥éª¤ï¼š
åˆ©ç”¨æœåŠ¡æŠŠäº‹ä»¶ç»‘å®šåœ¨modalçš„headerä¸Šï¼Œé€šè¿‡æ§åˆ¶mousedown,mouseup,mousemoveï¼Œæ¥å®ç°æ‹–æ‹½&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { Injectable, RendererFactory2 } from &amp;#39;@angular/core&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@Injectable({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> providedIn: &amp;#39;root&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">})
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export class ModalDragService {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> constructor(private rendererFactory2: RendererFactory2,) { }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ¿€æ´»å¼¹çª—æ‹–æ‹½
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enableModalDrag(refModal) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> refModal.afterOpen.subscribe(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const render = this.rendererFactory2.createRenderer(null, null);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ•´ä¸ªæ‚¬æµ®å±‚çš„dom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const modalBackground = refModal.getElement();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¼¹çª—çš„dom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const modalElement = refModal.getElement().querySelector(&amp;#39;.ant-modal-content&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¼¹çª—headerçš„dom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const modalTitleElement = this.createModalTitleElement(render, modalElement);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç»‘å®šæ‹–æ‹½äº‹ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.dragListen(render, modalTitleElement, modalElement, modalBackground);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è‡ªå®šä¹‰å¼¹çª—headeræ‹–æ‹½åŒºåŸŸçš„å¤§å°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> createModalTitleElement(render, modalElement) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let element = document.createElement(&amp;#39;div&amp;#39;) as any;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;width&amp;#39;, &amp;#39;100%&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;height&amp;#39;, &amp;#39;54px&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;position&amp;#39;, &amp;#39;absolute&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;top&amp;#39;, &amp;#39;0&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;left&amp;#39;, &amp;#39;0&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;cursor&amp;#39;, &amp;#39;move&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-moz-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-webkit-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-ms-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;-khtml-user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(element, &amp;#39;user-select&amp;#39;, &amp;#39;none&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.appendChild(modalElement, element);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return element;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç›‘å¬é¼ æ ‡çš„mousedownï¼Œmouseupï¼Œmousemoveäº‹ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dragListen(render, modalTitleElement, modalElement, modalBackground) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.listen(modalTitleElement, &amp;#39;mousedown&amp;#39;, function (event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è®°å½•äº†é¼ æ ‡æŒ‰ä¸‹æ—¶çš„ä½ç½®ï¼ˆmouseDownX å’Œ mouseDownYï¼‰ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è·å–äº†æ¨¡æ€æ¡†å½“å‰çš„ä½ç½®ï¼ˆmodalX å’Œ modalYï¼‰ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è®¾ç½®æ¨¡æ€æ¡†çš„å·¦ä¾§å’Œé¡¶éƒ¨è¾¹è·ä¸ºå½“å‰ä½ç½®ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å°† canMove æ ‡å¿—è®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºæ¨¡æ€æ¡†å¯ä»¥ç§»åŠ¨ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.mouseDownX = event.clientX;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.mouseDownY = event.clientY;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.modalX = modalElement.offsetLeft;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.modalY = modalElement.offsetTop;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;left&amp;#39;, `${this.modalX}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;top&amp;#39;, `${this.modalY}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.canMove = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }.bind(this));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.listen(modalTitleElement, &amp;#39;mouseup&amp;#39;, function (event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å°† canMove æ ‡å¿—è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºåœæ­¢ç§»åŠ¨æ¨¡æ€æ¡†
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.canMove = false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }.bind(this));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.listen(modalBackground, &amp;#39;mousemove&amp;#39;, function (event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¦‚æœ canMove ä¸º trueï¼Œåˆ™è®¡ç®—é¼ æ ‡ç§»åŠ¨è·ç¦»ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ ¹æ®é¼ æ ‡çš„ç§»åŠ¨è·ç¦»è°ƒæ•´æ¨¡æ€æ¡†çš„æ–°ä½ç½®ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ä½¿ç”¨æ¸²æŸ“å™¨è®¾ç½®æ¨¡æ€æ¡†çš„æ–°å·¦ä¾§å’Œé¡¶éƒ¨åç§»å€¼ï¼Œä»è€Œå®ç°æ‹–æ‹½æ•ˆæœã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (this.canMove) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let moveX = event.clientX - this.mouseDownX;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let moveY = event.clientY - this.mouseDownY;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let newModalX = this.modalX + moveX;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let newModalY = this.modalY + moveY;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;left&amp;#39;, `${newModalX}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render.setStyle(modalElement, &amp;#39;top&amp;#39;, `${newModalY}px`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }.bind(this));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨åˆå§‹åŒ–&lt;code>modal&lt;/code>æ—¶ï¼Œä½¿ç”¨&lt;code>modalDragService&lt;/code>çš„&lt;code>enableModalDrag&lt;/code>æ–¹æ³•æ¿€æ´»æ‹–æ‹½åŠŸèƒ½ï¼›&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-3.png"
loading="lazy"
>&lt;/p>
&lt;p>ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p>
&lt;p>&lt;img src="https://changxiangyu.cn/images/web/popupdrag-4.png"
loading="lazy"
>&lt;/p></description></item><item><title>NVM å®‰è£…ä¸é…ç½®å®Œå…¨æŒ‡å—</title><link>https://changxiangyu.cn/p/nvm-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</link><pubDate>Thu, 18 Jan 2024 11:02:00 +0800</pubDate><guid>https://changxiangyu.cn/p/nvm-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</guid><description>&lt;h1 id="nvm-å®‰è£…ä¸é…ç½®å®Œå…¨æŒ‡å—">NVM å®‰è£…ä¸é…ç½®å®Œå…¨æŒ‡å—&lt;/h1>
&lt;p>NVM (Node Version Manager) æ˜¯ç®¡ç† Node.js ç‰ˆæœ¬çš„åˆ©å™¨ï¼Œå…è®¸æ‚¨åœ¨åŒä¸€å°è®¾å¤‡ä¸Šåˆ‡æ¢ä¸åŒç‰ˆæœ¬çš„ Node.jsï¼Œä»¥é€‚åº”ä¸åŒçš„é¡¹ç›®éœ€æ±‚ã€‚&lt;/p>
&lt;h2 id="ç¬¬ä¸€æ­¥æ¸…ç†æ—§ç¯å¢ƒé‡è¦">ç¬¬ä¸€æ­¥ï¼šæ¸…ç†æ—§ç¯å¢ƒï¼ˆé‡è¦ï¼‰&lt;/h2>
&lt;p>&lt;strong>æ³¨æ„ï¼š&lt;/strong> åœ¨å®‰è£… NVM ä¹‹å‰ï¼Œå¿…é¡»å½»åº•å¸è½½ç”µè„‘ä¸Šç°æœ‰çš„ Node.js ç‰ˆæœ¬å¹¶åˆ é™¤æ®‹ç•™æ–‡ä»¶ï¼Œå¦åˆ™ææ˜“äº§ç”Ÿè·¯å¾„å†²çªã€‚&lt;/p>
&lt;h3 id="windows-ç”¨æˆ·">Windows ç”¨æˆ·&lt;/h3>
&lt;ol>
&lt;li>æ‰“å¼€â€œæ§åˆ¶é¢æ¿â€ -&amp;gt; â€œå¸è½½ç¨‹åºâ€ï¼Œå¸è½½ Node.jsã€‚&lt;/li>
&lt;li>æ‰‹åŠ¨æ£€æŸ¥å¹¶åˆ é™¤å®‰è£…ç›®å½•ï¼ˆé€šå¸¸ä¸º &lt;code>C:\Program Files\nodejs&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>æ£€æŸ¥ç”¨æˆ·ç›®å½•ä¸‹ï¼ˆ&lt;code>C:\Users\ç”¨æˆ·å&lt;/code>ï¼‰æ˜¯å¦å­˜åœ¨ &lt;code>node_modules&lt;/code>ã€&lt;code>.npm&lt;/code> æˆ– &lt;code>.npmrc&lt;/code> æ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œå»ºè®®ä¸€å¹¶åˆ é™¤ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="macos-ç”¨æˆ·">macOS ç”¨æˆ·&lt;/h3>
&lt;ul>
&lt;li>å¦‚æœä¹‹å‰é€šè¿‡ pkg å®‰è£…ï¼Œå»ºè®®æ‰‹åŠ¨åˆ é™¤ &lt;code>/usr/local/bin/node&lt;/code>ã€&lt;code>/usr/local/lib/node_modules&lt;/code> ç­‰ç›¸å…³æ–‡ä»¶ã€‚&lt;/li>
&lt;li>å¦‚æœæ˜¯é€šè¿‡ Homebrew å®‰è£…ï¼Œè¿è¡Œï¼š&lt;code>brew uninstall node&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ç¬¬äºŒæ­¥å®‰è£…-nvm">ç¬¬äºŒæ­¥ï¼šå®‰è£… NVM&lt;/h2>
&lt;h3 id="æ–¹æ¡ˆ-awindows-ç³»ç»Ÿ-nvm-windows">æ–¹æ¡ˆ Aï¼šWindows ç³»ç»Ÿ (nvm-windows)&lt;/h3>
&lt;h4 id="1-ä¸‹è½½ä¸å®‰è£…">1. ä¸‹è½½ä¸å®‰è£…&lt;/h4>
&lt;ul>
&lt;li>&lt;strong>ä¸‹è½½åœ°å€&lt;/strong>ï¼š&lt;a class="link" href="https://github.com/coreybutler/nvm-windows/releases" target="_blank" rel="noopener"
>GitHub - nvm-windows releases&lt;/a>&lt;/li>
&lt;li>&lt;strong>æ“ä½œ&lt;/strong>ï¼šæ¨èä¸‹è½½ &lt;code>nvm-setup.exe&lt;/code>ã€‚åŒå‡»è¿è¡Œï¼ŒæŒ‰ç…§æç¤ºç‚¹å‡»â€œä¸‹ä¸€æ­¥â€å³å¯ã€‚
&lt;ul>
&lt;li>&lt;em>æç¤º&lt;/em>ï¼šå®‰è£…è·¯å¾„å»ºè®®ä¿æŒé»˜è®¤ï¼Œæˆ–è€…ç¡®ä¿è·¯å¾„ä¸­&lt;strong>ä¸åŒ…å«ç©ºæ ¼å’Œä¸­æ–‡å­—ç¬¦&lt;/strong>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="2-ç¯å¢ƒå˜é‡é…ç½®-å…³é”®æ­¥éª¤">2. ç¯å¢ƒå˜é‡é…ç½® (å…³é”®æ­¥éª¤)&lt;/h4>
&lt;p>è™½ç„¶å®‰è£…ç¨‹åºé€šå¸¸ä¼šè‡ªåŠ¨é…ç½®ï¼Œä½†ä¸ºäº†ç¡®ä¿ç¨³å®šæ€§ï¼Œå»ºè®®æ‰‹åŠ¨æ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æ‰“å¼€è®¾ç½®&lt;/strong>ï¼šå³é”®â€œæ­¤ç”µè„‘â€ -&amp;gt; â€œå±æ€§â€ -&amp;gt; â€œé«˜çº§ç³»ç»Ÿè®¾ç½®â€ -&amp;gt; â€œç¯å¢ƒå˜é‡â€ã€‚&lt;/li>
&lt;li>&lt;strong>æ£€æŸ¥/æ–°å»ºç”¨æˆ·å˜é‡&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">å˜é‡å&lt;/th>
&lt;th style="text-align:left">å˜é‡å€¼ç¤ºä¾‹&lt;/th>
&lt;th style="text-align:left">è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;code>NVM_HOME&lt;/code>&lt;/td>
&lt;td style="text-align:left">&lt;code>C:\Users\YourUser\AppData\Roaming\nvm&lt;/code>&lt;/td>
&lt;td style="text-align:left">NVM çš„å®‰è£…ç›®å½•&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>NVM_SYMLINK&lt;/code>&lt;/td>
&lt;td style="text-align:left">&lt;code>C:\Program Files\nodejs&lt;/code>&lt;/td>
&lt;td style="text-align:left">Node.js çš„å¿«æ·æ–¹å¼æ˜ å°„ç›®å½•&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ol start="3">
&lt;li>&lt;strong>ç¼–è¾‘ Path å˜é‡&lt;/strong>ï¼š
åœ¨â€œç”¨æˆ·å˜é‡â€æˆ–â€œç³»ç»Ÿå˜é‡â€ä¸­æ‰¾åˆ° &lt;code>Path&lt;/code>ï¼Œç‚¹å‡»â€œç¼–è¾‘â€ï¼Œç¡®ä¿åˆ—è¡¨ä¸­åŒ…å«ä»¥ä¸‹ä¸¤é¡¹å¼•ç”¨ï¼š
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">%NVM_HOME%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%NVM_SYMLINK%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>&lt;strong>ç”Ÿæ•ˆ&lt;/strong>ï¼šä¿å­˜è®¾ç½®åï¼Œ&lt;strong>é‡å¯&lt;/strong> CMD æˆ– PowerShell çª—å£ã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="3-é…ç½®-nvm-å›½å†…é•œåƒ">3. é…ç½® NVM å›½å†…é•œåƒ&lt;/h4>
&lt;p>ä¸ºäº†è§£å†³ä¸‹è½½æ…¢çš„é—®é¢˜ï¼Œè¯·åœ¨&lt;strong>ç®¡ç†å‘˜æƒé™&lt;/strong>çš„ç»ˆç«¯ä¸­è¿è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nvm node_mirror https://npmmirror.com/mirrors/node/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm npm_mirror https://npmmirror.com/mirrors/npm/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="è¿›é˜¶é…ç½®è‡ªå®šä¹‰-npm-å…¨å±€è·¯å¾„-windows-æ¨è">è¿›é˜¶é…ç½®ï¼šè‡ªå®šä¹‰ NPM å…¨å±€è·¯å¾„ (Windows æ¨è)&lt;/h4>
&lt;p>æ­¤æ­¥éª¤å¯é€‰ï¼Œä½†å¼ºçƒˆå»ºè®®é…ç½®ï¼Œä»¥ä¾¿ç»Ÿä¸€ç®¡ç†å…¨å±€åŒ…ï¼ˆå¦‚ vue-cli, yarnï¼‰ã€‚&lt;/p>
&lt;ol>
&lt;li>æ–°å»ºæ–‡ä»¶å¤¹
åœ¨æ‚¨çš„ NVM æˆ–ä»»æ„ç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š&lt;/li>
&lt;/ol>
&lt;p>D:\nodejs\node_global (å­˜æ”¾å…¨å±€åŒ…)
D:\nodejs\node_cache (å­˜æ”¾ç¼“å­˜)
2. ä¿®æ”¹ NPM é…ç½®
æ‰“å¼€ç»ˆç«¯æ‰§è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®¾ç½®å…¨å±€æ¨¡å—çš„å®‰è£…è·¯å¾„
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config set prefix &amp;#34;D:\nodejs\node_global&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è®¾ç½®ç¼“å­˜è·¯å¾„
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config set cache &amp;#34;D:\nodejs\node_cache&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰§è¡Œå®Œæ¯•åï¼Œæ‚¨å¯ä»¥è¿è¡Œ npm config list æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆã€‚&lt;/p>
&lt;ol start="3">
&lt;li>é…ç½®å…¨å±€è·¯å¾„ç¯å¢ƒå˜é‡ (Environment Variables)&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœä¸é…ç½®æ­¤é¡¹ï¼Œå®‰è£…çš„å…¨å±€å‘½ä»¤ï¼ˆå¦‚ vueï¼‰å°†æ— æ³•è¯†åˆ«ã€‚&lt;/p>
&lt;p>æ“ä½œè·¯å¾„ï¼šå³é”®â€œæ­¤ç”µè„‘â€ -&amp;gt; å±æ€§ -&amp;gt; é«˜çº§ç³»ç»Ÿè®¾ç½® -&amp;gt; ç¯å¢ƒå˜é‡ã€‚&lt;/p>
&lt;ul>
&lt;li>é…ç½® Path å˜é‡ (ç³»ç»Ÿå˜é‡/ç”¨æˆ·å˜é‡)ï¼š
&lt;ul>
&lt;li>æ‰¾åˆ° &lt;code>Path&lt;/code> å˜é‡ -&amp;gt; ç¼–è¾‘ -&amp;gt; æ–°å»ºã€‚&lt;/li>
&lt;li>æ·»åŠ è·¯å¾„ï¼š&lt;code>D:\nodejs\node_global&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>é…ç½® NODE_PATH (ç³»ç»Ÿå˜é‡)ï¼Œåœ¨â€œç³»ç»Ÿå˜é‡â€åŒºåŸŸï¼Œç‚¹å‡»â€œæ–°å»ºâ€ï¼š
&lt;ul>
&lt;li>æ–°å»ºå˜é‡åï¼š&lt;code>NODE_PATH&lt;/code>&lt;/li>
&lt;li>å˜é‡å€¼ï¼š&lt;code>D:\nodejs\node_global\node_modules&lt;/code>&lt;/li>
&lt;li>æ³¨æ„ï¼šå¿…é¡»å¤šåŠ ä¸€å±‚ &lt;code>node_modules&lt;/code>ï¼Œå¦åˆ™ require æ— æ³•æ‰¾åˆ°æ¨¡å—ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>éªŒè¯ï¼š é‡å¯ç»ˆç«¯åï¼Œè¿è¡Œ &lt;code>npm install express -g&lt;/code>ï¼Œæ£€æŸ¥æ˜¯å¦å®‰è£…åˆ°äº†æ–°ç›®å½•ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç‰¹åˆ«æç¤ºï¼ˆå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ NVMï¼‰
å¦‚æœæ‚¨æ˜¯é…åˆ NVM ä½¿ç”¨æ­¤é…ç½®ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ Node ç‰ˆæœ¬éƒ½ä¼šå…±ç”¨è¿™ä¸ª node_globalã€‚&lt;/p>
&lt;ul>
&lt;li>ä¼˜ç‚¹ï¼šåˆ‡æ¢ Node ç‰ˆæœ¬åï¼Œä¸éœ€è¦é‡æ–°å®‰è£…å…¨å±€åŒ…ï¼ˆå¦‚ yarn, cnpmï¼‰ã€‚&lt;/li>
&lt;li>ç¼ºç‚¹ï¼šå¦‚æœæŸä¸ªå…¨å±€åŒ…ä¾èµ–ç‰¹å®šçš„ Node ç‰ˆæœ¬ï¼ˆä¾‹å¦‚æ—§ç‰ˆ Sassï¼‰ï¼Œåˆ‡æ¢ Node ç‰ˆæœ¬åå¯èƒ½ä¼šå¯¼è‡´è¯¥å·¥å…·æŠ¥é”™ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="æ–¹æ¡ˆ-bmacos--linux-ç³»ç»Ÿ-nvm">æ–¹æ¡ˆ Bï¼šmacOS / Linux ç³»ç»Ÿ (nvm)&lt;/h3>
&lt;ol>
&lt;li>å®‰è£…è„šæœ¬
æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œå®˜æ–¹å®‰è£…è„šæœ¬ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>(å¦‚æœç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·å°è¯•æœç´¢â€œnvm giteeâ€å¯»æ‰¾å›½å†…æ¬è¿è„šæœ¬)&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>é…ç½®ç¯å¢ƒå˜é‡
å®‰è£…è„šæœ¬é€šå¸¸ä¼šè‡ªåŠ¨å†™å…¥é…ç½®æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ç”Ÿæ•ˆï¼ˆè¾“å…¥ nvm æç¤º command not foundï¼‰ï¼Œè¯·æ‰‹åŠ¨é…ç½®ï¼š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">macOS (Zsh): vim ~/.zshrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Linux (Bash): vim ~/.bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export NVM_DIR=&amp;#34;$HOME/.nvm&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ -s &amp;#34;$NVM_DIR/nvm.sh&amp;#34; ] &amp;amp;&amp;amp; \. &amp;#34;$NVM_DIR/nvm.sh&amp;#34; # åŠ è½½ nvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ -s &amp;#34;$NVM_DIR/bash_completion&amp;#34; ] &amp;amp;&amp;amp; \. &amp;#34;$NVM_DIR/bash_completion&amp;#34; # åŠ è½½è‡ªåŠ¨è¡¥å…¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#åœ¨æ­¤å¤„ä¹Ÿå¯ä»¥ç›´æ¥é…ç½®å›½å†…é•œåƒå˜é‡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export NVM_NODEJS_ORG_MIRROR=https://npmmirror.com/mirrors/node/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>ä½¿é…ç½®ç”Ÿæ•ˆï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">source ~/.zshrc # æˆ– source ~/.bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç¬¬ä¸‰æ­¥ä½¿ç”¨-nvm-å®‰è£…-nodejs">ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ NVM å®‰è£… Node.js&lt;/h2>
&lt;p>é…ç½®å¥½ NVM åï¼Œå³å¯çµæ´»ç®¡ç† Node ç‰ˆæœ¬ã€‚&lt;/p>
&lt;ol>
&lt;li>æŸ¥çœ‹å¯å®‰è£…ç‰ˆæœ¬ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm list available # Windows
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm ls-remote # Mac/Linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼ˆæ¨èå®‰è£… LTS é•¿æœŸæ”¯æŒç‰ˆï¼‰ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm install 18.17.0 # å®‰è£…å…·ä½“çš„ç‰ˆæœ¬å·
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm install lts # è‡ªåŠ¨å®‰è£…æœ€æ–°çš„ LTS ç‰ˆæœ¬
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>åˆ‡æ¢/ä½¿ç”¨ç‰ˆæœ¬ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm use 18.17.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(Windows ç”¨æˆ·å¦‚æœé‡åˆ° &amp;#34;exit status 1&amp;#34; ä¹±ç æŠ¥é”™ï¼Œè¯·å³é”®é€‰æ‹©*â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€*ç»ˆç«¯)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>æŸ¥çœ‹å½“å‰å·²å®‰è£…ç‰ˆæœ¬ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvm list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç¬¬å››æ­¥é…ç½®-npm-é•œåƒåŠ é€Ÿä¾èµ–åŒ…ä¸‹è½½">ç¬¬å››æ­¥ï¼šé…ç½® NPM é•œåƒï¼ˆåŠ é€Ÿä¾èµ–åŒ…ä¸‹è½½ï¼‰&lt;/h2>
&lt;p>å®‰è£…å®Œ Node.js åï¼Œnpm å‘½ä»¤è‡ªåŠ¨å¯ç”¨ã€‚å»ºè®®é…ç½®æ·˜å®é•œåƒï¼ˆnpmmirrorï¼‰ä»¥åŠ é€Ÿ npm installã€‚&lt;/p>
&lt;ol>
&lt;li>è®¾ç½®é•œåƒæºï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config set registry https://registry.npmmirror.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>éªŒè¯æ˜¯å¦æˆåŠŸï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config get registry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># é¢„æœŸè¾“å‡º: https://registry.npmmirror.com/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨">å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">å‘½ä»¤&lt;/th>
&lt;th style="text-align:left">è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm install &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">å®‰è£…æŒ‡å®šç‰ˆæœ¬ (å¦‚ nvm install 20.10.0)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm use &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm list&lt;/code>&lt;/td>
&lt;td style="text-align:left">åˆ—å‡ºæœ¬åœ°å·²å®‰è£…çš„æ‰€æœ‰ç‰ˆæœ¬&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm uninstall &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">å¸è½½æŒ‡å®šç‰ˆæœ¬&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>nvm alias default &amp;lt;version&amp;gt;&lt;/code>&lt;/td>
&lt;td style="text-align:left">(Mac/Linux) è®¾ç½®é»˜è®¤ç‰ˆæœ¬ï¼Œæ–°å¼€ç»ˆç«¯è‡ªåŠ¨ç”Ÿæ•ˆ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>node -v&lt;/code>&lt;/td>
&lt;td style="text-align:left">æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„ Node ç‰ˆæœ¬&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;code>npm -v&lt;/code>&lt;/td>
&lt;td style="text-align:left">æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„ NPM ç‰ˆæœ¬&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="-å¸¸è§é—®é¢˜æç¤º">ğŸ’¡ å¸¸è§é—®é¢˜æç¤º&lt;/h2>
&lt;p>æƒé™é—®é¢˜ï¼šWindows ç”¨æˆ·åœ¨æ‰§è¡Œ nvm use åˆ‡æ¢ç‰ˆæœ¬æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMD æˆ– PowerShellï¼Œå¦åˆ™æ— æ³•åˆ›å»ºè½¯é“¾æ¥ã€‚
è·¯å¾„ç©ºæ ¼ï¼šç¡®ä¿ NVM å®‰è£…è·¯å¾„ä¸åŒ…å«ç©ºæ ¼ï¼ˆå¦‚ Program Files æœ‰æ—¶ä¼šå¼•èµ·å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®å®‰è£…åœ¨ C:\nvm æˆ–ç±»ä¼¼ç®€å•è·¯å¾„ï¼‰ã€‚&lt;/p></description></item><item><title>ä¹¾å¤(Qiankun)å¾®å‰ç«¯è·¯ç”±</title><link>https://changxiangyu.cn/p/%E4%B9%BE%E5%9D%A4qiankun%E5%BE%AE%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1/</link><pubDate>Thu, 27 Apr 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E4%B9%BE%E5%9D%A4qiankun%E5%BE%AE%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1/</guid><description>&lt;p>åœ¨å¾®å‰ç«¯æ¶æ„ä¸­ï¼Œä¸»åº”ç”¨ä¸å­åº”ç”¨çš„æŠ€æœ¯æ ˆå·®å¼‚å¾€å¾€ä¼šå¸¦æ¥ä¸€äº›æ„æƒ³ä¸åˆ°çš„è·¯ç”±åŒæ­¥é—®é¢˜ã€‚æœ¬æ–‡å°†åˆ†äº«ä¸€ä¸ªåœ¨ Vue3 ä¸»åº”ç”¨ + Angular å­åº”ç”¨ åœºæ™¯ä¸‹ï¼Œé‡åˆ°çš„â€œä¸‰çº§è·¯ç”±å›é€€å¯¼è‡´å¯¼èˆªå¤±æ•ˆâ€çš„å„ç§å‘åŠå…¶è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="1-é—®é¢˜æè¿°">1. é—®é¢˜æè¿°&lt;/h2>
&lt;p>åœºæ™¯&lt;/p>
&lt;ul>
&lt;li>ä¸»åº”ç”¨ï¼šVue3 + Vue Router (Hash æ¨¡å¼)&lt;/li>
&lt;li>å­åº”ç”¨ï¼šAngular (ä½¿ç”¨ Qiankun æ¥å…¥)&lt;/li>
&lt;li>æ“ä½œè·¯å¾„ï¼šè¿›å…¥ Angular å­åº”ç”¨ -&amp;gt; è¿›å…¥äºŒçº§é¡µé¢ -&amp;gt; è¿›å…¥ä¸‰çº§é¡µé¢ -&amp;gt; ç‚¹å‡»â€œè¿”å›â€æŒ‰é’®å›é€€åˆ°ä¸Šä¸€çº§ã€‚
ç—‡çŠ¶
å½“ä»ä¸‰çº§è·¯ç”±å›é€€åï¼Œå†æ¬¡ç‚¹å‡»ä¸»åº”ç”¨ä¾§è¾¹æ æˆ–å…¶ä»–èœå•æ—¶ï¼Œé¡µé¢æ— ååº”ã€‚æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå‡ºç°ç±»ä¼¼ &lt;code>route undefined&lt;/code> çš„æŠ¥é”™ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="2-åŸå› æ·±åº¦åˆ†æ">2. åŸå› æ·±åº¦åˆ†æ&lt;/h2>
&lt;p>ç»è¿‡æºç æ’æŸ¥ï¼Œå‘ç°é—®é¢˜çš„æ ¹æºåœ¨äº &lt;strong>Vue Router&lt;/strong> ä¸ &lt;strong>Angular Router&lt;/strong> å¯¹åº•å±‚ &lt;strong>History API&lt;/strong> çš„ä½¿ç”¨å·®å¼‚ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Vue Router çš„æœºåˆ¶&lt;/strong>ï¼š Vue3 çš„è·¯ç”±è·³è½¬åº•å±‚è°ƒç”¨äº† &lt;code>changeLocation&lt;/code> å‡½æ•°ã€‚è¯¥å‡½æ•°åœ¨æ‰§è¡Œæ—¶ï¼Œé«˜åº¦ä¾èµ– &lt;code>history.state&lt;/code> æ¥è·å–è·¯ç”±ä¿¡æ¯ã€‚å¦‚æœ &lt;code>history.state&lt;/code> ä¸ºç©ºæˆ–ç¼ºå°‘å…³é”®å­—æ®µï¼ˆå¦‚ &lt;code>current&lt;/code>ï¼‰ï¼ŒVue Router å¯èƒ½æ— æ³•æ­£ç¡®è¯†åˆ«å½“å‰ä½ç½®ï¼Œä»è€Œå¯¼è‡´è·³è½¬é€»è¾‘ä¸­æ–­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Angular Router çš„å·®å¼‚&lt;/strong>ï¼š Angular çš„é»˜è®¤è·¯ç”±è·³è½¬ï¼ˆç‰¹åˆ«æ˜¯ä½¿ç”¨ HTML ä¸­çš„ &lt;code>[routerLink]=&amp;quot;['../']&amp;quot;&lt;/code> æŒ‡ä»¤æ—¶ï¼‰ï¼Œå¹¶ä¸ä¼šé»˜è®¤å‘ &lt;code>history.state&lt;/code> ä¸­å†™å…¥ Vue Router æ‰€éœ€çš„å…ƒæ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>ç»“è®ºï¼šå½“åœ¨ Angular å­åº”ç”¨ä¸­è¿›è¡Œè·¯ç”±å›é€€æ—¶ï¼Œç”±äºæ²¡æœ‰æ­£ç¡®æ›´æ–° &lt;code>history.state&lt;/code>ï¼Œå¯¼è‡´ä¸»åº”ç”¨ï¼ˆVue3ï¼‰æ¥ç®¡è·¯ç”±æ—¶è¯»å–åˆ°äº†ç©ºçŠ¶æ€æˆ–é”™è¯¯çŠ¶æ€ï¼Œæœ€ç»ˆå¼•å‘è·¯ç”±æŠ¥é”™ã€‚&lt;/p>
&lt;h2 id="3-è§£å†³æ–¹æ¡ˆ">3. è§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨â€œå­åº”ç”¨è·³è½¬â€å’Œâ€œä¸»åº”ç”¨ç›‘å¬â€ä¸¤ä¸ªå±‚é¢è¿›è¡Œæ”¹é€ ã€‚&lt;/p>
&lt;h3 id="æ­¥éª¤ä¸€æ”¹é€ -angular-å­åº”ç”¨çš„è·³è½¬æ–¹å¼">æ­¥éª¤ä¸€ï¼šæ”¹é€  Angular å­åº”ç”¨çš„è·³è½¬æ–¹å¼&lt;/h3>
&lt;p>&lt;strong>æ ¸å¿ƒç­–ç•¥&lt;/strong>ï¼šæ”¾å¼ƒ HTML æ¨¡æ¿ä¸­çš„ &lt;code>[routerLink]&lt;/code> è·³è½¬ï¼Œæ”¹ç”¨ API ç¼–ç¨‹å¼å¯¼èˆªï¼Œå¹¶æ‰‹åŠ¨æ³¨å…¥ &lt;code>state&lt;/code>ã€‚&lt;/p>
&lt;p>Angular çš„ &lt;code>Router.navigate&lt;/code> æ–¹æ³•å…è®¸æˆ‘ä»¬ä¼ é€’ &lt;code>NavigationExtras&lt;/code>ï¼Œå…¶ä¸­çš„ &lt;code>state&lt;/code> å±æ€§å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰è·¯ç”±çŠ¶æ€ã€‚è¿™æ­£å¥½å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿ Vue Router æ‰€éœ€çš„æ•°æ®ç»“æ„ã€‚&lt;br>
ä»£ç å®ç° (Angular å­åº”ç”¨)ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// åœ¨ç»„ä»¶ä¸­æ³¨å…¥ Router
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import { Router } from &amp;#39;@angular/router&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">constructor(private _router: Router) {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// æ›¿ä»£åŸæœ¬çš„ [routerLink]=&amp;#34;[&amp;#39;../&amp;#39;]&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">back() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ‰‹åŠ¨æ„å»º state å¯¹è±¡ï¼Œæ¨¡æ‹Ÿ Vue Router çš„ current å­—æ®µ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ³¨æ„ï¼šè¿™é‡Œçš„è·¯å¾„éœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡è°ƒæ•´
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const state = { current: &amp;#39;/kq/kqGroup&amp;#39; };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ä½¿ç”¨ navigate è·³è½¬ï¼Œå¹¶å¸¦ä¸Š state
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this._router.navigate([&amp;#39;/kqGroup&amp;#39;], { state: state });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ³¨æ„ï¼šå»ºè®®ä¸‰çº§è·¯ç”±è·³è½¬æ—¶ï¼ŒURL ä¸­å°½é‡ä¸è¦ç›´æ¥æºå¸¦å‚æ•°ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡ Service æˆ– State ä¼ é€’æ•°æ®ï¼Œä»¥å‡å°‘è·¯ç”±åŒ¹é…çš„å¤æ‚åº¦ã€‚&lt;/p>
&lt;h3 id="æ­¥éª¤äºŒæ”¹é€ -vue3-ä¸»åº”ç”¨çš„è·¯ç”±å®ˆå«">æ­¥éª¤äºŒï¼šæ”¹é€  Vue3 ä¸»åº”ç”¨çš„è·¯ç”±å®ˆå«&lt;/h3>
&lt;p>&lt;strong>æ ¸å¿ƒç­–ç•¥&lt;/strong>ï¼šåœ¨ä¸»åº”ç”¨çš„å…¨å±€è·¯ç”±å®ˆå«ä¸­ï¼Œä¸»åŠ¨æ£€æµ‹å¹¶ä¿®å¤ &lt;code>history.state&lt;/code>ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦åœ¨ &lt;code>router.beforeEach&lt;/code> ä¸­ç›‘å¬è·¯ç”±å˜åŒ–ã€‚å¦‚æœå‘ç° &lt;code>history.state&lt;/code> ä¸¢å¤±æˆ–ä¸å®Œæ•´ï¼ˆç¼ºå°‘ current å­—æ®µï¼‰ï¼Œåˆ™ä½¿ç”¨ &lt;code>history.replaceState&lt;/code> å¼ºåˆ¶è¡¥å…¨ï¼Œç¡®ä¿ Vue Router èƒ½æ­£å¸¸å·¥ä½œã€‚&lt;/p>
&lt;p>ä»£ç å®ç° (Vue3 ä¸»åº”ç”¨)ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { createRouter, createWebHashHistory } from &amp;#39;vue-router&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">const router = createRouter({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history: createWebHashHistory(),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> routes,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">});
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router.beforeEach(async (to, from, next) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 1. æ ¸å¿ƒä¿®å¤é€»è¾‘ï¼šè¡¥å…¨ history.state
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¦‚æœ state å­˜åœ¨ä½†æ²¡æœ‰ current å­—æ®µï¼Œè¯´æ˜å¯èƒ½æ˜¯å­åº”ç”¨è¿‡æ¥çš„è·³è½¬ï¼Œæ‰‹åŠ¨è¡¥å…¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (history.state &amp;amp;&amp;amp; !history.state.current) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#39;æ£€æµ‹åˆ° state ç¼ºå¤±ï¼Œæ‰§è¡Œ replaceState ä¿®å¤&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> window.history.replaceState({ current: to.path }, &amp;#39;&amp;#39;, to.path);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è°ƒè¯•æ—¥å¿—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#39;å¾®å‰ç«¯ history.state ===&amp;#39;, history.state);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#39;å¾®å‰ç«¯ window.location ===&amp;#39;, window.location);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 2. ç‰¹æ®Šä¸šåŠ¡åœºæ™¯ä¿®å¤ï¼ˆå¦‚å·¡æ›´ä¸šåŠ¡ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ä¿®å¤é€šè¿‡èœå•åˆ‡æ¢åï¼Œhistory.state ä¸¢å¤±åº”ç”¨å‰ç¼€ä¿¡æ¯çš„é—®é¢˜
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const current = history.state?.current;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const pathname = window.location.pathname;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (pathname &amp;amp;&amp;amp; pathname.startsWith(&amp;#39;/xg&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (current !== pathname) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history.replaceState(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> { back: from.path, current: window.location.pathname },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> to.path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> );
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 3. å¸¸è§„é‰´æƒä¸è·¯ç”±åˆ†å‘é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!verifyToken() &amp;amp;&amp;amp; to.path !== &amp;#39;/login&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ... å¤„ç†ç™»å½•é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (noLoginPage.includes(to.path)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ path: &amp;#39;/login&amp;#39;, query: { fromPath: to.fullPath } });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ¸…ç†ç¼“å­˜é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (to.path === &amp;#39;/home&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sessionStorage.removeItem(&amp;#39;currentMenu&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sessionStorage.removeItem(&amp;#39;currentPage&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // åŠ¨æ€è·¯ç”±åŠ è½½é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (store.state.menus.routers.length === 0 &amp;amp;&amp;amp; to.path !== &amp;#39;/login&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¤„ç†èœå•åŸºåˆèœå•åˆ—è¡¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const res = await store.dispatch(&amp;#39;menus/getMenus&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> res.forEach((route) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (router.hasRoute(&amp;#39;Main&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router.addRoute(&amp;#39;Main&amp;#39;, route);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const routers = router.getRoutes();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Tipsä¸æ£€æŸ¥é—¨ç¦ç›‘æ§èœå•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (routers.find((item) =&amp;gt; item.path === to.path || /\/monitor\/mj\//.test(to.path))) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ ...to, replace: true });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ path: &amp;#39;/not-find&amp;#39; });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 404 æ£€æµ‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const routers = router.getRoutes();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç®€å•çš„ç™½åå•æ£€æŸ¥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (routers.find(item =&amp;gt; item.path === to.path || /\/monitor\/mj\//.test(to.path))) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next({ path: &amp;#39;/not-find&amp;#39; });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="4-æ€»ç»“">4. æ€»ç»“&lt;/h2>
&lt;p>åœ¨ä¹¾å¤å¾®å‰ç«¯æ¶æ„ä¸­ï¼Œä¸åŒæ¡†æ¶å¯¹ &lt;code>History API&lt;/code> çš„æ“ä½œä¹ æƒ¯ä¸åŒæ˜¯å¯¼è‡´è·¯ç”±ä¸åŒæ­¥çš„å¸¸è§åŸå› ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Angular&lt;/strong> ä¾§ï¼šåˆ©ç”¨ &lt;code>navigate&lt;/code> çš„ &lt;code>state&lt;/code> å‚æ•°ä¸»åŠ¨é…åˆä¸»åº”ç”¨çš„è·¯ç”±æœºåˆ¶ã€‚&lt;/li>
&lt;li>&lt;strong>Vue&lt;/strong> ä¾§ï¼šåˆ©ç”¨ &lt;code>beforeEach&lt;/code> å®ˆå«è¿›è¡Œå…œåº•ï¼Œç¡®ä¿ &lt;code>history.state&lt;/code> å§‹ç»ˆåŒ…å« &lt;code>current&lt;/code> å­—æ®µã€‚
é€šè¿‡åŒå‘å¥”èµ´çš„æ”¹é€ ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†ä¸‰çº§è·¯ç”±å›é€€åçš„â€œæ­»é”â€é—®é¢˜ï¼Œä¿è¯äº†å¾®å‰ç«¯åº”ç”¨çš„æµç•…ä½“éªŒã€‚&lt;/li>
&lt;/ul></description></item><item><title>å¾®ä¿¡æ”¯ä»˜æ¥å…¥æŒ‡å—ï¼šJSAPIã€H5ä¸å°ç¨‹åº</title><link>https://changxiangyu.cn/p/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97jsapih5%E4%B8%8E%E5%B0%8F%E7%A8%8B%E5%BA%8F/</link><pubDate>Sun, 12 Mar 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97jsapih5%E4%B8%8E%E5%B0%8F%E7%A8%8B%E5%BA%8F/</guid><description>&lt;p>æœ¬æ–‡æ€»ç»“äº†å‰ç«¯å¼€å‘ä¸­å¸¸è§çš„å¾®ä¿¡æ”¯ä»˜ä¸‰ç§æ¥å…¥åœºæ™¯åŠå…¶æ ¸å¿ƒæµç¨‹ã€‚&lt;/p>
&lt;h2 id="1-å…¬ä¼—å·æ”¯ä»˜-jsapi">1. å…¬ä¼—å·æ”¯ä»˜ (JSAPI)&lt;/h2>
&lt;p>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šå¾®ä¿¡å†…ç½®æµè§ˆå™¨ã€å¾®ä¿¡å®¢æˆ·ç«¯æ‰«ç ã€ä¼ä¸šå¾®ä¿¡ç½‘é¡µã€‚&lt;/p>
&lt;h3 id="æ ¸å¿ƒæµç¨‹">æ ¸å¿ƒæµç¨‹&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>ç½‘é¡µæˆæƒè·å– Code&lt;/strong>ï¼š
å¼•å¯¼ç”¨æˆ·è®¿é—®å¾®ä¿¡æˆæƒé“¾æ¥ï¼Œè·å– &lt;code>code&lt;/code>ã€‚
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-http" data-lang="http">&lt;span class="line">&lt;span class="cl">&lt;span class="err">https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;response_type=code&amp;amp;scope=snsapi_base&amp;amp;state=123#wechat_redirect
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>&lt;strong>è·å– OpenID&lt;/strong>ï¼š
åç«¯ä½¿ç”¨ &lt;code>appid&lt;/code>ã€&lt;code>secret&lt;/code> å’Œå‰ç«¯ä¼ æ¥çš„ &lt;code>code&lt;/code> æ¢å–ç”¨æˆ·çš„ &lt;code>openid&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>ç»Ÿä¸€ä¸‹å•&lt;/strong>ï¼š
åç«¯è°ƒç”¨å¾®ä¿¡ç»Ÿä¸€ä¸‹å•æ¥å£ï¼Œè·å–æ”¯ä»˜å‚æ•°ï¼ˆ&lt;code>timeStamp&lt;/code>, &lt;code>nonceStr&lt;/code>, &lt;code>package&lt;/code>, &lt;code>signType&lt;/code>, &lt;code>paySign&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>å”¤èµ·æ”¯ä»˜&lt;/strong>ï¼š
å‰ç«¯ä½¿ç”¨ &lt;code>WeixinJSBridge.invoke&lt;/code> æˆ– &lt;code>wx.chooseWXPay&lt;/code> è°ƒèµ·æ”¯ä»˜çª—å£ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="-æ³¨æ„äº‹é¡¹">âš ï¸ æ³¨æ„äº‹é¡¹&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>æˆæƒåŸŸå&lt;/strong>ï¼š&lt;code>redirect_uri&lt;/code> çš„åŸŸåå¿…é¡»åœ¨&lt;strong>å¾®ä¿¡å…¬ä¼—å¹³å°&lt;/strong>çš„â€œç½‘é¡µæˆæƒåŸŸåâ€ä¸­é…ç½®ã€‚&lt;/li>
&lt;li>&lt;strong>æ”¯ä»˜ç›®å½•&lt;/strong>ï¼šæ”¯ä»˜é¡µé¢çš„è·¯å¾„å¿…é¡»åœ¨&lt;strong>å¾®ä¿¡å•†æˆ·å¹³å°&lt;/strong>é…ç½®â€œJSAPIæ”¯ä»˜æˆæƒç›®å½•â€ã€‚&lt;/li>
&lt;li>&lt;strong>AppID&lt;/strong>ï¼šæ­¤å¤„ä½¿ç”¨&lt;strong>å…¬ä¼—å·&lt;/strong>çš„ AppIDã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="2-h5-æ”¯ä»˜">2. H5 æ”¯ä»˜&lt;/h2>
&lt;p>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šå¤–éƒ¨ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼ˆå¦‚ Safari, Chromeï¼‰ã€App å†…åµŒ H5ï¼ˆéå¾®ä¿¡ç¯å¢ƒï¼‰ã€‚&lt;/p>
&lt;h3 id="æ ¸å¿ƒæµç¨‹-1">æ ¸å¿ƒæµç¨‹&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>åç«¯ä¸‹å•&lt;/strong>ï¼š
åç«¯è°ƒç”¨å¾®ä¿¡ç»Ÿä¸€ä¸‹å•æ¥å£ï¼ˆäº¤æ˜“ç±»å‹ä¸º &lt;code>MWEB&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>è·å–è·³è½¬é“¾æ¥&lt;/strong>ï¼š
æ¥å£è¿”å› &lt;code>mweb_url&lt;/code>ï¼ˆå³åŸæ–‡ä¸­çš„ &lt;code>pay_url&lt;/code>ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>è·³è½¬æ”¯ä»˜&lt;/strong>ï¼š
å‰ç«¯ç›´æ¥è·³è½¬è¯¥é“¾æ¥ï¼Œå¾®ä¿¡ä¼šä¸­é—´é¡µå”¤èµ·å¾®ä¿¡å®¢æˆ·ç«¯è¿›è¡Œæ”¯ä»˜ã€‚
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç¤ºä¾‹ï¼šè·³è½¬å¹¶æŒ‡å®šæ”¯ä»˜åçš„å›è°ƒé¡µ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mweb_url&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&amp;amp;redirect_url=&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">encodeURIComponent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="-æ³¨æ„äº‹é¡¹-1">âš ï¸ æ³¨æ„äº‹é¡¹&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>Referer æ ¡éªŒ&lt;/strong>ï¼šå¾®ä¿¡ä¼šæ ¡éªŒå‘èµ·æ”¯ä»˜è¯·æ±‚çš„åŸŸåï¼ˆRefererï¼‰ï¼Œéœ€åœ¨å•†æˆ·å¹³å°é…ç½®â€œH5æ”¯ä»˜åŸŸåâ€ã€‚&lt;/li>
&lt;li>&lt;strong>AppID&lt;/strong>ï¼šæ­¤å¤„ä½¿ç”¨&lt;strong>å•†æˆ·ç»‘å®šçš„ç§»åŠ¨åº”ç”¨æˆ–å…¬ä¼—å·&lt;/strong> AppIDã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="3-å°ç¨‹åºæ”¯ä»˜">3. å°ç¨‹åºæ”¯ä»˜&lt;/h2>
&lt;p>&lt;strong>é€‚ç”¨åœºæ™¯&lt;/strong>ï¼šå¾®ä¿¡å°ç¨‹åºåŸç”Ÿç¯å¢ƒã€‚&lt;/p>
&lt;h3 id="æ ¸å¿ƒæµç¨‹-2">æ ¸å¿ƒæµç¨‹&lt;/h3>
&lt;ol>
&lt;li>&lt;strong>è·å–ç™»å½•å‡­è¯&lt;/strong>ï¼š
å‰ç«¯è°ƒç”¨ &lt;code>wx.login()&lt;/code> è·å– &lt;code>code&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>è·å– OpenID&lt;/strong>ï¼š
åç«¯é€šè¿‡ &lt;code>appid&lt;/code>ã€&lt;code>secret&lt;/code> å’Œ &lt;code>code&lt;/code> æ¢å– &lt;code>openid&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>åç«¯ä¸‹å•&lt;/strong>ï¼š
åç«¯è°ƒç”¨ç»Ÿä¸€ä¸‹å•æ¥å£ï¼Œè¿”å›æ”¯ä»˜æ ¸å¿ƒå‚æ•°ï¼ˆ&lt;code>paySign&lt;/code> ç­‰ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>å”¤èµ·æ”¯ä»˜&lt;/strong>ï¼š
å‰ç«¯è°ƒç”¨å°ç¨‹åº API è¿›è¡Œæ”¯ä»˜ï¼š
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">wx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">requestPayment&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">timeStamp&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">nonceStr&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">package&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">signType&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;MD5&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">paySign&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">success&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fail&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">res&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="-æ³¨æ„äº‹é¡¹-2">âš ï¸ æ³¨æ„äº‹é¡¹&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>AppID&lt;/strong>ï¼šæ­¤å¤„å¿…é¡»ä½¿ç”¨&lt;strong>å°ç¨‹åº&lt;/strong>çš„ AppIDã€‚&lt;/li>
&lt;li>&lt;strong>è´¦å·å…³è”&lt;/strong>ï¼šå°ç¨‹åºå¿…é¡»å·²å…³è”åˆ°å¾®ä¿¡å•†æˆ·å·ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="4-é™„å½•å‰ç«¯ç¯å¢ƒåˆ¤æ–­å·¥å…·">4. é™„å½•ï¼šå‰ç«¯ç¯å¢ƒåˆ¤æ–­å·¥å…·&lt;/h2>
&lt;p>åœ¨å‘èµ·æ”¯ä»˜å‰ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å½“å‰è¿è¡Œç¯å¢ƒï¼ˆUser Agentï¼‰æ¥å†³å®šè°ƒç”¨ JSAPI æ”¯ä»˜è¿˜æ˜¯ H5 æ”¯ä»˜ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·å‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * è·å–å½“å‰è¿è¡Œå¹³å°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * @returns {string} &amp;#39;wecom&amp;#39; | &amp;#39;wechat&amp;#39; | &amp;#39;h5&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">function getPlat() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const ua = window.navigator.userAgent.toLowerCase();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ua.includes(&amp;#39;wxwork&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;wecom&amp;#39;; // ä¼ä¸šå¾®ä¿¡ç¯å¢ƒï¼ˆéœ€ä½¿ç”¨ä¼ä¸šå¾®ä¿¡JS-SDKæˆ–å…¼å®¹JSAPIï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else if (ua.includes(&amp;#39;micromessenger&amp;#39;)) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;wechat&amp;#39;; // å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼ˆä½¿ç”¨ JSAPI æ”¯ä»˜ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;h5&amp;#39;; // æ™®é€šæµè§ˆå™¨ï¼ˆä½¿ç”¨ H5 æ”¯ä»˜ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// ä¸šåŠ¡é€»è¾‘è°ƒç”¨ç¤ºä¾‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">const platform = getPlat();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if (platform === &amp;#39;wechat&amp;#39; || platform === &amp;#39;wecom&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ‰§è¡Œ JSAPI æ”¯ä»˜é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#34;æ£€æµ‹åˆ°å¾®ä¿¡ç¯å¢ƒï¼Œå‡†å¤‡å”¤èµ· JSAPI æ”¯ä»˜&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // doJSAPIPay();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">} else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ‰§è¡Œ H5 æ”¯ä»˜é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#34;æ£€æµ‹åˆ°å¤–éƒ¨æµè§ˆå™¨ï¼Œå‡†å¤‡å”¤èµ· H5 æ”¯ä»˜&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // doH5Pay();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜&lt;/h3>
&lt;ul>
&lt;li>ä¼ä¸šå¾®ä¿¡å…¼å®¹æ€§ï¼šåœ¨ä¼ä¸šå¾®ä¿¡ï¼ˆwxworkï¼‰ä¸­ï¼Œé€šå¸¸ä¹Ÿå…¼å®¹å¾®ä¿¡çš„ JSAPI æ”¯ä»˜ï¼Œä½†å»ºè®®å‚è€ƒä¼ä¸šå¾®ä¿¡å®˜æ–¹æ–‡æ¡£ç¡®è®¤æ˜¯å¦éœ€è¦å¼•å…¥ç‰¹å®šçš„ jweixin-moduleã€‚&lt;/li>
&lt;li>å°ç¨‹åºç¯å¢ƒåˆ¤æ–­ï¼šå¦‚æœæ‚¨è¿˜éœ€è¦åˆ¤æ–­æ˜¯å¦åœ¨å°ç¨‹åº Webview ä¸­ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">if (ua.includes(&amp;#39;miniprogram&amp;#39;) || window.__wxjs_environment === &amp;#39;miniprogram&amp;#39;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return &amp;#39;miniprogram&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>uniapp-h5è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</title><link>https://changxiangyu.cn/p/uniapp-h5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</link><pubDate>Wed, 25 Jan 2023 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/uniapp-h5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</guid><description>&lt;p>uniappé¡¹ç›®H5å‘è¡Œï¼ˆå‘è¡Œ-&amp;gt;ç½‘ç«™-PC webæˆ–æ‰‹æœºH5ï¼‰æ‰“åŒ…å&lt;br>
å¦‚æœè¦ç»™é¡¹ç›®å°è£…ä¸€ä¸ªè¯·æ±‚ï¼Œä½†è¯·æ±‚åœ°å€å¿…é¡»è¯»å–é…ç½®æ–‡ä»¶ï¼Œä»é…ç½®æ–‡ä»¶ä¸­æ‹¿åœ°å€ï¼Œåç»­éšæ—¶æ›´æ”¹é…ç½®æ–‡ä»¶ï¼Œç›´æ¥è®©è¯·æ±‚åœ°å€å‘ç”Ÿå˜åŒ–ã€‚&lt;/p>
&lt;h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ&lt;/h2>
&lt;p>æ ¸å¿ƒæ€è·¯ï¼šåˆ©ç”¨æ‰“åŒ…åçš„&lt;code>index.html&lt;/code>æ–‡ä»¶ï¼ŒåŸç”Ÿ&lt;code>&amp;lt;script&amp;gt;&lt;/code>å¼•å…¥é…ç½®æ–‡ä»¶ï¼Œåœ¨å…¨å±€å¯è°ƒç”¨ã€‚
uniapp å®˜æ–¹è§£å†³æ–¹æ¡ˆï¼ˆå»ºè®®çœ‹ä¸€çœ¼ï¼‰ï¼š&lt;a class="link" href="https://uniapp.dcloud.io/collocation/manifest.html#h5=template" target="_blank" rel="noopener"
>&lt;/a>&lt;/p>
&lt;ol>
&lt;li>å»ºç«‹ä¸€ä¸ª&lt;code>config.js&lt;/code>é…ç½®æ–‡ä»¶ï¼š
&lt;code>var config = { defaultUrl: &amp;quot;https://c3test.dassoft.cn&amp;quot;, tenantCode: &amp;quot;admin&amp;quot; }&lt;/code>&lt;br>
ä¿å­˜åˆ°æ¡Œé¢ä¸Šå³å¯ï¼Œæ— éœ€æ”¾åˆ°é¡¹ç›®ä¸­ã€‚&lt;/li>
&lt;li>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º&lt;code>temp.h5.html&lt;/code>ç©ºæ–‡ä»¶ï¼Œcliåˆ›å»ºçš„è¯åŒç†&lt;/li>
&lt;li>æ‰“å¼€&lt;code>temp.h5.html&lt;/code>å¤åˆ¶ä»¥ä¸‹æ¨¡æ¿ä»£ç ï¼Œ&lt;code>&amp;lt;script&amp;gt;&lt;/code>å¼•å…¥é…ç½®æ–‡ä»¶ï¼š
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> &amp;lt;html lang=&amp;#34;zh-CN&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;meta charset=&amp;#34;utf-8&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;meta http-equiv=&amp;#34;X-UA-Compatible&amp;#34; content=&amp;#34;IE=edge&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;%= htmlWebpackPlugin.options.title %&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- Open Graph data --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:title&amp;#34; content=&amp;#34;Title Here&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:url&amp;#34; content=&amp;#34;http://www.example.com/&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:image&amp;#34; content=&amp;#34;http://example.com/image.jpg&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- &amp;lt;meta property=&amp;#34;og:description&amp;#34; content=&amp;#34;Description Here&amp;#34; /&amp;gt; --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var coverSupport = &amp;#39;CSS&amp;#39; in window &amp;amp;&amp;amp; typeof CSS.supports === &amp;#39;function&amp;#39; &amp;amp;&amp;amp; (CSS.supports(&amp;#39;top: env(a)&amp;#39;) || CSS.supports(&amp;#39;top: constant(a)&amp;#39;))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> document.write(&amp;#39;&amp;lt;meta name=&amp;#34;viewport&amp;#34; content=&amp;#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&amp;#39; + (coverSupport ? &amp;#39;, viewport-fit=cover&amp;#39; : &amp;#39;&amp;#39;) + &amp;#39;&amp;#34; /&amp;gt;&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;link rel=&amp;#34;stylesheet&amp;#34; href=&amp;#34;&amp;lt;%= BASE_URL %&amp;gt;static/index.&amp;lt;%= VUE_APP_INDEX_CSS_HASH %&amp;gt;.css&amp;#34; /&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;noscript&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;strong&amp;gt;Please enable JavaScript to continue.&amp;lt;/strong&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/noscript&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;div id=&amp;#34;app&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;!-- built files will be auto injected --&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;script language=&amp;#34;javascript&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //ä½¿ç”¨äº† sessionStorageå’Œæ—¶é—´æˆ³ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ jså’Œcssçš„ç¼“å­˜,é¡µé¢ä¼šè¯åˆ·æ–°æ—¶é—´ä¸ºåŠå°æ—¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var timestamp = new Date().getTime();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var versionStamp = sessionStorage.version;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (versionStamp == null || (timestamp - versionStamp) &amp;gt; 1800000) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sessionStorage.version = timestamp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> document.write(&amp;#39;&amp;lt;script src=&amp;#34;./config.js?v=&amp;#39; + sessionStorage.version + &amp;#39;&amp;#34;&amp;gt;&amp;lt;\/script\&amp;gt;&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/html&amp;gt;```
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>æå‰å†™å¥½è·å–é…ç½®æ–‡ä»¶çš„ä»£ç ï¼ˆåœ¨å“ªé‡Œç”¨é…ç½®æ–‡ä»¶å°±åœ¨é‚£é‡Œå†™ï¼‰&lt;br>
&lt;code>export const defaultUrl = config.defaultUrl;&lt;/code>&lt;br>
å¼€å‘ä¸­ï¼Œå¯ä»¥å…ˆå†™æ­»å‚æ•°ï¼Œåç»­è¦æ‰“åŒ…ååœ¨å˜æ›´ã€‚&lt;/li>
&lt;li>æ‰“å¼€&lt;code>manifest.json&lt;/code>æ–‡ä»¶ï¼Œå°†&lt;code>temp.h5.html&lt;/code>å…³è”ï¼š
&lt;img src="https://changxiangyu.cn/images/uniapp/20251230_161923.png"
loading="lazy"
alt="å±•ç¤ºç¤ºæ„å›¾"
>&lt;/li>
&lt;li>éƒ½é…ç½®å¥½åï¼Œæ‰§è¡Œç¼–è¾‘å™¨èœå•-&amp;gt;å‘è¡Œ-&amp;gt;ç½‘ç«™-PC webæˆ–æ‰‹æœºH5,è¿›è¡Œæ‰“åŒ…ï¼š
æ‰“åŒ…å®Œæˆåï¼ŒæŠŠ&lt;code>h5&lt;/code>ç›®å½•å¤åˆ¶åˆ°æ¡Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºæ–‡ä»¶å¤¹ä½ç½®ã€‚
&lt;img src="https://changxiangyu.cn/images/uniapp/20251230163111.jpg"
loading="lazy"
alt="å±•ç¤ºç¤ºæ„å›¾"
>&lt;/li>
&lt;li>å°†é…ç½®æ–‡ä»¶&lt;code>config.js&lt;/code>åŠ å…¥åˆ°æ ¹ç›®å½•ï¼Œç¡®ä¿ä¸&lt;code>index.html&lt;/code>åŒçº§&lt;/li>
&lt;li>&lt;img src="https://changxiangyu.cn/images/uniapp/20251230163119.jpg"
loading="lazy"
alt="å±•ç¤ºç¤ºæ„å›¾"
>
æ­¤æ—¶&lt;code>index.html&lt;/code>ä¸­çš„&lt;code>&amp;lt;script src=&amp;quot;./config.js&amp;gt;&lt;/code>å°±èƒ½æ­£ç¡®æ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œä»è€Œå®ç°è¯»å–ã€‚
å¯ä»¥æ”¹å˜&lt;code>config.js&lt;/code>æ–‡ä»¶é…ç½®ï¼Œç„¶ååˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ŒæŸ¥çœ‹æ˜¯å¦æ›´æ”¹ã€‚&lt;/li>
&lt;/ol></description></item><item><title>Uniapp H5ç«¯è§£å†³å›¾ç‰‡æ‹ç…§æ—‹è½¬ä¸å‹ç¼©ä¸Šä¼ æ–¹æ¡ˆ</title><link>https://changxiangyu.cn/p/uniapp-h5%E7%AB%AF%E8%A7%A3%E5%86%B3%E5%9B%BE%E7%89%87%E6%8B%8D%E7%85%A7%E6%97%8B%E8%BD%AC%E4%B8%8E%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0%E6%96%B9%E6%A1%88/</link><pubDate>Mon, 09 Jan 2023 10:00:00 +0800</pubDate><guid>https://changxiangyu.cn/p/uniapp-h5%E7%AB%AF%E8%A7%A3%E5%86%B3%E5%9B%BE%E7%89%87%E6%8B%8D%E7%85%A7%E6%97%8B%E8%BD%AC%E4%B8%8E%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0%E6%96%B9%E6%A1%88/</guid><description>&lt;p>åœ¨ Uniapp å¼€å‘ H5 åº”ç”¨æ—¶ï¼Œæ¶‰åŠåˆ°æ‰‹æœºæ‹ç…§ä¸Šä¼ çš„åŠŸèƒ½å¾€å¾€ä¼šé‡åˆ°ä¸¤ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>å›¾ç‰‡æ–¹å‘ä¸å¯¹&lt;/strong>ï¼šä¸åŒå‚å•†çš„æ‰‹æœºï¼ˆå°¤å…¶æ˜¯ iOS å’Œéƒ¨åˆ† Androidï¼‰åœ¨æ‹ç…§æ—¶ï¼Œå›¾ç‰‡å®é™…ä¸Šæ˜¯â€œæ¨ªç€â€ä¿å­˜çš„ï¼Œé€šè¿‡ EXIF ä¿¡æ¯æ ‡è®°äº†æ–¹å‘ã€‚ç›´æ¥åœ¨ &lt;code>img&lt;/code> æ ‡ç­¾æ˜¾ç¤ºå¯èƒ½æ­£å¸¸ï¼Œä½†ä¸€æ—¦ç»˜åˆ¶åˆ° Canvas æˆ–ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå›¾ç‰‡å°±ä¼šæ­ªæ‰ï¼ˆé€šå¸¸æ˜¯æ—‹è½¬äº† 90 åº¦ï¼‰ã€‚&lt;/li>
&lt;li>&lt;strong>å›¾ç‰‡ä½“ç§¯è¿‡å¤§&lt;/strong>ï¼šæ‰‹æœºåŸå›¾åŠ¨è¾„ 5MB+ï¼Œç›´æ¥ä¸Šä¼ æ¶ˆè€—æµé‡ä¸”é€Ÿåº¦æ…¢ï¼Œéœ€è¦åœ¨å‰ç«¯è¿›è¡Œå‹ç¼©ã€‚&lt;/li>
&lt;/ol>
&lt;p>æœ¬æ–‡å°†åˆ†äº«ä¸€ä¸ªåŸºäº &lt;code>Exif.js&lt;/code> å’Œ &lt;code>Canvas&lt;/code> çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ&lt;/h2>
&lt;p>æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸¤ä¸ªæ ¸å¿ƒå·¥å…·åº“ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Exif.js&lt;/strong>ï¼šç”¨äºè¯»å–å›¾ç‰‡çš„å…ƒæ•°æ®ï¼ˆMetadataï¼‰ï¼Œæ ¸å¿ƒæ˜¯è·å– &lt;code>Orientation&lt;/code>ï¼ˆæ–¹å‘ï¼‰æ ‡è¯†ã€‚&lt;/li>
&lt;li>&lt;strong>Mobile-detect&lt;/strong>ï¼ˆå¯é€‰ï¼‰ï¼šç”¨äºè¾…åŠ©åˆ¤æ–­è®¾å¤‡ç±»å‹ï¼Œå¤„ç†ç‰¹å®šæœºå‹çš„å…¼å®¹æ€§å·®å¼‚ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="1-å¼•å…¥-exifjs">1. å¼•å…¥ Exif.js&lt;/h3>
&lt;p>ç”±äº &lt;code>exif.js&lt;/code> æ˜¯ä¸€ä¸ªè¾ƒè€çš„åº“ï¼Œå»ºè®®å°†å…¶æºç ä¿å­˜åˆ°é¡¹ç›®ä¸­ï¼Œä¾‹å¦‚ &lt;code>common/js/toolJs/exif.js&lt;/code>ã€‚
&lt;em>(æ³¨ï¼šç”±äºæºç è¾ƒé•¿ï¼Œæ­¤å¤„ä¸è´´å‡ºå®Œæ•´åº“ä»£ç ï¼Œè¯·ç›´æ¥ä¸‹è½½å®˜æ–¹ç‰ˆæœ¬æˆ–ä½¿ç”¨ npm å®‰è£…)&lt;/em>&lt;/p>
&lt;h3 id="2-æ ¸å¿ƒç»„ä»¶å®ç°">2. æ ¸å¿ƒç»„ä»¶å®ç°&lt;/h3>
&lt;p>æˆ‘ä»¬å°†åŠŸèƒ½å°è£…åœ¨ä¸€ä¸ª Vue ç»„ä»¶ä¸­ã€‚ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š
&lt;code>é€‰æ‹©å›¾ç‰‡&lt;/code> -&amp;gt; &lt;code>è¯»å–EXIFæ–¹å‘&lt;/code> -&amp;gt; &lt;code>Canvasé‡ç»˜(æ—‹è½¬+å‹ç¼©)&lt;/code> -&amp;gt; &lt;code>è·å–Base64&lt;/code> -&amp;gt; &lt;code>ä¸Šä¼ &lt;/code>ã€‚&lt;/p>
&lt;h4 id="html-ç»“æ„">HTML ç»“æ„&lt;/h4>
&lt;p>ç®€å•çš„ç•Œé¢ï¼ŒåŒ…å«é¢„è§ˆå›¾ã€æ‹ç…§æŒ‰é’®å’Œä¸Šä¼ æŒ‰é’®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;template&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;container&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;image :src=&amp;#34;photoSrc&amp;#34; mode=&amp;#34;aspectFit&amp;#34; style=&amp;#34;width: 100%; height: 300px;&amp;#34;&amp;gt;&amp;lt;/image&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;button type=&amp;#34;primary&amp;#34; @click=&amp;#34;takePhoto&amp;#34;&amp;gt;æ‹ç…§/é€‰å›¾&amp;lt;/button&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;button type=&amp;#34;primary&amp;#34; @click=&amp;#34;uploadPhoto&amp;#34; :disabled=&amp;#34;!photoSrc&amp;#34;&amp;gt;ä¸Šä¼ &amp;lt;/button&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/template&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ ¸å¿ƒ-js-é€»è¾‘">æ ¸å¿ƒ JS é€»è¾‘&lt;/h3>
&lt;p>é¦–å…ˆå¼•å…¥å¿…è¦çš„åº“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import EXIF from &amp;#39;../../common/js/toolJs/exif.js&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import MobileDetect from &amp;#39;mobile-detect&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export default {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> data() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> photoSrc: &amp;#39;&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> methods: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ...åç»­æ–¹æ³•
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å…³é”®æ­¥éª¤è§£æ">å…³é”®æ­¥éª¤è§£æ&lt;/h3>
&lt;ol>
&lt;li>è·å–å›¾ç‰‡å¹¶å¼€å¯å¤„ç†æµç¨‹
ä½¿ç”¨ &lt;code>uni.chooseImage&lt;/code> è·å–å›¾ç‰‡ï¼Œç„¶åè°ƒç”¨ &lt;code>detail&lt;/code> æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">takePhoto() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uni.chooseImage({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> count: 1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> success: async (res) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¼€å¯å¼‚æ­¥å¤„ç†æµç¨‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.photoSrc = await this.detail(res.tempFilePaths[0])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fail: (res) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.error(res)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>è¯»å– EXIF Orientation ä¿¡æ¯
è¿™æ˜¯ä¿®æ­£æ–¹å‘çš„å…³é”®ã€‚æˆ‘ä»¬éœ€è¦å°è£…ä¸€ä¸ª Promise æ–¹æ³•æ¥è¯»å–å›¾ç‰‡çš„ Orientation æ ‡ç­¾ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>1: æ­£å¸¸&lt;/li>
&lt;li>6: é¡ºæ—¶é’ˆæ—‹è½¬90åº¦&lt;/li>
&lt;li>8: é€†æ—¶é’ˆæ—‹è½¬90åº¦&lt;/li>
&lt;li>3: æ—‹è½¬180åº¦&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">getImageTag(file, tag, suc) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!file) return 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return new Promise((resolve, reject) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let imgObj = new Image()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imgObj.src = file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uni.getImageInfo({
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> src: file,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> success(res) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EXIF.getData(imgObj, function() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EXIF.getAllTags(this);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è·å–æ–¹å‘æ ‡è®°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let or = EXIF.getTag(this, &amp;#39;Orientation&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resolve(suc(or))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>Canvas æ—‹è½¬ä¸å‹ç¼©
è¿™æ˜¯æœ€å¤æ‚çš„ç¯èŠ‚ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ® &lt;code>Orientation&lt;/code> çš„å€¼ï¼Œåˆ©ç”¨ &lt;code>Canvas&lt;/code> çš„ &lt;code>rotate&lt;/code> æ–¹æ³•å°†å›¾ç‰‡â€œæ‰³æ­£â€ã€‚åŒæ—¶ï¼Œé€šè¿‡æ§åˆ¶ &lt;code>Canvas&lt;/code> çš„å°ºå¯¸æ¥å®ç°å‹ç¼©ã€‚&lt;/li>
&lt;/ol>
&lt;p>æ³¨æ„ï¼šä»£ç ä¸­åŠ å…¥äº†ä¸€ä¸ª &lt;code>getPlat()&lt;/code> åˆ¤æ–­ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ï¼Œéƒ¨åˆ† Android ç¯å¢ƒä¸‹ Canvas çš„æ—‹è½¬è¡Œä¸ºå¯èƒ½ä¸ iOS ä¸ä¸€è‡´ï¼Œéœ€è¦åšç‰¹æ®Šå¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// åˆ¤æ–­æ˜¯å¦ä¸º Android ç»ˆç«¯
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">getPlat() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let u = navigator.userAgent;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return u.indexOf(&amp;#39;Android&amp;#39;) &amp;gt; -1 || u.indexOf(&amp;#39;Adr&amp;#39;) &amp;gt; -1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">async detail(url) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let maxWidth = 800; // è®¾ç½®æœ€å¤§å®½åº¦è¿›è¡Œå‹ç¼©
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let Orientation = 1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 1. è·å–æ–¹å‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await this.getImageTag(url, &amp;#39;Orientation&amp;#39;, function(e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (e != undefined) Orientation = e;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var img = null;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var canvas = null;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 2. åŠ è½½å›¾ç‰‡èµ„æº
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await this.comprossImage(url, maxWidth, function(e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img = e.img;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas = e.canvas;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.log(&amp;#34;å›¾ç‰‡æ–¹å‘è§’:&amp;#34;, Orientation)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let baseStr = &amp;#39;&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 3. æ ¹æ®æ–¹å‘è§’è¿›è¡Œæ—‹è½¬ä¿®æ­£
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ³¨æ„ï¼šè¿™é‡Œé’ˆå¯¹ä¸åŒå¹³å°åšäº†ä¸€äº›ç‰¹å®šé€»è¾‘å¤„ç†ï¼ˆæ ¹æ®å®é™…è°ƒè¯•æƒ…å†µè°ƒæ•´ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switch (Orientation) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 6: // éœ€è¦é¡ºæ—¶é’ˆï¼ˆå‘å³ï¼‰90åº¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.getPlat() ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;right&amp;#39;, canvas) :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;&amp;#39;, canvas); // æŸäº›å®‰å“æœºå‹å¯èƒ½ä¸éœ€è¦æ‰‹åŠ¨æ—‹ï¼Œè§†å…·ä½“Webviewå†…æ ¸è€Œå®š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 8: // éœ€è¦é€†æ—¶é’ˆï¼ˆå‘å·¦ï¼‰90åº¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.getPlat() ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;left&amp;#39;, canvas) :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.rotateImg(img, &amp;#39;&amp;#39;, canvas);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 3: // 180åº¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.rotateImg(img, &amp;#39;right&amp;#39;, canvas, 2);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baseStr = this.rotateImg(img, &amp;#39;&amp;#39;, canvas);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return baseStr;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>æ—‹è½¬çš„å…·ä½“å®ç° (rotateImg)
åˆ©ç”¨ &lt;code>Canvas&lt;/code> ä¸Šä¸‹æ–‡çš„ &lt;code>rotate&lt;/code> å’Œ &lt;code>drawImage&lt;/code>ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rotateImg(img, direction, canvas, times = 1) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ...åˆå§‹åŒ–å‚æ•°ï¼Œè®¡ç®—å®½é«˜...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var width = img.width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var height = img.height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å‹ç¼©é€»è¾‘ï¼šé™åˆ¶æœ€å¤§å®½åº¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let maxWidth = 800;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (width &amp;gt; maxWidth) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> height = Math.floor(height * (maxWidth / width));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> width = maxWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ—‹è½¬è§’åº¦è®¡ç®—
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var step = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (direction == &amp;#39;right&amp;#39;) step += times;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else if (direction == &amp;#39;left&amp;#39;) step -= times;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var degree = step * 90 * Math.PI / 180;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var ctx = canvas.getContext(&amp;#39;2d&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switch (step) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 1: // æ—‹è½¬90åº¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.rotate(degree);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, 0, -height, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 2: // æ—‹è½¬180åº¦
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.rotate(degree);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, -width, -height, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> case 3: // æ—‹è½¬270åº¦ï¼ˆ-90åº¦ï¼‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.rotate(degree);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, -width, 0, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default: // ä¸æ—‹è½¬
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx.drawImage(img, 0, 0, width, height);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> break;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è¾“å‡ºå‹ç¼©åçš„ Base64ï¼Œquality è®¾ç½®ä¸º 0.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return canvas.toDataURL(&amp;#34;image/jpeg&amp;#34;, 0.8);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>ä¸Šä¼ é€»è¾‘
æœ€åï¼Œå°†è·å–åˆ°çš„ Base64 å­—ç¬¦ä¸²ï¼ˆå»é™¤å¤´éƒ¨ä¿¡æ¯åï¼‰å‘é€ç»™åç«¯ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">uploadPhoto() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!this.photoSrc) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let obj = {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å»é™¤ base64 å¤´éƒ¨ï¼Œåç«¯é€šå¸¸åªéœ€è¦å†…å®¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Photo: this.photoSrc.split(&amp;#39;;base64,&amp;#39;)[1],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimeStamp: new Date().getTime(),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ...å…¶ä»–ä¸šåŠ¡å‚æ•°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å‘èµ·è¯·æ±‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // this.$http.baseRequest(...)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é‡åˆ°çš„å‘ä¸æ€»ç»“">é‡åˆ°çš„å‘ä¸æ€»ç»“&lt;/h2>
&lt;ul>
&lt;li>Canvas å®½é«˜æ··æ·†ï¼šå½“å›¾ç‰‡æ—‹è½¬ 90 åº¦æ—¶ï¼ŒCanvas çš„ width å’Œ height å¿…é¡»äº’æ¢ï¼Œå¦åˆ™å›¾ç‰‡ä¼šè¢«è£å‰ªæˆ–æ‹‰ä¼¸ã€‚&lt;/li>
&lt;li>Android å…¼å®¹æ€§ï¼šä»£ç ä¸­ this.getPlat() çš„åˆ¤æ–­éå¸¸é‡è¦ã€‚éƒ¨åˆ† Android æ‰‹æœºçš„ WebView æˆ–è€…æµè§ˆå™¨åœ¨ä¸Šä¼ å›¾ç‰‡æ—¶ä¼šè‡ªåŠ¨ä¿®æ­£æ–¹å‘ï¼Œå¦‚æœæˆ‘ä»¬å†æ‰‹åŠ¨æ—‹è½¬ä¸€æ¬¡ï¼Œå›¾ç‰‡åè€Œä¼šæ­ªæ‰ã€‚å»ºè®®åœ¨çœŸæœºä¸Šå¤šæµ‹è¯•å‡ æ¬¾ä¸»æµæœºå‹ã€‚&lt;/li>
&lt;li>å†…å­˜æº¢å‡ºï¼šå¯¹äºè¶…å¤§åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼ˆå¦‚ 4000x3000ï¼‰ï¼ŒCanvas ç»˜åˆ¶å¯èƒ½ä¼šå¯¼è‡´ iOS Webview å´©æºƒï¼ˆOOMï¼‰ã€‚è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ç»˜åˆ¶å‰å…ˆå¤§å¹…åº¦å‹ç¼©å›¾ç‰‡å°ºå¯¸ï¼ˆå¦‚é™åˆ¶ maxWidthï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡ä»¥ä¸Šæ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å›¾ç‰‡â€œæ­ªè„–å­â€çš„é—®é¢˜ï¼Œè¿˜å®ç°äº†å‰ç«¯å‹ç¼©ï¼Œå¤§å¤§å‡è½»äº†æœåŠ¡å™¨å¸¦å®½å‹åŠ›ã€‚&lt;/p></description></item><item><title>uniappæ‹ç…§ä¸Šä¼ å›¾ç‰‡h5</title><link>https://changxiangyu.cn/p/uniapp%E6%8B%8D%E7%85%A7%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87h5/</link><pubDate>Fri, 30 Dec 2022 13:05:18 +0800</pubDate><guid>https://changxiangyu.cn/p/uniapp%E6%8B%8D%E7%85%A7%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87h5/</guid><description>&lt;h1 id="step-1-ç•Œé¢ä»£ç å®ç°">Step 1: ç•Œé¢ä»£ç å®ç°&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;template&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;body&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;btn&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;view class=&amp;#34;picture-img&amp;#34; ref=&amp;#34;uploadContent&amp;#34; id=&amp;#34;uploadContent&amp;#34; @click=&amp;#34;takePhotos()&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;div class=&amp;#34;loader-19&amp;#34; v-if=&amp;#34;loader&amp;#34;&amp;gt;&amp;lt;/div&amp;gt;ç‚¹å‡»ä¿®æ”¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/view&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/template&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="step-2-ä½¿ç”¨åˆ°çš„æ–¹æ³•">Step 2: ä½¿ç”¨åˆ°çš„æ–¹æ³•&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;span class="lnt">96
&lt;/span>&lt;span class="lnt">97
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">takePhotos() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const _that = this;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (document.getElementById(&amp;#34;take-picture&amp;#34;) == null) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let input = _that.createInputAndSetAttribute();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.$refs.uploadContent.$el.appendChild(input);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.onchange = async (event) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.loader = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var files = event.target.files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (files &amp;amp;&amp;amp; files.length &amp;gt; 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const file = files[0];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å‹ç¼©å›¾ç‰‡éœ€è¦çš„ä¸€äº›å…ƒç´ å’Œå¯¹è±¡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var reader = new FileReader(),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img = new Image();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç¼©æ”¾å›¾ç‰‡éœ€è¦çš„canvas
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var canvas = document.createElement(&amp;#39;canvas&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var context = canvas.getContext(&amp;#39;2d&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // base64åœ°å€å›¾ç‰‡åŠ è½½å®Œæ¯•å
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.onload = function() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å›¾ç‰‡åŸå§‹å°ºå¯¸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var originWidth = this.width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var originHeight = this.height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æœ€å¤§å°ºå¯¸é™åˆ¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var maxWidth = 960,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxHeight = 1280;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç›®æ ‡å°ºå¯¸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var targetWidth = originWidth,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = originHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å›¾ç‰‡å°ºå¯¸è¶…è¿‡400x400çš„é™åˆ¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth &amp;gt; maxWidth || originHeight &amp;gt; maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth / originHeight &amp;gt; maxWidth / maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ›´å®½ï¼ŒæŒ‰ç…§å®½åº¦é™å®šå°ºå¯¸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = maxWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = Math.round(maxWidth * (originHeight / originWidth));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = maxHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = Math.round(maxHeight * (originWidth / originHeight));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // canvaså¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = targetWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = targetHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ¸…é™¤ç”»å¸ƒ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.clearRect(0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å›¾ç‰‡å‹ç¼©
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.drawImage(img, 0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // canvasè½¬ä¸ºblobå¹¶ä¸Šä¼ 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.toBlob(async (blob) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const newFile = new File([blob], &amp;#39;123.jpg&amp;#39;, {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: blob.type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const imgPath = await upload(newFile, file.path, `/qy/photo`)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const detectionRes = await detection(imgPath)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await editFacePhoto(detectionRes).then(res =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (res.code === 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.photoSrc = res.imgUrl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.$u.toast(&amp;#34;ä¸Šä¼ æˆåŠŸï¼&amp;#34;, 2000)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.$u.toast(res.msg, 3000)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> })
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.loader = false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _that.removeDocument()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }, file.type || &amp;#39;image/png&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ–‡ä»¶base64åŒ–ï¼Œä»¥ä¾¿è·çŸ¥å›¾ç‰‡åŸå§‹å°ºå¯¸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.onload = function(e) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.src = e.target.result;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.readAsDataURL(file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> document.querySelector(&amp;#34;#take-picture&amp;#34;).click();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// åˆ›å»ºinputå¹¶è®¾ç½®inputçš„å±æ€§
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">createInputAndSetAttribute() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> var input = document.createElement(&amp;#39;input&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.type = &amp;#39;file&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.id = &amp;#39;take-picture&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.accept = &amp;#39;image/*&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // input.capture = &amp;#39;user&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.opacity = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.position = &amp;#39;absolute&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.top = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.left = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.width = &amp;#39;50px&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input.style.height = &amp;#39;50px&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return input;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">// ç§»é™¤inputèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">removeDocument() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const uploadContent = document.getElementById(&amp;#34;uploadContent&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const takePicture = document.getElementById(&amp;#34;take-picture&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uploadContent.removeChild(takePicture);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯å‚è€ƒï¼š &lt;a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" target="_blank" rel="noopener"
>https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file&lt;/a>&lt;/p>
&lt;h2 id="ç›®å‰çš„å®ç°æ–¹å¼æœ‰å‡ ä¸ªä¼˜åŒ–ç‚¹">ç›®å‰çš„å®ç°æ–¹å¼æœ‰å‡ ä¸ªä¼˜åŒ–ç‚¹ï¼š&lt;/h2>
&lt;ol>
&lt;li>Vue è¿è§„æ“ä½œï¼šåœ¨ Vue/Uniapp ä¸­é¢‘ç¹ä½¿ç”¨ document.createElementã€appendChild å’Œ removeChild æ˜¯ä¸æ¨èçš„ï¼ˆè¿™æ˜¯ jQuery æ—¶ä»£çš„æ€ç»´ï¼‰ï¼Œåº”è¯¥åˆ©ç”¨ Vue çš„æ¨¡æ¿è¯­æ³•ã€‚&lt;/li>
&lt;li>å›è°ƒåœ°ç‹±ï¼šFileReaderã€Image.onloadã€canvas.toBlob å±‚å±‚åµŒå¥—ï¼Œä»£ç éš¾ä»¥ç»´æŠ¤ã€‚&lt;/li>
&lt;li>é€»è¾‘è€¦åˆï¼šå‹ç¼©é€»è¾‘ã€ä¸Šä¼ é€»è¾‘å’Œ UI äº¤äº’æ··åœ¨ä¸€èµ·ã€‚
ä»¥ä¸‹æ˜¯ä¼˜åŒ–åçš„ç‰ˆæœ¬ï¼Œé‡‡ç”¨ Vue æ•°æ®é©±åŠ¨ çš„æ–¹å¼ï¼Œå¹¶å°†å‹ç¼©é€»è¾‘å°è£…ä¸º Promiseï¼Œä½¿ä»£ç æ¸…æ™°æ˜“è¯»ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯&lt;/h2>
&lt;ol>
&lt;li>&lt;strong>ç§»é™¤ DOM æ“ä½œ&lt;/strong>ï¼šå°† &lt;code>&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;&lt;/code> ç›´æ¥å†™åœ¨ &lt;code>&amp;lt;template&amp;gt;&lt;/code> ä¸­å¹¶é€šè¿‡ &lt;code>v-show&lt;/code> éšè—ï¼Œé€šè¿‡ &lt;code>ref&lt;/code> è§¦å‘ç‚¹å‡»ï¼Œé¿å…åŠ¨æ€åˆ›å»ºé”€æ¯ DOMã€‚&lt;/li>
&lt;li>&lt;strong>å¼‚æ­¥æ‰å¹³åŒ–&lt;/strong>ï¼šå°†å›¾ç‰‡åŠ è½½å’Œ Canvas å‹ç¼©é€»è¾‘å°è£…æˆ &lt;code>Promise&lt;/code>ï¼Œä½¿ç”¨ &lt;code>async/await&lt;/code> æ›¿ä»£å›è°ƒå‡½æ•°ã€‚&lt;/li>
&lt;li>&lt;strong>åŠŸèƒ½æ‹†åˆ†&lt;/strong>ï¼šå°†â€œé€‰æ‹©å›¾ç‰‡â€ã€â€œå‹ç¼©å›¾ç‰‡â€ã€â€œä¸Šä¼ ä¸šåŠ¡â€æ‹†åˆ†ä¸ºç‹¬ç«‹æ–¹æ³•ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="step-1-ç•Œé¢ä»£ç å®ç°-1">Step 1: ç•Œé¢ä»£ç å®ç°&lt;/h2>
&lt;p>ä½¿ç”¨ &lt;code>ref&lt;/code> å¼•ç”¨éšè—çš„ input å…ƒç´ ï¼Œä¿æŒé¡µé¢ç»“æ„æ•´æ´ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">view&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;body&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">view&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;btn&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- è§¦å‘æŒ‰é’® --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">view&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;picture-img&amp;#34;&lt;/span> &lt;span class="err">@&lt;/span>&lt;span class="na">click&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;triggerSelect&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;loader-19&amp;#34;&lt;/span> &lt;span class="na">v-if&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;loader&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {{ loader ? &amp;#39;å¤„ç†ä¸­...&amp;#39; : &amp;#39;ç‚¹å‡»ä¿®æ”¹&amp;#39; }}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">view&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- éšè—çš„åŸç”ŸInputï¼Œç”¨äºH5è°ƒç”¨ç›¸æœº/æ–‡ä»¶ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- accept=&amp;#34;image/*&amp;#34; é™åˆ¶å›¾ç‰‡ï¼Œcapture=&amp;#34;user&amp;#34; å¯é€‰ï¼šå¼ºåˆ¶è°ƒç”¨å‰ç½®æ‘„åƒå¤´ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;file&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">ref&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;fileInput&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">accept&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;image/*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;hidden-input&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">@&lt;/span>&lt;span class="na">change&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;handleFileChange&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">view&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">view&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">style&lt;/span> &lt;span class="na">scoped&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>&lt;span class="nc">hidden-input&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">display&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c">/* éšè—input */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">/* ä½ çš„å…¶ä»–æ ·å¼... */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="step-2-é€»è¾‘å®ç°-script">Step 2: é€»è¾‘å®ç° (Script)&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">export default {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> data() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> loader: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> photoSrc: &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> methods: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 1. è§¦å‘æ–‡ä»¶é€‰æ‹©
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> triggerSelect() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // åœ¨Uniapp H5ä¸­ï¼Œé€šè¿‡$refsè·å–åŸç”ŸDOMå…ƒç´ å¹¶ç‚¹å‡»
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ³¨æ„ï¼šAppç«¯ä¸æ”¯æŒæ­¤æ“ä½œï¼ŒAppç«¯è¯·ä½¿ç”¨ uni.chooseImage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$refs.fileInput.click();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 2. ç›‘å¬æ–‡ä»¶æ”¹å˜
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> async handleFileChange(event) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const files = event.target.files;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (!files || files.length === 0) return;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.loader = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const file = files[0];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> try {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // A. å‹ç¼©å›¾ç‰‡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const { blob, filename } = await this.compressImage(file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // B. æ„é€ æ–°çš„Fileå¯¹è±¡ (è§£å†³éƒ¨åˆ†æµè§ˆå™¨å…¼å®¹æ€§)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const newFile = new File([blob], filename || &amp;#39;compressed.jpg&amp;#39;, { type: blob.type });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // C. æ‰§è¡Œä¸Šä¼ ä¸šåŠ¡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> await this.uploadProcess(newFile, file.path); // file.path åœ¨H5 inputä¸­å¯èƒ½ä¸å­˜åœ¨ï¼Œè§†ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } catch (error) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> console.error(&amp;#34;å¤„ç†å¤±è´¥&amp;#34;, error);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$u.toast(&amp;#34;å›¾ç‰‡å¤„ç†å¤±è´¥&amp;#34;, 2000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } finally {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.loader = false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ¸…ç©ºvalueï¼Œç¡®ä¿ä¸‹æ¬¡é€‰æ‹©åŒä¸€å¼ å›¾ä¹Ÿèƒ½è§¦å‘changeäº‹ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> event.target.value = &amp;#39;&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 3. æ ¸å¿ƒï¼šå›¾ç‰‡å‹ç¼©å·¥å…·å‡½æ•° (è¿”å›Promise)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> compressImage(file) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return new Promise((resolve, reject) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const reader = new FileReader();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.readAsDataURL(file);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.onload = (e) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const img = new Image();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.src = e.target.result;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.onload = () =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // åŸå§‹å°ºå¯¸
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const originWidth = img.width;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const originHeight = img.height;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç›®æ ‡å°ºå¯¸é…ç½®
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const maxWidth = 960;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const maxHeight = 1280;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let targetWidth = originWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> let targetHeight = originHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth &amp;gt; maxWidth || originHeight &amp;gt; maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (originWidth / originHeight &amp;gt; maxWidth / maxHeight) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = maxWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = Math.round(maxWidth * (originHeight / originWidth));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetHeight = maxHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetWidth = Math.round(maxHeight * (originWidth / originHeight));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // Canvas ç»˜åˆ¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const canvas = document.createElement(&amp;#39;canvas&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const context = canvas.getContext(&amp;#39;2d&amp;#39;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.width = targetWidth;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.height = targetHeight;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.clearRect(0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> context.drawImage(img, 0, 0, targetWidth, targetHeight);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å¯¼å‡º Blob
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> canvas.toBlob((blob) =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (blob) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resolve({ blob, filename: file.name });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reject(new Error(&amp;#39;Canvas to Blob failed&amp;#39;));
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }, file.type || &amp;#39;image/jpeg&amp;#39;, 0.8); // 0.8 ä¸ºå‹ç¼©è´¨é‡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> img.onerror = (err) =&amp;gt; reject(err);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> };
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reader.onerror = (err) =&amp;gt; reject(err);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // 4. ä¸Šä¼ ä¸šåŠ¡é€»è¾‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> async uploadProcess(file, originalPath) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å‡è®¾ upload, detection, editFacePhoto å·²å¯¼å…¥æˆ–å®šä¹‰
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const imgPath = await upload(file, originalPath, `/qy/photo`);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const detectionRes = await detection(imgPath);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> const res = await editFacePhoto(detectionRes);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (res.code === 0) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.photoSrc = res.imgUrl;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$u.toast(&amp;#34;ä¸Šä¼ æˆåŠŸï¼&amp;#34;, 2000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> this.$u.toast(res.msg, 3000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å…³é”®æ”¹è¿›ç‚¹è¯´æ˜">å…³é”®æ”¹è¿›ç‚¹è¯´æ˜&lt;/h3>
&lt;ol>
&lt;li>Input å¤ç”¨ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>åŸä»£ç æ¯æ¬¡ç‚¹å‡»éƒ½ &lt;code>createElement&lt;/code>ï¼Œä¸ä»…æ€§èƒ½ä½ï¼Œè€Œä¸”åœ¨éƒ¨åˆ†å®‰å“ WebView ä¸­å¯èƒ½å› ä¸º DOM æœªå®Œå…¨æ’å…¥è€Œæ— æ³•å”¤èµ·ç›¸æœºã€‚&lt;/li>
&lt;li>æ–°ä»£ç å°†&lt;code> &amp;lt;input&amp;gt;&lt;/code> é™æ€åŒ–ï¼Œåˆ©ç”¨ &lt;code>event.target.value = ''&lt;/code> é‡ç½®çŠ¶æ€ï¼Œç¡®ä¿ç¨³å®šæ€§ã€‚&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>Promise å°è£…ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>åŸä»£ç åœ¨ &lt;code>img.onload&lt;/code> å†…éƒ¨åµŒå¥—äº†å¤§é‡ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li>
&lt;li>æ–°ä»£ç å°†å‹ç¼©é€»è¾‘æå–ä¸º &lt;code>compressImage&lt;/code>ï¼Œè¿”å› Promiseï¼Œä½¿å¾—ä¸»æµç¨‹ &lt;code>handleFileChange&lt;/code> å¯ä»¥ä½¿ç”¨ &lt;code>await&lt;/code> é¡ºåºæ‰§è¡Œï¼Œé€»è¾‘ä¸€ç›®äº†ç„¶ã€‚&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>å…¼å®¹æ€§å¤„ç†ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>å¢åŠ äº† &lt;code>canvas.toBlob&lt;/code> çš„è´¨é‡å‚æ•°ï¼ˆ0.8ï¼‰ï¼Œå¯è¿›ä¸€æ­¥å‡å°ä½“ç§¯ã€‚&lt;/li>
&lt;li>å¢åŠ äº† &lt;code>input&lt;/code> çš„ &lt;code>display: none&lt;/code> æ ·å¼ï¼Œé¿å…é¡µé¢å‡ºç°å¥‡æ€ªçš„å ä½ã€‚&lt;/li>
&lt;/ul></description></item></channel></rss>