<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on 我的空间</title><link>https://changxiangyu.cn/categories/docker/</link><description>Recent content in Docker on 我的空间</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 20 Jan 2026 10:50:00 +0800</lastBuildDate><atom:link href="https://changxiangyu.cn/categories/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>Windows 11 上配置 Docker</title><link>https://changxiangyu.cn/p/windows-11-%E4%B8%8A%E9%85%8D%E7%BD%AE-docker/</link><pubDate>Tue, 20 Jan 2026 10:50:00 +0800</pubDate><guid>https://changxiangyu.cn/p/windows-11-%E4%B8%8A%E9%85%8D%E7%BD%AE-docker/</guid><description>&lt;p>一、系统要求与准备&lt;/p>
&lt;ol>
&lt;li>系统要求
Windows 11 64位：家庭版/专业版/企业版&lt;/li>
&lt;/ol>
&lt;p>必须启用硬件虚拟化（BIOS/UEFI中开启Intel VT-x/AMD-V）&lt;/p>
&lt;p>WSL 2 需要 Windows 10 版本 1903 或更高（Windows 11 已内置）&lt;/p>
&lt;p>至少 4GB RAM（建议8GB以上）&lt;/p>
&lt;p>存储空间：至少 20GB 可用空间&lt;/p>
&lt;ol start="2">
&lt;li>检查虚拟化是否开启
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="打开-powershell管理员">打开 PowerShell（管理员）&lt;/h1>
&lt;p>systeminfo&lt;/p>
&lt;h1 id="或使用任务管理器查看">或使用任务管理器查看&lt;/h1>
&lt;h1 id="ctrlshiftesc--性能--cpu--虚拟化-已启用">Ctrl+Shift+Esc → 性能 → CPU → &amp;ldquo;虚拟化: 已启用&amp;rdquo;&lt;/h1>
&lt;p>如果未启用，需要重启进入 BIOS/UEFI 开启：&lt;/p>
&lt;p>Intel CPU：开启 Intel Virtualization Technology (VT-x)&lt;/p>
&lt;p>AMD CPU：开启 AMD-V&lt;/p>
&lt;p>二、安装 Docker Desktop for Windows
方法1：官方安装（推荐）
下载 Docker Desktop&lt;/p>
&lt;p>powershell&lt;/p>
&lt;h1 id="官方下载地址最新稳定版">官方下载地址（最新稳定版）&lt;/h1>
&lt;p>&lt;a class="link" href="https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe" target="_blank" rel="noopener"
>https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe&lt;/a>
运行安装程序&lt;/p>
&lt;p>双击安装文件&lt;/p>
&lt;p>勾选 &amp;ldquo;Use WSL 2 instead of Hyper-V&amp;rdquo;（推荐）&lt;/p>
&lt;p>安装完成后不要立即启动&lt;/p>
&lt;p>启用 WSL 2 功能&lt;/p>
&lt;p>powershell&lt;/p>
&lt;h1 id="以管理员身份打开-powershell">以管理员身份打开 PowerShell&lt;/h1>
&lt;p>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart&lt;/p>
&lt;h1 id="重启电脑">重启电脑&lt;/h1>
&lt;p>shutdown /r /t 0
设置 WSL 2 为默认版本&lt;/p>
&lt;p>powershell
wsl &amp;ndash;set-default-version 2
方法2：使用 Winget 安装
powershell&lt;/p>
&lt;h1 id="搜索-docker-desktop">搜索 Docker Desktop&lt;/h1>
&lt;p>winget search Docker.Desktop&lt;/p>
&lt;h1 id="安装">安装&lt;/h1>
&lt;p>winget install Docker.DockerDesktop
三、安装后的配置&lt;/p>
&lt;ol>
&lt;li>首次启动配置
启动 Docker Desktop&lt;/li>
&lt;/ol>
&lt;p>接受服务条款&lt;/p>
&lt;p>选择 &amp;ldquo;Use WSL 2 based engine&amp;rdquo;（推荐）&lt;/p>
&lt;p>配置 WSL 集成：&lt;/p>
&lt;p>text
[x] Enable integration with my default WSL distro
[x] Ubuntu (或你安装的其他 WSL 发行版)
2. 验证安装
powershell&lt;/p>
&lt;h1 id="打开-powershell-或-cmd">打开 PowerShell 或 CMD&lt;/h1>
&lt;p>docker &amp;ndash;version&lt;/p>
&lt;h1 id="docker-version-2406-build-ed223bc">Docker version 24.0.6, build ed223bc&lt;/h1>
&lt;p>docker-compose &amp;ndash;version&lt;/p>
&lt;h1 id="docker-compose-version-v2210">Docker Compose version v2.21.0&lt;/h1>
&lt;p>docker run hello-world&lt;/p>
&lt;h1 id="如果看到欢迎信息说明安装成功">如果看到欢迎信息，说明安装成功&lt;/h1>
&lt;h1 id="查看-docker-信息">查看 Docker 信息&lt;/h1>
&lt;p>docker info
3. WSL 2 后端配置
powershell&lt;/p>
&lt;h1 id="查看-wsl-状态">查看 WSL 状态&lt;/h1>
&lt;p>wsl -l -v&lt;/p>
&lt;h1 id="应该显示">应该显示：&lt;/h1>
&lt;h1 id="name------state-----------version">NAME STATE VERSION&lt;/h1>
&lt;h1 id="-ubuntu----running---------2">* Ubuntu Running 2&lt;/h1>
&lt;h1 id="docker-desktop-data-running-2">docker-desktop-data Running 2&lt;/h1>
&lt;h1 id="docker-desktop----running-2">docker-desktop Running 2&lt;/h1>
&lt;h1 id="如果版本不是2升级">如果版本不是2，升级：&lt;/h1>
&lt;p>wsl &amp;ndash;set-version Ubuntu 2&lt;/p>
&lt;h1 id="设置默认发行版">设置默认发行版&lt;/h1>
&lt;p>wsl &amp;ndash;set-default Ubuntu
四、Docker Desktop 设置优化&lt;/p>
&lt;ol>
&lt;li>资源分配
打开 Docker Desktop → Settings → Resources：&lt;/li>
&lt;/ol>
&lt;p>CPU：建议分配 4-8 核（根据你的 CPU 核心数）&lt;/p>
&lt;p>Memory：建议分配 4-8 GB（不要超过总内存的50%）&lt;/p>
&lt;p>Swap：1-2 GB&lt;/p>
&lt;p>Disk image size：至少 50 GB&lt;/p>
&lt;ol start="2">
&lt;li>Docker Engine 配置
json
// Settings → Docker Engine
{
&amp;ldquo;registry-mirrors&amp;rdquo;: [
&amp;ldquo;https://docker.mirrors.ustc.edu.cn&amp;rdquo;,
&amp;ldquo;https://hub-mirror.c.163.com&amp;rdquo;
],
&amp;ldquo;insecure-registries&amp;rdquo;: [],
&amp;ldquo;debug&amp;rdquo;: false,
&amp;ldquo;experimental&amp;rdquo;: false,
&amp;ldquo;features&amp;rdquo;: {
&amp;ldquo;buildkit&amp;rdquo;: true
},
&amp;ldquo;builder&amp;rdquo;: {
&amp;ldquo;gc&amp;rdquo;: {
&amp;ldquo;enabled&amp;rdquo;: true,
&amp;ldquo;defaultKeepStorage&amp;rdquo;: &amp;ldquo;10GB&amp;rdquo;
}
}
}&lt;/li>
&lt;li>WSL 2 设置
Enable integration with additional WSL 2 distros：选择要集成的发行版&lt;/li>
&lt;/ol>
&lt;p>Start Docker Desktop when you log in：根据需要开启&lt;/p>
&lt;p>Expose daemon on tcp://localhost:2375 without TLS：不建议开启&lt;/p>
&lt;p>五、常用命令与操作
基础命令
powershell&lt;/p>
&lt;h1 id="镜像操作">镜像操作&lt;/h1>
&lt;p>docker images # 查看镜像
docker pull ubuntu:latest # 拉取镜像
docker rmi &amp;lt;image_id&amp;gt; # 删除镜像&lt;/p>
&lt;h1 id="容器操作">容器操作&lt;/h1>
&lt;p>docker ps # 查看运行中的容器
docker ps -a # 查看所有容器
docker run -it ubuntu bash # 运行交互式容器
docker start &amp;lt;container_id&amp;gt; # 启动容器
docker stop &amp;lt;container_id&amp;gt; # 停止容器
docker rm &amp;lt;container_id&amp;gt; # 删除容器&lt;/p>
&lt;h1 id="清理">清理&lt;/h1>
&lt;p>docker system prune -a # 清理所有未使用的资源
Windows 特有命令
powershell&lt;/p>
&lt;h1 id="wsl-与-docker-交互">WSL 与 Docker 交互&lt;/h1>
&lt;p>wsl &amp;ndash;shutdown # 关闭所有 WSL 发行版
wsl -d docker-desktop # 进入 docker-desktop WSL
wsl -d docker-desktop-data # 进入数据卷 WSL&lt;/p>
&lt;h1 id="重启-docker-服务">重启 Docker 服务&lt;/h1>
&lt;p>net stop com.docker.service
net start com.docker.service
六、开发环境配置&lt;/p>
&lt;ol>
&lt;li>项目结构示例
text
my-project/
├── docker-compose.yml
├── Dockerfile
├── .dockerignore
├── src/
└── data/&lt;/li>
&lt;li>简单 Dockerfile 示例
dockerfile&lt;/li>
&lt;/ol>
&lt;h1 id="基础镜像">基础镜像&lt;/h1>
&lt;p>FROM python:3.11-slim&lt;/p>
&lt;h1 id="设置工作目录">设置工作目录&lt;/h1>
&lt;p>WORKDIR /app&lt;/p>
&lt;h1 id="复制依赖文件">复制依赖文件&lt;/h1>
&lt;p>COPY requirements.txt .&lt;/p>
&lt;h1 id="安装依赖">安装依赖&lt;/h1>
&lt;p>RUN pip install &amp;ndash;no-cache-dir -r requirements.txt&lt;/p>
&lt;h1 id="复制源代码">复制源代码&lt;/h1>
&lt;p>COPY . .&lt;/p>
&lt;h1 id="暴露端口">暴露端口&lt;/h1>
&lt;p>EXPOSE 8000&lt;/p>
&lt;h1 id="启动命令">启动命令&lt;/h1>
&lt;p>CMD [&amp;ldquo;python&amp;rdquo;, &amp;ldquo;app.py&amp;rdquo;]
3. Docker Compose 示例
yaml
version: &amp;lsquo;3.8&amp;rsquo;
services:
web:
build: .
ports:
- &amp;ldquo;8000:8000&amp;rdquo;
volumes:
- ./src:/app/src
environment:
- DEBUG=1
depends_on:
- db&lt;/p>
&lt;p>db:
image: postgres:15
environment:
POSTGRES_PASSWORD: example
volumes:
- postgres_data:/var/lib/postgresql/data&lt;/p>
&lt;p>volumes:
postgres_data:
七、常见问题解决&lt;/p>
&lt;ol>
&lt;li>Docker 启动失败
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="1-检查-wsl-2-是否正常">1. 检查 WSL 2 是否正常&lt;/h1>
&lt;p>wsl &amp;ndash;status&lt;/p>
&lt;h1 id="2-重置-docker">2. 重置 Docker&lt;/h1>
&lt;p>Docker Desktop → Troubleshoot → Reset to factory defaults&lt;/p>
&lt;h1 id="3-重新安装-wsl-2-内核">3. 重新安装 WSL 2 内核&lt;/h1>
&lt;h1 id="下载httpswslstorestorageblobcorewindowsnetwslblobwsl_update_x64msi">下载：https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi&lt;/h1>
&lt;ol start="2">
&lt;li>网络问题
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="查看-docker-网络">查看 Docker 网络&lt;/h1>
&lt;p>docker network ls&lt;/p>
&lt;h1 id="创建自定义网络">创建自定义网络&lt;/h1>
&lt;p>docker network create my-network&lt;/p>
&lt;h1 id="配置-dns在-docker-desktop-settings--docker-engine">配置 DNS（在 Docker Desktop Settings → Docker Engine）&lt;/h1>
&lt;p>{
&amp;ldquo;dns&amp;rdquo;: [&amp;ldquo;8.8.8.8&amp;rdquo;, &amp;ldquo;114.114.114.114&amp;rdquo;]
}
3. 磁盘空间不足
powershell&lt;/p>
&lt;h1 id="清理-docker-数据">清理 Docker 数据&lt;/h1>
&lt;p>docker system prune &amp;ndash;all &amp;ndash;volumes&lt;/p>
&lt;h1 id="或通过-docker-desktop">或通过 Docker Desktop&lt;/h1>
&lt;p>Settings → Resources → Advanced → Disk image location&lt;/p>
&lt;h1 id="可以移动到更大的磁盘">可以移动到更大的磁盘&lt;/h1>
&lt;ol start="4">
&lt;li>权限问题
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="以管理员运行-docker-desktop">以管理员运行 Docker Desktop&lt;/h1>
&lt;h1 id="或在-powershell-中">或在 PowerShell 中：&lt;/h1>
&lt;p>net localgroup docker-users &amp;ldquo;你的用户名&amp;rdquo; /add
5. 端口被占用
powershell&lt;/p>
&lt;h1 id="查看端口占用">查看端口占用&lt;/h1>
&lt;p>netstat -ano | findstr :端口号&lt;/p>
&lt;h1 id="停止占用进程">停止占用进程&lt;/h1>
&lt;p>taskkill /PID 进程号 /F
八、性能优化建议&lt;/p>
&lt;ol>
&lt;li>文件系统性能
dockerfile&lt;/li>
&lt;/ol>
&lt;h1 id="在-dockerfile-中使用-dockerignore">在 Dockerfile 中使用 .dockerignore&lt;/h1>
&lt;h1 id="dockerignore-文件内容">.dockerignore 文件内容：&lt;/h1>
&lt;p>.git
node_modules
*.log
*.tmp
2. 卷映射优化
yaml&lt;/p>
&lt;h1 id="docker-composeyml">docker-compose.yml&lt;/h1>
&lt;p>version: &amp;lsquo;3.8&amp;rsquo;
services:
app:
volumes:
# 使用命名卷（性能更好）
- app_data:/data
# 特定文件映射（避免整个目录）
- ./config:/app/config:ro # 只读&lt;/p>
&lt;p>volumes:
app_data:
3. WSL 2 性能优化
创建 %UserProfile%.wslconfig：&lt;/p>
&lt;p>ini
[wsl2]
memory=8GB # 限制内存使用
processors=4 # 分配 CPU 核心
swap=2GB # 交换空间
localhostForwarding=true
九、GUI 应用支持&lt;/p>
&lt;ol>
&lt;li>运行 GUI 应用
dockerfile&lt;/li>
&lt;/ol>
&lt;h1 id="dockerfile-示例运行-firefox">Dockerfile 示例（运行 Firefox）&lt;/h1>
&lt;p>FROM ubuntu:22.04&lt;/p>
&lt;p>RUN apt update &amp;amp;&amp;amp; apt install -y firefox&lt;/p>
&lt;h1 id="允许连接到主机-x11-服务器">允许连接到主机 X11 服务器&lt;/h1>
&lt;p>ENV DISPLAY=host.docker.internal:0
2. 安装 Windows 的 X 服务器
安装 VcXsrv 或 XMing&lt;/p>
&lt;p>启动 XLaunch，选择 &amp;ldquo;Disable access control&amp;rdquo;&lt;/p>
&lt;p>在 WSL 中设置：&lt;/p>
&lt;p>bash
export DISPLAY=$(cat /etc/resolv.conf | grep nameserver | awk &amp;lsquo;{print $2}&amp;rsquo;):0
十、常用工具扩展&lt;/p>
&lt;ol>
&lt;li>安装 Docker 扩展
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="安装-dive查看镜像层">安装 dive（查看镜像层）&lt;/h1>
&lt;p>docker run &amp;ndash;rm -it wagoodman/dive:latest&lt;/p>
&lt;h1 id="安装-lazydockertui-管理工具">安装 lazydocker（TUI 管理工具）&lt;/h1>
&lt;p>docker run &amp;ndash;rm -it lazyteam/lazydocker
2. VS Code 集成
安装 Docker 和 Dev Containers 扩展&lt;/p>
&lt;p>在项目根目录创建 .devcontainer/devcontainer.json&lt;/p>
&lt;p>按 F1 → Reopen in Container&lt;/p>
&lt;p>十一、备份与迁移&lt;/p>
&lt;ol>
&lt;li>导出/导入镜像
powershell&lt;/li>
&lt;/ol>
&lt;h1 id="导出镜像">导出镜像&lt;/h1>
&lt;p>docker save -o myimage.tar myimage:tag&lt;/p>
&lt;h1 id="导入镜像">导入镜像&lt;/h1>
&lt;p>docker load -i myimage.tar&lt;/p>
&lt;h1 id="导出容器">导出容器&lt;/h1>
&lt;p>docker export -o mycontainer.tar container_id
docker import mycontainer.tar
2. 备份 Docker 数据
powershell&lt;/p>
&lt;h1 id="备份所有镜像">备份所有镜像&lt;/h1>
&lt;p>docker save $(docker images -q) -o all_images.tar&lt;/p>
&lt;h1 id="备份卷数据">备份卷数据&lt;/h1>
&lt;p>docker run &amp;ndash;rm -v my_volume:/data -v $(pwd):/backup ubuntu tar czf /backup/backup.tar.gz /data
快速检查清单
虚拟化已启用&lt;/p>
&lt;p>WSL 2 已安装并设为默认&lt;/p>
&lt;p>Docker Desktop 使用 WSL 2 后端&lt;/p>
&lt;p>资源分配合理（内存/CPU/磁盘）&lt;/p>
&lt;p>配置了国内镜像加速器&lt;/p>
&lt;p>防火墙允许 Docker 通信&lt;/p></description></item><item><title>Docker容器占用大量存储</title><link>https://changxiangyu.cn/p/docker%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F%E5%AD%98%E5%82%A8/</link><pubDate>Tue, 17 Jan 2023 11:02:00 +0800</pubDate><guid>https://changxiangyu.cn/p/docker%E5%AE%B9%E5%99%A8%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F%E5%AD%98%E5%82%A8/</guid><description>&lt;p>服务产生大量core文件，导致存储空间被占满
可通过命令&lt;code>find /home/docker -name core.*&lt;/code>查看产生core文件的路径（docker数据目录以现场配置为准）&lt;/p>
&lt;ol>
&lt;li>删除所有容器，包含base和c3目录下的
&lt;code>docker-compose down&lt;/code>&lt;/li>
&lt;li>使用df -h检查空间是否已经恢复&lt;/li>
&lt;li>修改&lt;code>docker-compose.yml&lt;/code>,在每个服务的最后增加以下配置：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> ulimits:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> core: 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://changxiangyu.cn/images/web/docker-1.png"
loading="lazy"
>
5. 启动docker容器
&lt;code>docker-compose up -d&lt;/code>&lt;/p></description></item></channel></rss>